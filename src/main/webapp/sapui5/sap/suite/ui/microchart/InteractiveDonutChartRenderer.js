/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

		(c) Copyright 2009-2016 SAP SE. All rights reserved
	
 */
sap.ui.define(["jquery.sap.global",'./library',"sap/ui/core/theming/Parameters"],function(q,l,P){"use strict";var I={};I.SEGMENT_COLORS=["sapSuiteIDCColor1","sapSuiteIDCColor2","sapSuiteIDCColor3","sapSuiteIDCColor4"];I.TOTAL_RADIUS_ABSOLUTE=3.625;I.OUTER_RADIUS_ABSOLUTE=3.25;I.SELECTION_THICKNESS_ABSOLUTE=0.375;I.HOLE_SIZE_RATIO_COMPACT=0.48;I.HOLE_SIZE_RATIO_COZY=0.3;I.SEGMENT_HALF_GAP_SIZE=0.5;I.render=function(r,c){if(!c._bThemeApplied){return;}r.write("<div");r.addClass("sapSuiteIDC");r.writeControlData(c);r.writeClasses();r.write(">");this._aSegments=c.getAggregation("segments");this._renderDonut(r,c);this._renderLegend(r,c);r.write("</div>");};I._handleLegendEntrySizing=function(c){var L=c.$().find(".sapSuiteIDCLegend"),$=L.find(".sapSuiteIDCLegendLabel"),v=L.find(".sapSuiteIDCLegendValue"),V=0;v.each(function(){var i=q(this).outerWidth(true);V=Math.max(V,i);});$.css("width","calc(100% - "+V+"px)");v.css("width",V+"px");};I._renderDonut=function(r,c){var s,S,f,a,t,b,o,h;var m=c.getProperty("maxDisplayedSegments");var C=c._isCompact();r.write("<div");r.addClass("sapSuiteIDCChart");r.writeClasses();r.write(">");if(!c.getSelectionEnabled()){this._renderDisabledOverlay(r,c);}r.write("<svg");r.addClass("sapSuiteIDCChartSVG");r.writeClasses();r.writeAttribute("viewBox","-2 -2 104 104");r.write(">");r.write("<g");r.writeAttribute("transform","translate(50.5 50.5)");r.write(">");t=50;o=(this.OUTER_RADIUS_ABSOLUTE/this.TOTAL_RADIUS_ABSOLUTE)*t;if(C){b=this.HOLE_SIZE_RATIO_COMPACT*o;}else{b=this.HOLE_SIZE_RATIO_COZY*o;}h=t*(this.SELECTION_THICKNESS_ABSOLUTE/this.TOTAL_RADIUS_ABSOLUTE);S=this._calculateSum(c);f=0.0;var i;for(i=0;i<this._aSegments.length&&i<m;i++){s=this._aSegments[i];if(s.getValue()>0){a=this._calculateSegmentPath(S,s.getValue(),f,o+h,b-h);r.write("<path");r.writeAttribute("d",a);if(!s.getSelected()){r.addStyle("display","none");}r.writeAttribute("data-sap-ui-idc-selection-index",i);r.addClass(l.InteractiveDonutChart.CHART_SEGMENT_GHOST.CSSCLASS);if(s.getSelected()){r.addClass(l.InteractiveDonutChart.CHART_SEGMENT_GHOST.CSSCLASS_SELECTED);}r.writeClasses();r.writeStyles();r.write("/>");f+=this._aSegments[i].getValue();}}f=0.0;for(i=0;i<this._aSegments.length&&i<m;i++){s=this._aSegments[i];if(s.getValue()>0){a=this._calculateSegmentPath(S,s.getValue(),f,o,b);r.write("<path");r.writeAttribute("d",a);r.writeAttribute("fill",this._getSegmentColor(i));r.writeAttribute("cursor","pointer");r.writeAttribute("data-sap-ui-idc-selection-index",i);r.addClass(l.InteractiveDonutChart.CHART_SEGMENT.CSSCLASS);if(s.getSelected()){r.addClass(l.InteractiveDonutChart.CHART_SEGMENT.CSSCLASS_SELECTED);}r.writeClasses();r.write("/>");f+=this._aSegments[i].getValue();}}r.write("</g>");r.write("</svg>");r.write("</div>");};I._renderLegend=function(r,c){r.write("<div");r.addClass("sapSuiteIDCLegend");r.writeClasses();r.write(">");if(!c.getSelectionEnabled()){this._renderDisabledOverlay(r,c);}if(this._aSegments){var m=c.getProperty("maxDisplayedSegments");for(var i=0;i<this._aSegments.length&&i<m;i++){this._renderLegendSegment(r,c,i);}}r.write("</div>");};I._renderLegendSegment=function(r,c,i){var s=this._aSegments[i],L=s.getLabel(),d=s.getDisplayedValue()||String(s.getValue());if(s._bNullValue){d=c._oRb.getText("INTERACTIVECHART_NA");}r.write("<div");r.writeAttributeEscaped("id",c.getId()+"-interactionArea-"+i);r.writeAttributeEscaped("data-sap-ui-idc-selection-index",i);r.addClass("sapSuiteIDCLegendSegment");if(s.getSelected()){r.addClass(l.InteractiveDonutChart.SEGMENT_CSSCLASS_SELECTED);}if(i===0&&c.getSelectionEnabled()){r.writeAttribute("tabindex","0");}r.writeClasses();r.write(">");r.write("<div");r.addClass("sapSuiteIDCLegendMarker");r.writeClasses();r.writeAttribute("style","background-color: "+this._getSegmentColor(i));r.write(">");r.write("</div>");r.write("<div");r.addClass("sapSuiteIDCLegendLabelValue");r.writeClasses();r.write(">");r.write("<div");r.addClass("sapSuiteIDCLegendLabel");r.writeClasses();r.write(">");r.writeEscaped(L);r.write("</div>");r.write("<div");r.addClass("sapSuiteIDCLegendValue");r.writeClasses();r.write(">");r.writeEscaped(d);r.write("</div>");r.write("</div>");r.write("</div>");};I._getSegmentColor=function(p){return P.get(this.SEGMENT_COLORS[p%this.SEGMENT_COLORS.length])||"white";};I._calculateSegmentPath=function(s,a,b,o,i){var m=0.01,S,L,c,d,e,f,E,g,h,G=Math.pow(2*this.SEGMENT_HALF_GAP_SIZE,2),j,k,n,p;o=this._formatFloat(o);i=this._formatFloat(i);f=this._calculateCircleFraction(s,b);E=this._calculateCircleFraction(s,b+a);g=this._calculateCircleFraction(s,a);if(g<=Math.PI){h=0;}else{h=1;}if(s===a){j=i;k=o;n=0;p=0;}else{j=Math.sqrt(Math.pow(i,2)+G);k=Math.sqrt(Math.pow(o,2)+G);n=Math.atan(this.SEGMENT_HALF_GAP_SIZE/i);p=Math.atan(this.SEGMENT_HALF_GAP_SIZE/o);}L={"x":this._formatFloat(j*Math.sin(f+n)),"y":this._formatFloat(-j*Math.cos(f+n))};c={"x":this._formatFloat(k*Math.sin(f+p)),"y":this._formatFloat(-k*Math.cos(f+p))};d={"x":this._formatFloat(o*Math.sin(E-p)-m),"y":this._formatFloat(-o*Math.cos(E-p))};e={"x":this._formatFloat(i*Math.sin(E-n)-m),"y":this._formatFloat(-i*Math.cos(E-n))};S="";S+="M"+L.x+" "+L.y+" ";S+="L"+c.x+" "+c.y+" ";S+="A"+o+","+o+" 0 "+h+",1"+" "+d.x+","+d.y+" ";S+="L"+e.x+" "+e.y+" ";S+="A"+i+","+i+" 0 "+h+",0"+" "+L.x+","+L.y;return S;};I._formatFloat=function(v){return parseFloat(v.toFixed(2));};I._calculateSum=function(c){var s=0;var m=c.getProperty("maxDisplayedSegments");for(var i=0;i<this._aSegments.length&&i<m;i++){s+=Math.max(0,this._aSegments[i].getValue());}return s;};I._calculateCircleFraction=function(s,a){return(2*Math.PI*a)/s;};I._renderDisabledOverlay=function(r,c){r.write("<div");r.addClass("sapSuiteIDCDisabledOverlay");r.writeClasses();r.write(">");r.write("</div>");};return I;},true);
