/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

		(c) Copyright 2009-2016 SAP SE. All rights reserved
	
 */
sap.ui.define(['jquery.sap.global','./library','sap/ui/core/Control','sap/suite/ui/microchart/RadialMicroChartRenderer','sap/ui/Device'],function(q,l,C,R,D){"use strict";var a=C.extend("sap.suite.ui.microchart.RadialMicroChart",{constructor:function(i,s){var p;if(s&&typeof s.percentage==="number"){p=true;}else if(i&&typeof i.percentage==="number"){p=true;}else{p=false;}try{C.apply(this,arguments);this._bPercentageMode=p;}catch(e){this.destroy();throw e;}},metadata:{library:"sap.suite.ui.microchart",properties:{total:{group:"Data",type:"float",defaultValue:null},fraction:{group:"Data",type:"float",defaultValue:null},percentage:{group:"Data",type:"float",defaultValue:null},valueColor:{group:"Appearance",type:"sap.m.ValueCSSColor",defaultValue:"Neutral"},size:{group:"Misc",type:"sap.m.Size",defaultValue:"Responsive"}},events:{press:{}}}});a.prototype.init=function(){this._rb=sap.ui.getCore().getLibraryResourceBundle("sap.suite.ui.microchart");this._bPercentageMode;this._bThemeApplied=true;if(!sap.ui.getCore().isInitialized()){this._bThemeApplied=false;sap.ui.getCore().attachInit(this._handleCoreInitialized.bind(this));}else{this._handleCoreInitialized();}};a.prototype._handleCoreInitialized=function(){this._bThemeApplied=sap.ui.getCore().isThemeApplied();if(!this._bThemeApplied){sap.ui.getCore().attachThemeChanged(this._handleThemeApplied,this);}};a.prototype._handleThemeApplied=function(){this._bThemeApplied=true;this.invalidate();sap.ui.getCore().detachThemeChanged(this._handleThemeApplied,this);};a.prototype.onBeforeRendering=function(){if(l._isInGenericTile(this)){l._removeStandardMargins(this);}D.orientation.detachHandler(this._adjustToTileContent,this);if(!this._bPercentageMode){if(this.getTotal()===0){q.sap.log.error("Total can not be 0, please add a valid total value");}else{this.setProperty("percentage",Math.round((this.getFraction()*100/this.getTotal())*10)/10,true);}}};a.prototype.onAfterRendering=function(){R._handleOnAfterRendering(this);if(l._isInGenericTile(this)){D.orientation.attachHandler(this._adjustToTileContent,this);}};a.prototype.exit=function(){D.orientation.detachHandler(this._adjustToTileContent,this);};a.prototype._adjustToTileContent=function(){var p=this.getParent().$().css("min-width");this.getParent().$().width(p);this.$().width("100%");};a.prototype.ontap=function(e){if(sap.ui.Device.browser.internet_explorer){this.$().focus();}this.firePress();};a.prototype.onkeydown=function(e){if(e.which===q.sap.KeyCodes.SPACE){e.preventDefault();}};a.prototype.onkeyup=function(e){if(e.which===q.sap.KeyCodes.ENTER||e.which===q.sap.KeyCodes.SPACE){this.firePress();e.preventDefault();}};a.prototype.attachEvent=function(e,d,f,b){sap.ui.core.Control.prototype.attachEvent.call(this,e,d,f,b);if(e==="press"){this.rerender();}return this;};a.prototype.detachEvent=function(e,f,b){sap.ui.core.Control.prototype.detachEvent.call(this,e,f,b);if(e==="press"){this.rerender();}return this;};a.prototype._getPercentageMode=function(){return this._bPercentageMode;};a.prototype.setPercentage=function(p){if(p){if(p!==this.getPercentage()){this._bPercentageMode=true;this.setProperty("percentage",p);}}else{this._bPercentageMode=false;this.setProperty("percentage",null);}};a.prototype.getTooltip_AsString=function(){return this._getTooltipText();};a.prototype._isValueColorInstanceOfValueColor=function(){var v=this.getValueColor();for(var V in sap.m.ValueColor){if(V===v){return true;}}return false;};a.prototype._getTooltipText=function(){var t=this.getTooltip_Text();if(!t){t=this._getAriaAndTooltipText();}else if(this._isTooltipSuppressed()){t=null;}return t;};a.prototype._getAriaText=function(){var A=this.getTooltip_Text();if(!A||this._isTooltipSuppressed()){A=this._getAriaAndTooltipText();}return A;};a.prototype._isTooltipSuppressed=function(){var t=this.getTooltip_Text();if(t&&q.trim(t).length===0){return true;}else{return false;}};a.prototype._getAriaAndTooltipText=function(){var t;var p=this.getPercentage();if(p>100){p=100;}else if(p<0){p=0;}if(this._isValueColorInstanceOfValueColor()){t=this._rb.getText("RADIALMICROCHART_ARIA_LABEL",[this.getPercentage(),this._getStatusText()]);}else{t=this._rb.getText("RADIALMICROCHART_ARIA_LABEL",[p,sap.m.ValueColor.Neutral]);}return t;};a.prototype._getStatusText=function(){var v=this.getValueColor();switch(v){case sap.m.ValueColor.Error:return this._rb.getText("SEMANTIC_COLOR_ERROR");case sap.m.ValueColor.Critical:return this._rb.getText("SEMANTIC_COLOR_CRITICAL");case sap.m.ValueColor.Good:return this._rb.getText("SEMANTIC_COLOR_GOOD");default:return this._rb.getText("SEMANTIC_COLOR_NEUTRAL");}};return a;});
