/*
 * ! SAP UI development toolkit for HTML5 (SAPUI5)

(c) Copyright 2009-2016 SAP SE. All rights reserved
 */
sap.ui.define(['sap/ui/dt/Plugin'],function(P){"use strict";var S=P.extend("sap.ui.rta.plugin.Settings",{metadata:{library:"sap.ui.rta",properties:{commandStack:{type:"any"}},associations:{},events:{}}});S.prototype._getUnsavedChanges=function(i,c){var e;var u=this.getCommandStack().getSerializableCommands().filter(function(C){e=C.getElement().id||C.getElement().getId();if(e===i&&c.indexOf(C.getChangeType())>=0){return true;}}).map(function(C){return C.getPreparedActionData().change;});return u;};S.prototype._getEffectiveDesignTimeMetadata=function(o){var d;if(o.isInHiddenTree()){var p=o.getPublicParentAggregationOverlay();d=p.getDesignTimeMetadata();}else{d=o.getDesignTimeMetadata();}return d;};S.prototype._getSettingsAction=function(o){return this._getEffectiveDesignTimeMetadata(o).getAction("settings",o.getElementInstance());};S.prototype.isSettingsAvailable=function(o){return!!this._getSettingsAction(o);};S.prototype.isSettingsEnabled=function(o){var a=this._getSettingsAction(o);if(!a){return false;}if(typeof a.isEnabled!=="undefined"){if(typeof a.isEnabled==="function"){return a.isEnabled(o.getElementInstance());}else{return a.isEnabled;}}return true;};S.prototype.handleSettings=function(s){var o;var e=s[0].getElementInstance();var t=this;return s[0].getDesignTimeMetadata().getAction("settings").handler(e,this._getUnsavedChanges.bind(this)).then(function(c){c.forEach(function(C){o=t.getCommandFactory().getCommandFor(C.selectorControl,"settings",C.changeSpecificData);t.fireElementModified({"command":o});});})['catch'](function(E){if(E){throw E;}});};return S;},true);
