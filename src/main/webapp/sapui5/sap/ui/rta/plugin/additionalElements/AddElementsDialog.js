/*
 * ! SAP UI development toolkit for HTML5 (SAPUI5)

(c) Copyright 2009-2016 SAP SE. All rights reserved
 */
sap.ui.define(['jquery.sap.global','sap/ui/rta/library','sap/ui/rta/Utils','sap/ui/dt/OverlayRegistry','sap/ui/core/Control','sap/ui/commons/Label','sap/ui/commons/LabelDesign','sap/m/Dialog','sap/ui/model/json/JSONModel','sap/m/SearchField','sap/m/Button','sap/m/Toolbar','sap/m/ToolbarSpacer','sap/ui/model/Filter','sap/ui/model/FilterOperator','sap/ui/rta/controlAnalyzer/ControlAnalyzerFactory','sap/ui/rta/command/CommandFactory','sap/ui/rta/command/CompositeCommand','sap/m/List','sap/m/CustomListItem','sap/m/ListType','sap/m/ScrollContainer','sap/ui/model/Sorter','sap/ui/dt/ElementUtil','sap/m/VBox'],function(q,l,U,O,C,L,a,D,J,S,B,T,b,F,c,d,e,f,g,h,i,j,k,E,V){"use strict";var A=C.extend("sap.ui.rta.plugin.additionalElements.AddElementsDialog",{metadata:{library:"sap.ui.rta",properties:{"customFieldEnabled":{type:"boolean",defaultValue:false},"title":{type:"string"}},aggregations:{"_dialog":{type:"sap.ui.core.Control",visibility:"hidden",multiple:false}},events:{"opened":{},"openCustomField":{}}}});A.prototype.init=function(){var t=this;this._oTextResources=sap.ui.getCore().getLibraryResourceBundle("sap.ui.rta");this._bAscendingSortOrder=false;this._oDialog=new D().addStyleClass("sapUIRtaFieldRepositoryDialog");this.setAggregation("_dialog",this._oDialog);var m=this._createContent();var n=this._createButtons();m.forEach(function(o){t._oDialog.addContent(o);});n.forEach(function(o){t._oDialog.addButton(o);});this._oDialog.setInitialFocus(this._oInput);};A.prototype._createContent=function(){var t=this;this._oInput=new S({width:"100%",liveChange:[this._updateModelFilter,this]}).addStyleClass("resourceListIF");var r=new B({text:"",icon:"sap-icon://sort",press:[this._resortList,this]});this._oCustomFieldButton=new B({text:"",icon:"sap-icon://add",tooltip:this._oTextResources.getText("BTN_FREP_CCF"),enabled:this.getCustomFieldEnabled(),press:[this._redirectToCustomFieldCreation,this]});this._oToolbarSpacer1=new b();this.oInputFields=new T({content:[this._oInput,r,this._oToolbarSpacer1,this._oCustomFieldButton]});var o=new L({design:a.Bold,tooltip:"{tooltip}",text:{parts:[{path:"label"},{path:"referencedComplexPropertyName"},{path:"duplicateComplexName"}],formatter:function(u,R,w){if(w&&R){u+=" ("+R+")";}return u;}}});var m=new L({text:{parts:[{path:"originalLabel"}],formatter:function(u){if(u){return t._oTextResources.getText("LBL_FREP",u);}return"";}},visible:{parts:[{path:"originalLabel"}],formatter:function(u){if(u){return true;}return false;}}});var v=new V();v.addItem(o);v.addItem(m);var s=new k("label",this._bAscendingSortOrder);this._oList=new g({mode:"MultiSelect",includeItemInSelection:true,growing:false,growingScrollToLoad:false}).setNoDataText(this._oTextResources.getText("MSG_NO_FIELDS"));var n=new h({type:i.Active,selected:"{selected}",content:[v]});this._oList.bindItems({path:"/elements",template:n,sorter:s});var p=new j({content:this._oList,vertical:true,horizontal:false}).addStyleClass("sapUIRtaCCDialogScrollContainer");return[this.oInputFields,p];};A.prototype._createButtons=function(){var o=new B({text:this._oTextResources.getText("BTN_FREP_OK"),press:[this._submitDialog,this]});var m=new B({text:this._oTextResources.getText("BTN_FREP_CANCEL"),press:[this._cancelDialog,this]});return[o,m];};A.prototype._submitDialog=function(){this._oDialog.close();this._fnResolve();};A.prototype._cancelDialog=function(){this._oList.removeSelections();this._oDialog.close();this._fnReject();};A.prototype.open=function(o){var t=this;return new Promise(function(r,m){t._fnResolve=r;t._fnReject=m;t._oDialog.oPopup.attachOpened(function(){t.fireOpened();});t._oDialog.open();});};A.prototype._resortList=function(o){this._bAscendingSortOrder=!this._bAscendingSortOrder;var m=this._oList.getBinding("items");var s=[];s.push(new k("label",this._bAscendingSortOrder));m.sort(s);};A.prototype._updateModelFilter=function(o){var v=o.getParameter("newValue");var m=this._oList.getBinding("items");if((typeof v)==="string"){var n=new F("label",c.Contains,v);var p=new F("tooltip",c.Contains,v);var r=new F({filters:[n,p],and:false});m.filter([r]);}else{m.filter([]);}};A.prototype._redirectToCustomFieldCreation=function(o){this.fireOpenCustomField();this._oDialog.close();};A.prototype.setTitle=function(t){C.prototype.setProperty.call(this,"title",t,true);this._oDialog.setTitle(t);};A.prototype.setCustomFieldEnabled=function(m){C.prototype.setProperty.call(this,"customFieldEnabled",m,true);this._oCustomFieldButton.setEnabled(m);};return A;},true);
