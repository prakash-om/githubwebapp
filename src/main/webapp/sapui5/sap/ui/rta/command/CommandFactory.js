/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

(c) Copyright 2009-2016 SAP SE. All rights reserved
 */
sap.ui.define(['sap/ui/base/ManagedObject','sap/ui/rta/controlAnalyzer/ControlAnalyzerFactory','sap/ui/dt/ElementUtil','sap/ui/fl/registry/ChangeRegistry'],function(M,C,E,a){"use strict";var g=function(s,l){var r=a.getInstance().getRegistryItems({controlType:s,changeTypeName:l});if(r&&r[s]&&r[s][l]){var R=r[s][l];return R.getChangeTypeMetadata().getChangeHandler();}else{jQuery.sap.log.warning("No '"+l+"' change handler for "+s+" registered");}};var c=function(o,l,s){var n=l.getName();var A=C.getControlAnalyzerFor(o);if(A.mapSettings){s=A.mapSettings(n,o,s);}var p=A.getConfiguredElement(o);var q=p.getMetadata().getName();var r=A.getFlexChangeType(n,o,s);if(r){var t=g(q,r);if(t){l.setChangeHandler(t);l.setChangeType(r);if(o!==p&&l.setOriginalElement){var S=A._getStableElementForCommand(o);l.setOriginalElement(S);}}}else{jQuery.sap.log.warning("No "+n+" change type registered for "+q);}return true;};var f=function(o,l,A){var s;if(typeof(A)==="string"){s=A;}else{s=A&&A.changeType;}if(!s){return false;}var n=o.getMetadata().getName();var p=g(n,s);if(!p){return false;}l.setChangeHandler(p);l.setChangeType(s);return true;};var b=function(o,l,s,D){var n=s.element||sap.ui.getCore().byId(s.element.id);var A=D.getAggregationAction("createContainer",n)[0];var S=f(o,l,A);if(S){l.setCreateContainerMetadata(A);return true;}else{return false;}};var d=function(o,l,s,n){var S=s.source.publicAggregation;var A=n.createAggregationDesignTimeMetadata(S);var p=s.movedElements[0].element||sap.ui.getCore().byId(s.movedElements[0].id);var q=A.getMoveAction(p);A.destroy();return f(o,l,q);};var e=function(o,l,s,D){var r=s.renamedElement;var A=D.getAction("rename",r);var S=f(o,l,A);if(S){l.setRenameMetadata(A);return true;}else{return false;}};var h=function(o,l,s,D){var r=s.removedElement||sap.ui.getCore().byId(s.removedElement.id);var A=D.getAction("remove",r);var S=f(o,l,A);if(S){l.setRemoveMetadata(A);return true;}else{return false;}};var i=function(o,l,s,D){var n=s.element;var A=D.getAggregationAction("addODataProperty",n)[0];return f(o,l,A);};var j=function(o,l,s,D){var r=s.hiddenParent;var A=D.getAction("reveal",r);return f(o,l,A);};var F=function(o,s){var A=C.getControlAnalyzerFor(o);return A.getCommandClass(s);};var G=function(o){if(o.getMetadata){var A=C.getControlAnalyzerFor(o);return A.getConfiguredElement(o);}else{return o;}};var m={"hide":{findClass:F,configure:c},"unhide":{findClass:F,configure:c},"stash":{clazz:'sap.ui.rta.command.Stash'},"unstash":{clazz:'sap.ui.rta.command.Unstash'},"group":{clazz:'sap.ui.rta.command.Group'},"ungroup":{clazz:'sap.ui.rta.command.Ungroup'},"add":{findClass:F,configure:c},"createContainer":{clazz:'sap.ui.rta.command.CreateContainer',configure:b},"move":{clazz:'sap.ui.rta.command.Move',configure:d},"remove":{clazz:'sap.ui.rta.command.Remove',configure:h},"composite":{clazz:'sap.ui.rta.command.CompositeCommand'},"rename":{clazz:'sap.ui.rta.command.Rename',configure:e},"property":{clazz:'sap.ui.rta.command.Property'},"bindProperty":{clazz:'sap.ui.rta.command.BindProperty'},"addODataProperty":{clazz:'sap.ui.rta.command.AddODataProperty',configure:i},"reveal":{clazz:'sap.ui.rta.command.Reveal',configure:j},"settings":{clazz:'sap.ui.rta.command.Settings'}};var k=M.extend("sap.ui.rta.command.CommandFactory",{metadata:{library:"sap.ui.rta",properties:{},associations:{},events:{}}});k.getCommandFor=function(o,s,S,D){s=s[0].toLowerCase()+s.slice(1);var l=m[s];if(!l){throw new Error("Command '"+s+"' doesn't exist, check typing");}var n;if(l.findClass){n=l.findClass(o,s);}else{n=l.clazz;}jQuery.sap.require(n);var p=jQuery.sap.getObject(n);var q=G(o);S=jQuery.extend(S,{element:q,name:s});var r=new p(S);var t=true;if(l.configure){t=l.configure(o,r,S,D);}if(t){r.prepareActionData();return r;}else{r.destroy();}};return k;},true);
