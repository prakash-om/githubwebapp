jQuery.sap.declare('sap.ui.rta.library-all');if(!jQuery.sap.isDeclared('sap.ui.rta.ModelConverter')){
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

(c) Copyright 2009-2016 SAP SE. All rights reserved
 */
jQuery.sap.declare('sap.ui.rta.ModelConverter');jQuery.sap.require('jquery.sap.global');jQuery.sap.require('sap.ui.comp.odata.FieldSelectorModelConverter');jQuery.sap.require('sap.ui.dt.ElementUtil');sap.ui.define("sap/ui/rta/ModelConverter",['jquery.sap.global','sap/ui/comp/odata/FieldSelectorModelConverter','sap/ui/dt/ElementUtil'],function(q,F,E){"use strict";var M={};M.getConvertedModelWithBoundAndRenamedLabels=function(c,e,C){var t=this;var m=c.getModel();return this._getModelConverter(m).then(function(f){return t._getFieldModel(c,f,e,C);});};M._getModelConverter=function(m){var o=m.getMetaModel();return o.loaded().then(function(){return new F(m);},function(r){q.sap.log.error("MetadataModel could not be loaded",r);});};M._getIgnoredFields=function(c){if(c&&c.getIgnoredFields){var C=c.getIgnoredFields();if(C){var i=C.split(",");return i;}}return[];};M._getFieldModel=function(c,f,e,C){var I=this._getIgnoredFields(c);var o=f.getConvertedModel(e,I);if(!C){throw new Error("ModelConverter: no usable change controller instance found!");}var v=C.findVisibleAndBoundFieldsAndLabelNames(c);var V=v.visibleAndBoundFields;var m=v.fieldsAndLabelNames;var a=v.fieldsAndBoundPropertyName;var b=v.boundFieldsId;var s;for(var z=0;z<e.length;z++){s=e[z];for(var i=0;i<o[s].length;i++){var A=o[s][i];var d=f.getMetaDataAnalyzer()._getNameOfPropertyUsingComplexType(s,A.entityName);if(V[A.name]){A.checked=true;}A.controlId=b[A.name];if(d){A.isComplexType=true;A.complexTypeName=d;if(V[d+"/"+A.name]){A.checked=true;A.controlId=V[d+"/"+A.name];}}var g;var p;if(A.isComplexType){p=A.complexTypeName+"/"+A.name;g=m[p];A.boundProperty=a[p];}else{g=m[A.name];A.boundProperty=a[A.name];}if(g&&g!==A["sap:label"]){A.fieldLabel=g;}}}return o[s];};return M;},true);};if(!jQuery.sap.isDeclared('sap.ui.rta.command.BaseCommand')){jQuery.sap.declare('sap.ui.rta.command.BaseCommand');jQuery.sap.require('sap.ui.base.ManagedObject');sap.ui.define("sap/ui/rta/command/BaseCommand",['sap/ui/base/ManagedObject'],function(M){"use strict";var B=M.extend("sap.ui.rta.command.BaseCommand",{metadata:{library:"sap.ui.rta",properties:{element:{type:"sap.ui.core.Element"},elementId:{type:"string"},name:{type:"string"}},associations:{},events:{}}});B.ERROR_UNKNOWN_ID="no element for id: ";B.prototype.prepareActionData=function(){};B.prototype._executeWithElement=function(e){};B.prototype.execute=function(){this._withElement(this._executeWithElement.bind(this));};B.prototype._undoWithElement=function(e){};B.prototype.undo=function(){this._withElement(this._undoWithElement.bind(this));};B.prototype._withElement=function(f){var e=this._getElement();if(e){f(e);}else{jQuery.sap.log.error(this.getMetadata().getName(),B.ERROR_UNKNOWN_ID+this.getElementId());}};B.prototype.serialize=function(){};B.prototype.isEnabled=function(){return true;};B.deserialize=function(c){};B.prototype._getElement=function(){var e=this.getElement();if(!e){e=sap.ui.getCore().byId(this.getElementId());this.setElement(e);}return e;};return B;},true);};if(!jQuery.sap.isDeclared('sap.ui.rta.command.CompositeCommand')){jQuery.sap.declare('sap.ui.rta.command.CompositeCommand');sap.ui.define("sap/ui/rta/command/CompositeCommand",['sap/ui/rta/command/BaseCommand'],function(B){"use strict";var C=B.extend("sap.ui.rta.command.CompositeCommand",{metadata:{library:"sap.ui.rta",properties:{},aggregations:{commands:{type:"sap.ui.rta.command.BaseCommand",multiple:true}},events:{}}});C.prototype.execute=function(){this._forEachCommand(function(c){c.execute();});};C.prototype.undo=function(){this._forEachCommandInReverseOrder(function(c){c.undo();});};C.prototype._forEachCommand=function(d){var c=this.getCommands();c.forEach(d,this);};C.prototype._forEachCommandInReverseOrder=function(d){var c=this.getCommands();for(var i=c.length-1;i>=0;i--){d.call(this,c[i]);}};return C;},true);};if(!jQuery.sap.isDeclared('sap.ui.rta.command.FlexCommand')){jQuery.sap.declare('sap.ui.rta.command.FlexCommand');jQuery.sap.require('sap.ui.fl.FlexControllerFactory');jQuery.sap.require('sap.ui.fl.changeHandler.JsControlTreeModifier');jQuery.sap.require('sap.ui.fl.Utils');sap.ui.define("sap/ui/rta/command/FlexCommand",['sap/ui/rta/command/BaseCommand',"sap/ui/fl/FlexControllerFactory","sap/ui/fl/changeHandler/JsControlTreeModifier","sap/ui/fl/Utils"],function(B,F,J,U){"use strict";var a=B.extend("sap.ui.rta.command.FlexCommand",{metadata:{library:"sap.ui.rta",properties:{changeHandler:{type:"any"},changeType:{type:"string"}},associations:{},events:{}}});a.FORWARD=true;a.BACKWARD=false;a.prototype.getPreparedActionData=function(f){f=(f===a.FORWARD||f===a.BACKWARD)?f:true;if(f){return this._forwardPreparedActionData;}else{return this._backwardPreparedActionData;}};a.prototype.prepareActionData=function(){this._forwardPreparedActionData=this._getForwardActionData(this._getElement());this._backwardPreparedActionData=this._getBackwardActionData(this._getElement());};a.prototype._executeWithElement=function(e){var c=this._getForwardActionData(e);this._applyChange(c);};a.prototype._getForwardActionData=function(e){return{change:this._completeChangeContent({changeType:this.getChangeType(),selector:{id:this._getElement().getId()}}),selectorElement:this._getElement()};};a.prototype._getBackwardActionData=function(e){};a.prototype._undoWithElement=function(e){var p=this.getPreparedActionData(a.BACKWARD);if(p){this._applyChange(p);}else{jQuery.log.warning("Undo functionality not supported for element with id "+e.getId());}};a.prototype._completeChangeContent=function(s){var c=this.getElement().appComponent||this.getElement();var f=F.createForControl(c);return f.createChange(s,this.getElement());};a.prototype._applyChange=function(c){var C=c.change||c;var A=U.getAppComponentForControl(this.getElement());var s=J.bySelector(C.getSelector(),A);this.getChangeHandler().applyChange(C,s,{modifier:J,appComponent:A});};return a;},true);};if(!jQuery.sap.isDeclared('sap.ui.rta.command.Hide')){
/*
 * ! SAP UI development toolkit for HTML5 (SAPUI5)

(c) Copyright 2009-2016 SAP SE. All rights reserved
 */
jQuery.sap.declare('sap.ui.rta.command.Hide');jQuery.sap.require('sap.ui.fl.changeHandler.HideControl');sap.ui.define("sap/ui/rta/command/Hide",['sap/ui/rta/command/FlexCommand',"sap/ui/fl/changeHandler/HideControl"],function(F,H){"use strict";var a=F.extend("sap.ui.rta.command.Hide",{metadata:{library:"sap.ui.rta",properties:{changeType:{type:"string",defaultValue:"hideControl"}},associations:{},events:{}}});a.prototype.init=function(){this.setChangeHandler(H);};a.prototype._undoWithElement=function(e){e.setVisible(true);};a.prototype.serialize=function(){return{changeType:this.getChangeType(),selector:{id:this._getElement().getId()}};};return a;},true);};if(!jQuery.sap.isDeclared('sap.ui.rta.command.HideForm')){jQuery.sap.declare('sap.ui.rta.command.HideForm');jQuery.sap.require('sap.ui.fl.changeHandler.HideControl');sap.ui.define("sap/ui/rta/command/HideForm",['sap/ui/rta/command/FlexCommand','sap/ui/rta/command/Hide',"sap/ui/fl/changeHandler/HideControl"],function(F,H,a){"use strict";var b=H.extend("sap.ui.rta.command.HideForm",{metadata:{library:"sap.ui.rta",properties:{originalElement:{type:"object"},changeType:{type:"string",defaultValue:"hideControl"},groupId:{type:"string"},groupIndex:{type:"int"},nextGroupIndex:{type:"int",defaultValue:-1},fields:{type:"array"}},associations:{},events:{}}});b.FORWARD=true;b.BACKWARD=false;b.prototype.init=function(){};b.prototype._getSpecificChangeInfo=function(f){var e=this.getElement();var o=this.getOriginalElement();var s={};s.selector={};s.selector.id=e.getId();s.changeType=this.getChangeType();s.removedElement={id:o.getId()};if(o instanceof sap.ui.core.Title){this._setGroupInfo(o);}return s;};b.prototype._setGroupInfo=function(t){var c=this;var C=this.getElement().getContent();var f=[];C.some(function(o,i){if(o===t){c.setGroupId(t.getId());c.setGroupIndex(i);}if(c.getGroupIndex()<i){if(o instanceof sap.ui.core.Title){c.setNextGroupIndex(i);return true;}else{if(o.getVisible()===true){f.push(o);}}}});this.setFields(f);};b.prototype._getFlexChange=function(f,e){var s=this._getSpecificChangeInfo(f);var c=this._completeChangeContent(s);return{change:c,selectorElement:e};};b.prototype._getForwardActionData=function(e){return this._getFlexChange(b.FORWARD,e);};b.prototype._getBackwardActionData=function(e){return this._getFlexChange(b.BACKWARD,e);};b.prototype._undoWithElement=function(e){var c=this.getOriginalElement();var C=e.getContent();var s=-1;if(this.getChangeType()==="hideSimpleFormField"){C.some(function(f,i){if(f===c){s=i;f.setVisible(true);}if(s>=0&&i>s){if((f instanceof sap.m.Label)||(f instanceof sap.ui.core.Title)){return true;}else{f.setVisible(true);}}});}else if(this.getChangeType()==="removeSimpleFormGroup"){var t=sap.ui.getCore().byId(this.getGroupId());this.getElement().insertContent(t,this.getGroupIndex());if((this.getGroupIndex()===0)&&(this.getNextGroupIndex()>0)){var n=e.removeContent(1);e.insertContent(n,this.getNextGroupIndex());}this.getFields().forEach(function(f){f.setVisible(true);});this.setOriginalElement(t);}};b.prototype.serialize=function(){return this._getSpecificChangeInfo(b.FORWARD);};return b;},true);};if(!jQuery.sap.isDeclared('sap.ui.rta.command.Move')){jQuery.sap.declare('sap.ui.rta.command.Move');jQuery.sap.require('jquery.sap.global');sap.ui.define("sap/ui/rta/command/Move",['jquery.sap.global','sap/ui/rta/command/FlexCommand'],function(q,F){"use strict";var M=F.extend("sap.ui.rta.command.Move",{metadata:{library:"sap.ui.rta",properties:{movedElements:{type:"array"},target:{type:"object"},source:{type:"object"}},associations:{},events:{}}});M.prototype._getSpecificChangeInfo=function(f){var s=f?this.getSource():this.getTarget();var t=f?this.getTarget():this.getSource();var S=s.parent||sap.ui.getCore().byId(s.id);if(s.parent){s.id=s.parent.getId();delete s.parent;}if(t.parent){t.id=t.parent.getId();delete t.parent;}var m={changeType:this.getChangeType(),selector:{id:S.getId()},source:s,target:t,movedElements:[]};this.getMovedElements().forEach(function(a){m.movedElements.push({id:a.id||a.element.getId(),sourceIndex:f?a.sourceIndex:a.targetIndex,targetIndex:f?a.targetIndex:a.sourceIndex});});var C=this.getChangeHandler();return C.buildStableChangeInfo(m);};M.prototype._getFlexChange=function(f){var p=this.getPreparedActionData(f);if(!p){var s=this._getSpecificChangeInfo(f);p=this._completeChangeContent(s);}return p;};M.prototype._getForwardActionData=function(e){return this._getFlexChange(F.FORWARD);};M.prototype._getBackwardActionData=function(e){return this._getFlexChange(F.BACKWARD);};M.prototype.serialize=function(){return this._getSpecificChangeInfo(F.FORWARD);};return M;},true);};if(!jQuery.sap.isDeclared('sap.ui.rta.command.Remove')){jQuery.sap.declare('sap.ui.rta.command.Remove');sap.ui.define("sap/ui/rta/command/Remove",['sap/ui/rta/command/FlexCommand'],function(F){"use strict";var R=F.extend("sap.ui.rta.command.Remove",{metadata:{library:"sap.ui.rta",properties:{removedElement:{type:"object"},removeMetadata:{type:"object"}},associations:{},events:{}}});R.prototype._getSpecificChangeInfo=function(){var s={changeType:this.getChangeType(),removedElement:{id:this.getRemovedElement().getId()}};var C=this.getChangeHandler();return C.buildStableChangeInfo(s);};R.prototype._getFlexChange=function(){var p=this.getPreparedActionData(F.FORWARD);if(!p){var s=this._getSpecificChangeInfo();p=this._completeChangeContent(s);}return p;};R.prototype.undo=function(){var s=this.getPreparedActionData(F.BACKWARD);var r=this.getRemoveMetadata().restoreState;if(r){r.call(this.getElement(),this.getRemovedElement(),s);}else{jQuery.sap.log.error("No restoreState implementation found for remove action ",this.getElement().getMetadata().getName()+".designtime");}};R.prototype._getForwardActionData=function(e){return this._getFlexChange();};R.prototype._getBackwardActionData=function(e){var g=this.getRemoveMetadata().getState;if(g){return g.call(this.getElement(),this.getRemovedElement());}else{jQuery.sap.log.error("No getState implementation found for remove action ",this.getElement().getMetadata().getName()+".designtime");}};R.prototype.serialize=function(){return this._getSpecificChangeInfo(F.FORWARD);};return R;},true);};if(!jQuery.sap.isDeclared('sap.ui.rta.command.Rename')){jQuery.sap.declare('sap.ui.rta.command.Rename');jQuery.sap.require('jquery.sap.global');jQuery.sap.require('sap.ui.comp.smartform.flexibility.changes.RenameGroup');jQuery.sap.require('sap.ui.comp.smartform.flexibility.changes.RenameField');jQuery.sap.require('sap.ui.fl.Change');sap.ui.define("sap/ui/rta/command/Rename",['jquery.sap.global','sap/ui/rta/command/FlexCommand','sap/ui/comp/smartform/flexibility/changes/RenameGroup','sap/ui/comp/smartform/flexibility/changes/RenameField','sap/ui/fl/Change'],function(q,F,R,a,C){"use strict";var b=F.extend("sap.ui.rta.command.Rename",{metadata:{library:"sap.ui.rta",properties:{renamedElement:{type:"object"},newValue:{type:"string",defaultValue:"new text"},oldValue:{type:"string",defaultValue:undefined},renameMetadata:{type:"object"}},associations:{},events:{}}});b.prototype._getSpecificChangeInfo=function(f){var s={changeType:this.getChangeType(),selector:{id:this.getElement().getId()},renamedElement:{id:this.getRenamedElement().getId()},value:f?this.getNewValue():this.getOldValue()};return s;};b.prototype._getFlexChange=function(f){var p=this.getPreparedActionData(f);if(!p){var s=this._getSpecificChangeInfo(f);p=this._completeChangeContent(s);}return p;};b.prototype.undo=function(){var s=this.getPreparedActionData(F.BACKWARD);var r=this.getRenameMetadata().restoreState;if(r){r.call(null,this.getRenamedElement(),s);}else{q.sap.log.error("No restoreState implementation found for rename action ",this.getRenamedElement().getMetadata().getName()+".designtime");}};b.prototype._getForwardActionData=function(e){return this._getFlexChange(F.FORWARD,e);};b.prototype._getBackwardActionData=function(e){var g=this.getRenameMetadata().getState;if(g){return g.call(null,this.getRenamedElement());}else{q.sap.log.error("No getState implementation found for rename action ",this.getRenamedElement().getMetadata().getName()+".designtime");}};b.prototype.serialize=function(){return this._getSpecificChangeInfo(F.FORWARD,this._getElement());};return b;},true);};if(!jQuery.sap.isDeclared('sap.ui.rta.command.Reveal')){jQuery.sap.declare('sap.ui.rta.command.Reveal');sap.ui.define("sap/ui/rta/command/Reveal",['sap/ui/rta/command/FlexCommand'],function(F){"use strict";var R=F.extend("sap.ui.rta.command.Reveal",{metadata:{library:"sap.ui.rta",properties:{revealedElementId:{type:"string"},hiddenParent:"object"}}});R.prototype._getSpecificChangeInfo=function(){var s={changeType:this.getChangeType()};if(this.getRevealedElementId()){s.revealedElementId=this.getRevealedElementId();}return s;};R.prototype._getFlexChange=function(e){var p=this.getPreparedActionData();if(!p){var s=this._getSpecificChangeInfo();var r=sap.ui.getCore().byId(this.getRevealedElementId());var c=this._completeChangeContent(s);p={change:c,selectorElement:r};}return p;};R.prototype._getForwardActionData=function(e){return this._getFlexChange(e);};return R;},true);};if(!jQuery.sap.isDeclared('sap.ui.rta.command.Settings')){jQuery.sap.declare('sap.ui.rta.command.Settings');sap.ui.define("sap/ui/rta/command/Settings",['sap/ui/rta/command/FlexCommand'],function(F){"use strict";var S=F.extend("sap.ui.rta.command.Settings",{metadata:{library:"sap.ui.rta",properties:{content:{type:"any"}},associations:{},events:{}}});S.FORWARD=true;S.BACKWARD=false;S.prototype._getSpecificChangeInfo=function(f){var s={changeType:this.getChangeType(),content:this.getContent()};return s;};S.prototype._getFlexChange=function(f){var s=this._getSpecificChangeInfo(f);var c=this._completeChangeContent(s);return{change:c,selectorElement:this._getElement()};};S.prototype._getForwardActionData=function(e){return this._getFlexChange(S.FORWARD);};S.prototype._getBackwardActionData=function(e){return this._getFlexChange(S.BACKWARD);};S.prototype.serialize=function(){return this._getSpecificChangeInfo(S.FORWARD);};S.prototype.execute=function(){if(this.getElement().getMetadata){F.prototype.execute.apply(this,arguments);}};S.prototype.undo=function(){if(this.getElement().getMetadata){F.prototype.undo.apply(this,arguments);}};return S;},true);};if(!jQuery.sap.isDeclared('sap.ui.rta.command.Stack')){jQuery.sap.declare('sap.ui.rta.command.Stack');jQuery.sap.require('sap.ui.base.ManagedObject');sap.ui.define("sap/ui/rta/command/Stack",['sap/ui/base/ManagedObject'],function(M){"use strict";var S=M.extend("sap.ui.rta.command.Stack",{metadata:{library:"sap.ui.rta",properties:{},aggregations:{commands:{type:"sap.ui.rta.command.BaseCommand",multiple:true}},events:{modified:{}}}});S.prototype._toBeExecuted=-1;S.prototype._getCommandToBeExecuted=function(){return this.getCommands()[this._toBeExecuted];};S.prototype.pushExecutedCommand=function(c){this.push(c,true);};S.prototype.push=function(c,e){if(this._bUndoneCommands){this._bUndoneCommands=false;while(this._toBeExecuted>-1){this.pop();}}this.insertCommand(c,0);if(!e){this._toBeExecuted++;}this.fireModified();};S.prototype.top=function(){return this.getCommands()[0];};S.prototype.pop=function(){if(this._toBeExecuted>-1){this._toBeExecuted--;}return this.removeCommand(0);};S.prototype.removeCommand=function(o,s){var r=this.removeAggregation("commands",o,s);this.fireModified();return r;};S.prototype.removeAllCommands=function(s){var c=this.removeAllAggregation("commands",s);this._toBeExecuted=-1;this.fireModified();return c;};S.prototype.isEmpty=function(){return this.getCommands().length===0;};S.prototype.execute=function(){var c=this._getCommandToBeExecuted();if(c){try{c.execute();}catch(e){this.pop();throw(e);}this._toBeExecuted--;this.fireModified();}};S.prototype._unExecute=function(){if(this.canUndo()){this._bUndoneCommands=true;this._toBeExecuted++;var c=this._getCommandToBeExecuted();if(c){c.undo();this.fireModified();}}};S.prototype.canUndo=function(){return(this._toBeExecuted+1)<this.getCommands().length;};S.prototype.undo=function(){this._unExecute();};S.prototype.canRedo=function(){return!!this._getCommandToBeExecuted();};S.prototype.redo=function(){this.execute();};S.prototype.pushAndExecute=function(c){this.push(c);this.execute();};S.prototype.serialize=function(){var r=[];var c=this.getSerializableCommands();c.forEach(function(C){var s=C.serialize();if(Array.isArray(s)){r.concat(s);}else{r.push(s);}});return r;};S.prototype.getSerializableCommands=function(){var s=[];var c=this.getCommands();for(var i=c.length-1;i>this._toBeExecuted;i--){var a=this._getSubCommands(c[i]);s=s.concat(a);}return s;};S.prototype._getSubCommands=function(c){var t=this;var C=[];if(c.getCommands){c.getCommands().forEach(function(s){var a=t._getSubCommands(s);C=C.concat(a);});}else{C.push(c);}return C;};return S;},true);};if(!jQuery.sap.isDeclared('sap.ui.rta.command.Stash')){jQuery.sap.declare('sap.ui.rta.command.Stash');jQuery.sap.require('sap.ui.fl.changeHandler.StashControl');sap.ui.define("sap/ui/rta/command/Stash",['sap/ui/rta/command/FlexCommand',"sap/ui/fl/changeHandler/StashControl"],function(F,S){"use strict";var a=F.extend("sap.ui.rta.command.Stash",{metadata:{library:"sap.ui.rta",properties:{changeType:{type:"string",defaultValue:"stashControl"}},associations:{},events:{}}});a.prototype.init=function(){this.setChangeHandler(S);};a.prototype._undoWithElement=function(e){e=sap.ui.getCore().byId(e.getId());this.setElement(e);e.setStashed(false);e.setVisible(true);};a.prototype.serialize=function(){return{changeType:this.getChangeType(),selector:{id:this._getElement().getId()}};};return a;},true);};if(!jQuery.sap.isDeclared('sap.ui.rta.command.Unhide')){jQuery.sap.declare('sap.ui.rta.command.Unhide');jQuery.sap.require('sap.ui.fl.changeHandler.UnhideControl');sap.ui.define("sap/ui/rta/command/Unhide",['sap/ui/rta/command/FlexCommand',"sap/ui/fl/changeHandler/UnhideControl"],function(F,U){"use strict";var a=F.extend("sap.ui.rta.command.Unhide",{metadata:{library:"sap.ui.rta",properties:{changeType:{type:"string",defaultValue:"unhideControl"}},associations:{},events:{}}});a.prototype.init=function(){this.setChangeHandler(U);};a.prototype._undoWithElement=function(e){e.setVisible(false);};a.prototype.serialize=function(){return{changeType:this.getChangeType(),selector:{id:this._getElement().getId()}};};return a;},true);};if(!jQuery.sap.isDeclared('sap.ui.rta.command.UnhideForm')){jQuery.sap.declare('sap.ui.rta.command.UnhideForm');jQuery.sap.require('sap.ui.fl.changeHandler.UnhideControl');sap.ui.define("sap/ui/rta/command/UnhideForm",['sap/ui/rta/command/FlexCommand','sap/ui/rta/command/Unhide',"sap/ui/fl/changeHandler/UnhideControl"],function(F,U,a){"use strict";var b=U.extend("sap.ui.rta.command.UnhideForm",{metadata:{library:"sap.ui.rta",properties:{originalElement:{type:"object"},changeType:{type:"string",defaultValue:"unhideControl"}},associations:{},events:{}}});b.FORWARD=true;b.BACKWARD=false;b.prototype.init=function(){};b.prototype._getSpecificChangeInfo=function(f){var e=this.getElement();var s={};s.selector={};s.selector.id=e.getId();s.changeType=this.getChangeType();s.sUnhideId=this.getOriginalElement().getId();return s;};b.prototype._getFlexChange=function(f,e){var s=this._getSpecificChangeInfo(f);var c=this._completeChangeContent(s);return{change:c,selectorElement:e};};b.prototype._getForwardActionData=function(e){return this._getFlexChange(b.FORWARD,e);};b.prototype._getBackwardActionData=function(e){return this._getFlexChange(b.BACKWARD,e);};b.prototype._undoWithElement=function(e){var c=this.getOriginalElement();var C=e.getContent();if(this.getChangeType()==="unhideSimpleFormField"){var s=-1;C.some(function(f,i){if(f===c){s=i;f.setVisible(false);}if(s>=0&&i>s){if((f instanceof sap.m.Label)||(f instanceof sap.ui.core.Title)){return true;}else{f.setVisible(false);}}});}};b.prototype.serialize=function(){return this._getSpecificChangeInfo(b.FORWARD);};return b;},true);};if(!jQuery.sap.isDeclared('sap.ui.rta.command.Unstash')){jQuery.sap.declare('sap.ui.rta.command.Unstash');jQuery.sap.require('sap.ui.fl.changeHandler.UnstashControl');sap.ui.define("sap/ui/rta/command/Unstash",['sap/ui/rta/command/FlexCommand',"sap/ui/fl/changeHandler/UnstashControl"],function(F,U){"use strict";var a=F.extend("sap.ui.rta.command.Unstash",{metadata:{library:"sap.ui.rta",properties:{changeType:{type:"string",defaultValue:"unstashControl"},parentAggregationName:{type:"string",defaultValue:""},index:{type:"int",defaultValue:0}},associations:{},events:{}}});a.prototype.init=function(){this.setChangeHandler(U);};a.prototype._getForwardActionData=function(e){return this._getFlexChange(F.FORWARD);};a.prototype._getBackwardActionData=function(e){return this._getFlexChange(F.BACKWARD);};a.prototype._undoWithElement=function(e){e=sap.ui.getCore().byId(e.getId());this.setElement(e);e.setStashed(true);e.setVisible(false);};a.prototype._getFlexChange=function(f){return this._completeChangeContent({content:{parentAggregationName:this.getParentAggregationName(),index:this.getIndex()},changeType:this.getChangeType(),selectorElement:this._getElement(),selector:{id:this._getElement().getId()}});};a.prototype.serialize=function(){return{changeType:this.getChangeType(),selector:{id:this._getElement().getId()},content:{parentAggregationName:this.getParentAggregationName(),index:this.getIndex()}};};return a;},true);};if(!jQuery.sap.isDeclared('sap.ui.rta.controlAnalyzer.Base')){
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

(c) Copyright 2009-2016 SAP SE. All rights reserved
 */
jQuery.sap.declare('sap.ui.rta.controlAnalyzer.Base');jQuery.sap.require('sap.ui.base.ManagedObject');jQuery.sap.require('sap.ui.dt.ElementUtil');jQuery.sap.require('sap.ui.fl.Utils');sap.ui.define("sap/ui/rta/controlAnalyzer/Base",['sap/ui/base/ManagedObject','sap/ui/dt/ElementUtil','sap/ui/fl/Utils'],function(M,E,F){"use strict";var e=["sap.ui.comp.smartform.SmartForm","sap.ui.comp.smartform.Group","sap.ui.comp.smartform.GroupElement","sap.uxap.ObjectPageSection","sap.uxap.ObjectPageLayout"];if(F.isVendorLayer()){e=e.concat(["sap.ui.comp.smartfilterbar.SmartFilterBar","sap.ui.comp.smarttable.SmartTable","sap.uxap.ObjectPageHeader","sap.uxap.ObjectPageHeaderActionButton","sap.ui.table.Column"]);}var B=M.extend("sap.ui.rta.controlAnalyzer.Base",{constructor:function(){sap.ui.base.ManagedObject.prototype.constructor.apply(this,arguments);this._mAvailableElements={};this._mHiddenElements={};},metadata:{library:"sap.ui.rta",properties:{control:"sap.ui.core.Control",selectedControl:"sap.ui.core.Control",prepared:{type:"boolean",defaultValue:false}}}});B.prototype._raiseIllegalState=function(){jQuery.sap.log.error("Illegal state, analyzer is not prepared");};B.prototype.prepare=function(){this.setPrepared(true);};B.prototype.getAvailableElements=function(){if(!this.getPrepared()){this._raiseIllegalState();}return this._mAvailableElements;};B.prototype.getHiddenElements=function(){if(!this.getPrepared()){this._raiseIllegalState();}return this._mHiddenElements;};B.prototype.mapSpecificChangeData=function(t,s){return s;};B.prototype.getControlsFieldCollection=function(c){};B.prototype.createChangeData=function(c,C,h){return null;};B.prototype.findVisibleAndBoundFieldsAndLabelNames=function(c){};B.prototype.isCustomFieldAvailable=function(c){return Promise.resolve().then(function(){return false;});};B.prototype.checkTargetZone=function(p,a,m){return true;};B.prototype.getFlexChangeType=function(t,o,s){return null;};B.prototype.getCommandClass=function(c){var C;switch(c){case"rename":C='sap.ui.rta.command.Rename';break;case"hide":C='sap.ui.rta.command.Hide';break;case"unhide":C='sap.ui.rta.command.Unhide';break;case"add":C='sap.ui.rta.command.AddSmart';break;default:break;}return C;};B.prototype.getConfiguredElement=function(m,c){var C=m.context?m.context:m;return C;};B.prototype.isMandatory=function(o){return false;};B.prototype.isHideable=function(o){return false;};B.prototype.isRenamable=function(o){return this.isEditable(o)&&this.getRenamableControl(o);};B.prototype.getRenamableControl=function(o){return null;};return B;},true);};if(!jQuery.sap.isDeclared('sap.ui.rta.library')){jQuery.sap.declare('sap.ui.rta.library');jQuery.sap.require('jquery.sap.global');jQuery.sap.require('sap.ui.core.Core');jQuery.sap.require('sap.ui.core.library');sap.ui.define("sap/ui/rta/library",['jquery.sap.global','sap/ui/core/Core','sap/ui/core/library'],function(q,C,c){"use strict";sap.ui.getCore().initLibrary({name:"sap.ui.rta",version:"1.44.4",dependencies:["sap.ui.core","sap.m","sap.ui.fl"],types:[],interfaces:[],controls:["sap.ui.rta.ContextMenu","sap.ui.rta.ui.ToolsMenu","sap.ui.rta.AddElementsDialog"],elements:[]});return sap.ui.rta;},true);};if(!jQuery.sap.isDeclared('sap.ui.rta.model.ElementPreprocessor')){jQuery.sap.declare('sap.ui.rta.model.ElementPreprocessor');jQuery.sap.require('jquery.sap.global');sap.ui.define("sap/ui/rta/model/ElementPreprocessor",['jquery.sap.global'],function(q){"use strict";var E=function(m){this._oMetadataAnalyzer=m;this._aEntityTypes=[];this.invisibleFields={};};E.prototype._updateAndFilterFields=function(F,i,I,k){var v=[];for(var f=0;f<F.length;f++){var c=F[f];if(c.visible===false){this.invisibleFields[k]=this.invisibleFields[k]||[];if(this.invisibleFields[k].indexOf(c)===-1){c.isComplexType=I;this.invisibleFields[k].push(c);}continue;}var b=this._isFieldOnIgnoreList(c,i,I);var a=this._isFieldBlacklisted(c);if(!b&&!a){if(this._isComplexType(c)===true){var V=this._resolveComplexTypeToFlatFieldList(c,i);if(V){v=v.concat(V);}}else{v.push(c);}}}return v;};E.prototype._isComplexType=function(f){if(f&&f.type){if(f.type.toLowerCase().indexOf("edm")!==0){return true;}}return false;};E.prototype._isFieldBlacklisted=function(c){if(c){if(c.name.toLowerCase().indexOf("uxfc")===0){return true;}else if(c.type.toLowerCase()==="edm.time"){return true;}}return false;};E.prototype._resolveComplexTypeToFlatFieldList=function(c,I){var r=[];var s=this._oMetadataAnalyzer.getSchemaDefinition();if(c&&c.type&&s){var t=this._getComplexTypeName(c);if(t){var C=s.complexType;var i=0;for(i=0;i<C.length;i++){var o=C[i];o["complexTypePropertyName"]=c.name;o.entityName=c.entityName;if(o.name===t){r=this._getFieldsFromComplexType(o,I);break;}}}}return r;};E.prototype._getFieldsFromComplexType=function(c,I){var f=this._oMetadataAnalyzer.getFieldsByComplexTypeName(c.name);if(f){for(var i=0;i<f.length;i++){f[i]["isComplexProperty"]=true;f[i]["entityName"]=c.entityName;f[i]["complexTypePropertyName"]=c.complexTypePropertyName;}return this._updateAndFilterFields(f,I,true,c.name);}return[];};E.prototype._getComplexTypeName=function(c){var t=c.type.split(".");if(t.length===2){return t[1];}return null;};E.prototype._isFieldOnIgnoreList=function(c,i,I){if(i){var n=this._aEntityTypes.length;var Q=c.entityName+"."+c.name;if(n===1&&!I){if(i.indexOf(c.name)!==-1||i.indexOf(Q)!==-1){return true;}}else if(i.indexOf(Q)!==-1){return true;}}return false;};E.prototype._getEntityTypes=function(v,a){var b=[];var l;var c;if(!this._oMetadataAnalyzer||!this._oMetadataAnalyzer._oSchemaDefinition){return[];}var A=this._oMetadataAnalyzer._oSchemaDefinition.entityType;if(!v){c=[];for(var t=0;t<A.length;t++){c.push(A[t].name);}}if(!c){c=this._convertEntityTypesToArray(v);}for(var e=0;e<c.length;e++){l=this._oMetadataAnalyzer.getEntityLabelByEntityTypeName(c[e]);b.push({key:c[e],label:l||c[e]});}return b;};E.prototype._convertEntityTypesToArray=function(e){if(typeof(e)==="string"){var r=e.replace(/ /g,'');return r.split(',');}if(q.isArray(e)){return e;}return undefined;};E.prototype.destroy=function(){if(this._oMetadataAnalyzer&&this._oMetadataAnalyzer.destroy){this._oMetadataAnalyzer.destroy();}this._oMetadataAnalyzer=null;this._aEntityTypes=null;};return E;},true);};if(!jQuery.sap.isDeclared('sap.ui.rta.plugin.Settings')){
/*
 * ! SAP UI development toolkit for HTML5 (SAPUI5)

(c) Copyright 2009-2016 SAP SE. All rights reserved
 */
jQuery.sap.declare('sap.ui.rta.plugin.Settings');jQuery.sap.require('sap.ui.dt.Plugin');sap.ui.define("sap/ui/rta/plugin/Settings",['sap/ui/dt/Plugin'],function(P){"use strict";var S=P.extend("sap.ui.rta.plugin.Settings",{metadata:{library:"sap.ui.rta",properties:{commandStack:{type:"any"}},associations:{},events:{}}});S.prototype._getUnsavedChanges=function(i,c){var e;var u=this.getCommandStack().getSerializableCommands().filter(function(C){e=C.getElement().id||C.getElement().getId();if(e===i&&c.indexOf(C.getChangeType())>=0){return true;}}).map(function(C){return C.getPreparedActionData().change;});return u;};S.prototype._getEffectiveDesignTimeMetadata=function(o){var d;if(o.isInHiddenTree()){var p=o.getPublicParentAggregationOverlay();d=p.getDesignTimeMetadata();}else{d=o.getDesignTimeMetadata();}return d;};S.prototype._getSettingsAction=function(o){return this._getEffectiveDesignTimeMetadata(o).getAction("settings",o.getElementInstance());};S.prototype.isSettingsAvailable=function(o){return!!this._getSettingsAction(o);};S.prototype.isSettingsEnabled=function(o){var a=this._getSettingsAction(o);if(!a){return false;}if(typeof a.isEnabled!=="undefined"){if(typeof a.isEnabled==="function"){return a.isEnabled(o.getElementInstance());}else{return a.isEnabled;}}return true;};S.prototype.handleSettings=function(s){var o;var e=s[0].getElementInstance();var t=this;return s[0].getDesignTimeMetadata().getAction("settings").handler(e,this._getUnsavedChanges.bind(this)).then(function(c){c.forEach(function(C){o=t.getCommandFactory().getCommandFor(C.selectorControl,"settings",C.changeSpecificData);t.fireElementModified({"command":o});});})['catch'](function(E){if(E){throw E;}});};return S;},true);};if(!jQuery.sap.isDeclared('sap.ui.rta.ui.ToolsMenu')){
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

(c) Copyright 2009-2016 SAP SE. All rights reserved
 */
jQuery.sap.declare('sap.ui.rta.ui.ToolsMenu');jQuery.sap.require('sap.ui.core.Control');jQuery.sap.require('sap.m.Toolbar');jQuery.sap.require('sap.m.ToolbarLayoutData');jQuery.sap.require('sap.m.ToolbarSpacer');jQuery.sap.require('sap.m.Label');jQuery.sap.require('sap.ui.core.Popup');jQuery.sap.require('sap.ui.fl.registry.Settings');jQuery.sap.require('sap.ui.fl.Utils');sap.ui.define("sap/ui/rta/ui/ToolsMenu",['sap/ui/rta/library','sap/ui/core/Control','sap/m/Toolbar','sap/m/ToolbarLayoutData','sap/m/ToolbarSpacer','sap/m/Label','sap/ui/core/Popup','sap/ui/fl/registry/Settings','sap/ui/fl/Utils'],function(l,C,T,a,b,L,P,F,U){"use strict";var c=C.extend("sap.ui.rta.ui.ToolsMenu",{metadata:{library:"sap.ui.rta",aggregations:{"toolbars":{type:"sap.m.Toolbar",multiple:true,singularName:"toolbar"}},events:{"undo":{},"redo":{},"close":{},"toolbarClose":{},"restore":{},"transport":{}}}});c.prototype.init=function(){this._oRb=sap.ui.getCore().getLibraryResourceBundle("sap.ui.rta");};c.prototype.createToolbar=function(){var t=null;var z=P.getNextZIndex();if(!this._oToolBar){var A=null;var o=null;var B=null;var s=null;var d=null;t=" - "+this._oRb.getText("TOOLBAR_TITLE");A=new L({text:t,layoutData:new a({shrinkable:false})});A.bAllowTextSelection=false;t=null;o=new L({text:t,layoutData:new a({shrinkable:false})});o.bAllowTextSelection=false;t=this._oRb.getText("BTN_UNDO");this._oButtonUndo=new sap.m.Button({type:"Transparent",icon:"sap-icon://undo",enabled:false,tooltip:t,layoutData:new a({shrinkable:false})});this._oButtonUndo.data("Action","UNDO",true);this._oButtonUndo.attachEvent('press',this._onUndo,this);t=this._oRb.getText("BTN_REDO");this._oButtonRedo=new sap.m.Button({type:"Transparent",icon:"sap-icon://redo",iconFirst:false,enabled:false,tooltip:t,layoutData:new a({shrinkable:false})});this._oButtonRedo.data("Action","REDO",true);this._oButtonRedo.attachEvent('press',this._onRedo,this);t=this._oRb.getText("BTN_RESTORE");this._oButtonRestore=new sap.m.Button({type:"Transparent",text:t,visible:true,tooltip:t,layoutData:new a({shrinkable:false})});this._oButtonRestore.data("Action","RESTORE",true);this._oButtonRestore.attachEvent('press',this._onRestore,this);t=this._oRb.getText("BTN_EXIT");B=new sap.m.Button({type:"Transparent",text:t,tooltip:t,layoutData:new a({shrinkable:false})});B.data("Action","EXIT",true);B.attachEvent('press',this.close,this);t=this._oRb.getText("BTN_TRANSPORT");this._oButtonTransport=new sap.m.Button({type:"Transparent",text:t,visible:false,tooltip:t,layoutData:new a({shrinkable:false})});this._oButtonTransport.data("Action","TRANSPORT",true);this._oButtonTransport.attachEvent('press',this._onTransport,this);s=new b();this._oToolBar=new T({active:true,content:[o,A,s,this._oButtonUndo,this._oButtonRedo,this._oButtonRestore,this._oButtonTransport,B]});this._oToolBar.addStyleClass("sapUiRTAToolBar");this.addToolbar(this._oToolBar);jQuery("body").prepend('<div id="RTA-Toolbar" style="z-index: '+z+'"></div>');d=jQuery("#RTA-Toolbar").addClass("sapUiRTAToolsMenuWrapper");d=d[0];this.placeAt(d);}};c.prototype.exit=function(){jQuery("#RTA-Toolbar").remove();};c.prototype._onTransport=function(){this.fireTransport();};c.prototype.checkTransportAvailable=function(){var t=this;return F.getInstance(U.getComponentClassName(this._oRootControl)).then(function(s){if(!s.isProductiveSystem()&&!s.hasMergeErrorOccured()){var i=s.isAtoEnabled();t._oButtonTransport.setVisible(true);t.adaptTransportText(i);return i;}}).catch(function(){t._oButtonTransport.setVisible(false);});};c.prototype.show=function(){this._oToolBar.addStyleClass("sapUiRTAToolBarVisible");this._oToolBar.removeStyleClass("sapUiRTAToolBarInvisible");};c.prototype.hide=function(){var t=this;return new Promise(function(r){t._oToolBar.addStyleClass("sapUiRTAToolBarInvisible");var o=document.getElementsByClassName("sapUiRTAToolBar")[0];var A=function(){r();t.fireClose();};o.addEventListener("webkitAnimationEnd",A);o.addEventListener("animationend",A);o.addEventListener("oanimationend",A);});};c.prototype._onUndo=function(){this.fireUndo();};c.prototype._onRedo=function(){this.fireRedo();};c.prototype._onRestore=function(){this.fireRestore();};c.prototype.close=function(){this.fireToolbarClose();};c.prototype.setTitle=function(t){var o=this._oToolBar.getContent()[0];o.setText(t);};c.prototype.setRootControl=function(o){this._oRootControl=o;};c.prototype.adaptTransportText=function(A){var t=null;if(A){t=this._oRb.getText("BTN_PUBLISH");}else{t=this._oRb.getText("BTN_TRANSPORT");}this._oButtonTransport.setText(t);this._oButtonTransport.setTooltip(t);};c.prototype.adaptUndoRedoEnablement=function(d,e){this._oButtonUndo.setEnabled(d);this._oButtonRedo.setEnabled(e);};c.prototype.adaptTransportEnablement=function(d){this._oButtonTransport.setEnabled(d);};c.prototype.adaptRestoreEnablement=function(d){this._oButtonRestore.setEnabled(d);};return c;},true);};if(!jQuery.sap.isDeclared('sap.ui.rta.ui.ToolsMenuRenderer')){jQuery.sap.declare('sap.ui.rta.ui.ToolsMenuRenderer');jQuery.sap.require('jquery.sap.global');sap.ui.define("sap/ui/rta/ui/ToolsMenuRenderer",['jquery.sap.global'],function(q){"use strict";var T={};T.render=function(r,c){if(c.getToolbars().length!==0){c.getToolbars().forEach(function(C){r.renderControl(C);});}};return T;},true);};if(!jQuery.sap.isDeclared('sap.ui.rta.util.FakeLrepLocalStorage')){
/*
 * ! SAP UI development toolkit for HTML5 (SAPUI5)

(c) Copyright 2009-2016 SAP SE. All rights reserved
 */
jQuery.sap.declare('sap.ui.rta.util.FakeLrepLocalStorage');sap.ui.define("sap/ui/rta/util/FakeLrepLocalStorage",[],function(){"use strict";var R="sap.ui.rta.change";var F={};F.createChangeKey=function(i){if(i){return R+"."+i;}};F.forEachLrepChangeInLocalStorage=function(p){for(var k in window.localStorage){if(k.indexOf(R)>-1){p(k);}}};F.getChange=function(i){if(i){var c=window.localStorage.getItem(this.createChangeKey(i));return JSON.parse(c);}};F.getChanges=function(){var c=[],C;this.forEachLrepChangeInLocalStorage(function(k){C=JSON.parse(window.localStorage[k]);c.push(C);});return c;};F.getNumChanges=function(){var c=0;this.forEachLrepChangeInLocalStorage(function(k){c++;});return c;};F._aModifyCallbacks=[];F.attachModifyCallback=function(c){this._aModifyCallbacks.push(c);};F.detachModifyCallback=function(c){var i=this._aModifyCallbacks.indexOf(c);if(i!==-1){this._aModifyCallbacks.splice(i,1);}};F._callModifyCallbacks=function(){this._aModifyCallbacks.forEach(function(c){c();});};F.deleteChange=function(i){if(i){window.localStorage.removeItem(this.createChangeKey(i));}this._callModifyCallbacks();};F.deleteChanges=function(){this.forEachLrepChangeInLocalStorage(function(k){window.localStorage.removeItem(k);});this._callModifyCallbacks();};F.saveChange=function(i,c){if(i&&c){var C=this.createChangeKey(i),s=JSON.stringify(c);window.localStorage.setItem(C,s);}this._callModifyCallbacks();};return F;},true);};if(!jQuery.sap.isDeclared('sap.ui.rta.Utils')){
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

(c) Copyright 2009-2016 SAP SE. All rights reserved
 */
jQuery.sap.declare('sap.ui.rta.Utils');jQuery.sap.require('jquery.sap.global');jQuery.sap.require('sap.ui.fl.Utils');jQuery.sap.require('sap.ui.dt.OverlayUtil');jQuery.sap.require('sap.ui.comp.odata.FieldSelectorModelConverter');jQuery.sap.require('sap.ui.fl.registry.Settings');jQuery.sap.require('sap.ui.comp.smartform.GroupElement');jQuery.sap.require('sap.ui.comp.smartform.Group');jQuery.sap.require('sap.ui.comp.smartfield.SmartField');jQuery.sap.require('sap.uxap.ObjectPageSection');jQuery.sap.require('sap.uxap.ObjectPageLayout');jQuery.sap.require('sap.ui.core.StashedControlSupport');jQuery.sap.require('sap.m.MessageBox');jQuery.sap.require('sap.ui.comp.odata.MetadataAnalyser');sap.ui.define("sap/ui/rta/Utils",['jquery.sap.global','sap/ui/fl/Utils','sap/ui/dt/OverlayUtil','sap/ui/comp/odata/FieldSelectorModelConverter','sap/ui/fl/registry/Settings','sap/ui/comp/smartform/GroupElement','sap/ui/comp/smartform/Group','sap/ui/comp/smartfield/SmartField','sap/uxap/ObjectPageSection','sap/uxap/ObjectPageLayout','sap/ui/core/StashedControlSupport','sap/m/MessageBox','sap/ui/comp/odata/MetadataAnalyser','sap/ui/rta/model/ElementPreprocessor'],function(q,F,O,a,S,G,b,c,d,e,f,M,g,E){"use strict";var U={};U.RESOLVED_PROMISE=Promise.resolve(true);U._sFocusableOverlayClass=".sapUiDtOverlaySelectable";U.isExtensibilityEnabledInSystem=function(C){var s=F.getComponentClassName(C);if(!s||s==""){return Promise.resolve(false);}return S.getInstance(s).then(function(o){if(o.isModelS){return o.isModelS();}return false;});};function _(A,p){return A&&A.changeType&&A.aggregation===p.getAggregationName();}function h(D){if(D.getAggregations){for(var i in D.getAggregations()){if(D.getAggregation(i).actions){return true;}}}return false;}U.isEditable=function(o,m){var D=o.getDesignTimeMetadata();var i=o.getElementInstance();var C=i.getMetadata().getName();var p=o.getPublicParentAggregationOverlay();var P;if(!p){return false;}else{P=p.getDesignTimeMetadata();}var j=false;var s=false;var r;var R;var k;var l;var n=o.getPublicParentElementOverlay().getDesignTimeMetadata();if(n.getData().aggregations){var t=n.getAggregationAction("createContainer",i)[0];var A=n.getAggregationAction("addODataProperty",i)[0];if(_(t,p)||_(A,p)){j=true;}}if(!j&&D.getData().actions){r=D.getAction("rename",i);if(r&&r.changeType){j=true;}else{R=D.getAction("remove",i);if(R&&R.changeType){j=true;}else{k=D.getAction("reveal",i);if(k&&k.changeType){j=true;}else{l=D.getAction("settings",i);if(l){j=true;}}}}}if(!j&&P.getData().actions){r=P.getAction("rename",i);if(r&&r.changeType){j=true;}else if(P.getAction("move",m||i)){j=true;}else{R=P.getAction("remove",i);if(R&&R.changeType){j=true;}else{k=P.getAction("reveal",i);if(k&&k.changeType){j=true;}}}}if(!j){j=h(D);}if(!j){q.sap.require("sap.ui.rta.plugin.additionalElements.AdditionalElementsPlugin");j=sap.ui.rta.plugin.additionalElements.AdditionalElementsPlugin.hasRevealActionsOnChildren(o);}if(!j&&F.isVendorLayer()){j=["sap.ui.comp.smartfilterbar.SmartFilterBar","sap.ui.comp.smarttable.SmartTable","sap.uxap.ObjectPageHeader","sap.uxap.ObjectPageHeaderActionButton","sap.ui.table.Column"].indexOf(C)>-1;}if(j){var u;if(o.isInHiddenTree()){u=P.getData().getStableElements;}else{u=D.getData().getStableElements;}if(u){var v=u(i);var w=v?v.some(function(x){var y=x.id||x;if(!F.checkControlId(y,x.appComponent)){return true;}}):true;s=!w;}else{s=F.checkControlId(i);}}return j&&s;};U.hasParentStableId=function(o){var B=o.getPublicParentElementOverlay();var i=B?B.getElementInstance():null;return i&&F.checkControlId(i);};U.isServiceUpToDate=function(C){return this.isExtensibilityEnabledInSystem(C).then(function(i){if(i){q.sap.require("sap.ui.fl.fieldExt.Access");var m=C.getModel();if(m){var s=sap.ui.fl.fieldExt.Access.isServiceOutdated(m.sServiceUrl);if(s){sap.ui.fl.fieldExt.Access.setServiceValid(m.sServiceUrl);sap.ui.getCore().getEventBus().publish("sap.ui.core.UnrecoverableClientStateCorruption","RequestReload",{});return Promise.reject();}}}});};U.isCustomFieldAvailable=function(C){var t=this;return this.isExtensibilityEnabledInSystem(C).then(function(s){if(!s){return false;}else if(!C.getModel()){return false;}else{var j=C.getModel().sServiceUrl;var k=t.getBoundEntityType(C);try{q.sap.require("sap.ui.fl.fieldExt.Access");var J=sap.ui.fl.fieldExt.Access.getBusinessContexts(j,k);return Promise.resolve(J).then(function(r){if(r){if(r.BusinessContexts){if(r.BusinessContexts.length>0){r.EntityType=k;return r;}}}else{return false;}}).catch(function(o){if(o){if(q.isArray(o.errorMessages)){for(var i=0;i<o.errorMessages.length;i++){q.sap.log.error(o.errorMessages[i].text);}}}return false;});}catch(o){q.sap.log.error("exception occured in sap.ui.fl.fieldExt.Access.getBusinessContexts",o);return false;}}});};U.openRemoveConfirmationDialog=function(o,t){var T=sap.ui.getCore().getLibraryResourceBundle("sap.ui.rta");var s;return new Promise(function(r,i){s=T.getText("CTX_REMOVE_TITLE");var j={messageText:t,titleText:s,icon:"sap-icon://question-mark",removeText:T.getText("BTN_FREP_REMOVE"),cancelText:T.getText("BTN_FREP_CANCEL")};var m=new sap.ui.model.json.JSONModel();m.setData(j);var k;var C=function(){if(k){k.close();k.destroy();k=null;}};var l={removeField:function(){C();r(true);},closeDialog:function(){C();r(false);}};if(!k){k=sap.ui.xmlfragment("sap.ui.rta.view.RemoveElementDialog",l);k.setModel(m);}k.open();});};U.isMandatorySmartField=function(o){return(o instanceof c)&&o.getMandatory();};U.isOverlaySelectable=function(o){return o.isSelectable()&&o.$().is(":visible");};U.getPropertyValue=function(o,p){var m=o.getMetadata().getPropertyLikeSetting(p);var P=m._sGetter;return o[P]();};U.getOverlayInstanceForDom=function(D){var i=q(D).attr("id");if(i){return sap.ui.getCore().byId(i);}};U.getFocusedOverlay=function(){if(document.activeElement){var o=sap.ui.getCore().byId(document.activeElement.id);if(o instanceof sap.ui.dt.ElementOverlay){return o;}}};U.getFirstFocusableChildOverlay=function(o){var i=O.getFirstChildOverlay(o);while(i&&!this.isOverlaySelectable(i)){i=O.getNextSiblingOverlay(i);}return i;};U.getNextFocusableSiblingOverlay=function(o){var n=O.getNextSiblingOverlay(o);while(n&&!this.isOverlaySelectable(n)){n=O.getNextSiblingOverlay(n);}return n;};U.getPreviousFocusableSiblingOverlay=function(o){var p=O.getPreviousSiblingOverlay(o);while(p&&!this.isOverlaySelectable(p)){p=O.getPreviousSiblingOverlay(p);}return p;};U.getClosestTypeForControl=function(C,t){if(C&&C.getMetadata().getName()!==t){return this.getClosestTypeForControl(C.getParent(),t);}return C;};U._checkIsSupportedControl=function(C,s){for(var i=0;i<s.length;i++){if(C.getMetadata().getName()===s[i]){return true;}}};U.hasGroupElementUnBoundFields=function(o){var i=o.getFields();if(i.length===0){return true;}for(var j=0;j<i.length;j++){var k=i[j];if(!k.getDomRef()){continue;}if(!this._isElementBound(k)){return true;}}return false;};U._isElementBound=function(o){var B=o.mBindingInfos;if(Object.keys(B).length===0){return false;}else{for(var p in B){var P=B[p].parts;for(var i=0;i<P.length;i++){if(P[i].model){var m=o.getModel(P[i].model).getMetadata().getName();if(m==="sap.ui.model.odata.ODataModel"||m==="sap.ui.model.odata.v2.ODataModel"){return true;}}else{var m=o.getModel().getMetadata().getName();if(m==="sap.ui.model.odata.ODataModel"||m==="sap.ui.model.odata.v2.ODataModel"){return true;}}}}}};U.getObjectPageSections=function(o){var i;var s=[];var j=[];if(o.getMetadata().getName()==="sap.uxap.ObjectPageSection"){i=o.getParent();}else if(o.getMetadata().getName()==="sap.uxap.ObjectPageLayout"){i=o;}s=i.getAggregation("sections");j=f.getStashedControls(i.getId());s=s.concat(j);return s;};U.hasObjectPageLayoutInvisibleSections=function(o){var s=U.getObjectPageSections(o);if(s.length===0){return false;}for(var i=0;i<s.length;i++){if((s[i].getVisible&&s[i].getVisible()===false)||(s[i].getStashed&&s[i].getStashed()===true)){return true;}}return false;};U.getIndex=function(p,C,A,i){var I;if(i&&typeof i==="function"){I=i.call(null,p,C);}else{var m=p.getMetadata();var o=m.getAggregation(A);var s=o._sGetter;var j=p[s]();if(C){I=j.indexOf(C)+1;}else{I=j.length;}}return I;};U.determineTargetIndex=function(s,o,C,i){var j=o.getMetadata().getClass();var t=(s instanceof j)?C.length-i:C.indexOf(s)+1;return t;};U.findSupportedBlock=function(C,s){if(this._checkIsSupportedControl(C,s)){return C;}else{C=C.getParent();while(C){if(this._checkIsSupportedControl(C,s)){return C;}C=C.getParent();}}};U.createFieldLabelId=function(C,s,B){var i=C.getId()+"_"+s+"_"+B;i=i.replace("/","_");return i;};U.getLabelForElement=function(o,i){if(i){return i(o);}else{var s=o.getText&&o.getText();if(!s){s=o.getLabelText&&o.getLabelText();}if(!s){s=o.getLabel&&o.getLabel();if(s&&s.getText){s=s.getText();}}if(!s){s=o.getTitle&&o.getTitle();}if(!s){s=o.getId&&o.getId();}return(typeof s)==="string"?s:undefined;}};U.getPathFromBindingInfo=function(i,B){var p=B[i]?B[i]:undefined;if(p){if((p.parts instanceof Array)&&p.parts.length>0){p=p.parts[0]?p.parts[0]:undefined;}p=((typeof p.path)==="string")?p.path:p;}if((typeof p)==="string"){p=p;}else{p=undefined;}return p;};U.getBoundEntityType=function(o,m){var i=m?m:o.getModel();var B=o.getBindingContext();var j=i.oMetadata._getEntityTypeByPath(B.getPath());return j.name;};U.openNewWindow=function(u){window.open(u,"_blank");};U.fetchODataPropertiesFor=function(m){var t=this;if(!m){return new Promise(function(r,i){i();});}var o=m.getMetaModel();return o.loaded().then(function(){t._oMetadataAnalyzer=new g(m);var i=new E(t._oMetadataAnalyzer);var j=t._oMetadataAnalyzer.getAllEntityTypeNames();var A={};j.forEach(function(s){A[s]=t._oMetadataAnalyzer.getFieldsByEntityTypeName(s);});Object.keys(A).forEach(function(s){A[s]=i._updateAndFilterFields(A[s]);});return A;},function(r){q.sap.log.error("MetadataModel could not be loaded",r);});};U.getElementBindingPaths=function(o){var p={};if(o.mBindingInfos){for(var i in o.mBindingInfos){var P=o.mBindingInfos[i].parts[0].path?o.mBindingInfos[i].parts[0].path:"";P=P.split("/")[P.split("/").length-1];p[P]={valueProperty:i};}}return p;};U.findFieldBindingPathInFieldsArray=function(p,H){var P=Object.keys(p);var D=Object.keys(H);var s="";P.forEach(function(i){if(D.indexOf(i)>=0){s=D[D.indexOf(i)];}});return s;};U.createNewAddFieldsCommand=function(s,o,i,j,l,v,k){q.sap.require("sap.ui.rta.command.CommandFactory");var A=sap.ui.rta.command.CommandFactory.getCommandFor(o,"add",{newControlId:U.createNewSmartFormGroupElementId(s,k),index:i,jsTypes:j,labels:l,fieldValues:k,valuePropertys:v});return A;};U.createNewSmartFormGroupElementId=function(p,P){var s="";var t=P.slice();var j=t.sort();for(var i=0;i<j.length;i++){var k=j[i].replace("/","_");s=s+"__"+k;}return p.getId()+s;};return U;},true);};if(!jQuery.sap.isDeclared('sap.ui.rta.command.BindProperty')){
/*
 * ! SAP UI development toolkit for HTML5 (SAPUI5)

(c) Copyright 2009-2016 SAP SE. All rights reserved
 */
jQuery.sap.declare('sap.ui.rta.command.BindProperty');jQuery.sap.require('sap.ui.fl.changeHandler.PropertyBindingChange');sap.ui.define("sap/ui/rta/command/BindProperty",['sap/ui/rta/command/FlexCommand',"sap/ui/fl/changeHandler/PropertyBindingChange","sap/ui/rta/Utils"],function(F,P,U){"use strict";var B=F.extend("sap.ui.rta.command.BindProperty",{metadata:{library:"sap.ui.rta",properties:{propertyName:{type:"string"},newBinding:{type:"string",bindable:false},oldValue:{type:"any"},oldBinding:{type:"string"},changeType:{type:"string",defaultValue:"propertyBindingChange"}},associations:{},events:{}}});B.prototype.init=function(){this.setChangeHandler(P);};B.FORWARD=true;B.BACKWARD=false;B.prototype.bindProperty=function(n,b){if(n==="newBinding"){return this.setNewBinding(b.bindingString);}if(n==="oldBinding"){return this.setOldBinding(b.bindingString);}return F.prototype.bindProperty.apply(this,arguments);};B.prototype._ensureOld=function(){if((this.getOldValue()===undefined)&&(this.getOldBinding()===undefined)){var e=this._getElement();var b=e.getBindingInfo(this.getPropertyName());if(b&&b.bindingString){this.setOldBinding(b.bindingString);}else{var o=U.getPropertyValue(e,this.getPropertyName());this.setOldValue(o);}}};B.prototype._getOld=function(){if(this.getOldValue()==="undefined"){return this.getOldValue();}else{return this.getOldBinding();}};B.prototype._getSpecificChangeInfo=function(f){var e=this._getElement();this._ensureOld();var s={changeType:this.getChangeType(),selector:{id:e.getId(),type:e.getMetadata().getName()},content:{property:this.getPropertyName(),newBinding:f?this.getNewBinding():this._getOld()}};if(f&&typeof this.getOldValue()!=="undefined"){s.content.oldValue=this.getOldValue();}else{s.content.oldBinding=f?this.getOldBinding():this.getNewBinding();}return s;};B.prototype._getFlexChange=function(f){var s=this._getSpecificChangeInfo(f);var c=this._completeChangeContent(s);return{change:c,selectorElement:this._getElement()};};B.prototype._getForwardActionData=function(e){return this._getFlexChange(B.FORWARD);};B.prototype._getBackwardActionData=function(e){return this._getFlexChange(B.BACKWARD);};B.prototype.serialize=function(){return this._getSpecificChangeInfo(B.FORWARD);};return B;},true);};if(!jQuery.sap.isDeclared('sap.ui.rta.command.LREPSerializer')){jQuery.sap.declare('sap.ui.rta.command.LREPSerializer');jQuery.sap.require('sap.ui.base.ManagedObject');jQuery.sap.require('sap.ui.fl.FlexControllerFactory');sap.ui.define("sap/ui/rta/command/LREPSerializer",['sap/ui/base/ManagedObject','sap/ui/rta/command/Stack','sap/ui/fl/FlexControllerFactory'],function(M,C,F){"use strict";var L=M.extend("sap.ui.rta.command.LREPSerializer",{metadata:{library:"sap.ui.rta",associations:{"rootControl":{type:"sap.ui.core.Control"}},properties:{"commandStack":{type:"object"}},aggregations:{}}});L.prototype.saveCommands=function(){var c=this.getCommandStack();var r=sap.ui.getCore().byId(this.getRootControl());var f=F.createForControl(r);var a=c.getSerializableCommands();a.forEach(function(o,i){var e=o.getElement();var p=o.getPreparedActionData();if(p){f.addPreparedChange(p.change||p,e);}else{f.addChange(o.serialize(),e);}});var t=this;return f.saveAll().then(function(){jQuery.sap.log.info("UI adaptation successfully transfered changes to layered repository");t.getCommandStack().removeAllCommands();});};return L;},true);};if(!jQuery.sap.isDeclared('sap.ui.rta.command.Property')){jQuery.sap.declare('sap.ui.rta.command.Property');jQuery.sap.require('sap.ui.fl.changeHandler.PropertyChange');sap.ui.define("sap/ui/rta/command/Property",['sap/ui/rta/command/FlexCommand',"sap/ui/fl/changeHandler/PropertyChange","sap/ui/rta/Utils"],function(F,P,U){"use strict";var a=F.extend("sap.ui.rta.command.Property",{metadata:{library:"sap.ui.rta",properties:{propertyName:{type:"string"},newValue:{type:"any"},oldValue:{type:"any"},semanticMeaning:{type:"string"},changeType:{type:"string",defaultValue:"propertyChange"}},associations:{},events:{}}});a.prototype.init=function(){this.setChangeHandler(P);};a.FORWARD=true;a.BACKWARD=false;a.prototype._ensureOldValue=function(e){if(this.getOldValue()===undefined){var o=U.getPropertyValue(e,this.getPropertyName());this.setOldValue(o);}};a.prototype._getSpecificChangeInfo=function(f){var e=this._getElement();this._ensureOldValue(e);return{changeType:this.getChangeType(),selector:{id:e.getId(),type:e.getMetadata().getName()},content:{property:this.getPropertyName(),oldValue:f?this.getOldValue():this.getNewValue(),newValue:f?this.getNewValue():this.getOldValue(),semantic:this.getSemanticMeaning()}};};a.prototype._getFlexChange=function(f){var s=this._getSpecificChangeInfo(f);var c=this._completeChangeContent(s);return{change:c,selectorElement:this._getElement()};};a.prototype._getForwardActionData=function(e){return this._getFlexChange(a.FORWARD);};a.prototype._getBackwardActionData=function(e){return this._getFlexChange(a.BACKWARD);};a.prototype.serialize=function(){return this._getSpecificChangeInfo(a.FORWARD);};return a;},true);};if(!jQuery.sap.isDeclared('sap.ui.rta.controlAnalyzer.Form')){jQuery.sap.declare('sap.ui.rta.controlAnalyzer.Form');jQuery.sap.require('sap.ui.dt.ElementUtil');jQuery.sap.require('sap.ui.fl.Utils');sap.ui.define("sap/ui/rta/controlAnalyzer/Form",['sap/ui/rta/controlAnalyzer/Base','sap/ui/rta/Utils','sap/ui/dt/ElementUtil','sap/ui/fl/Utils'],function(B,U,E,F){"use strict";var a=B.extend("sap.ui.rta.controlAnalyzer.Form",{metadata:{library:"sap.ui.rta",properties:{}}});a.prototype.init=function(){};a.prototype.getFlexChangeType=function(t,e,s){var f;switch(t){case"rename":if(E.isInstanceOf(e,"sap.ui.layout.form.FormContainer")){f="renameTitle";}else if(E.isInstanceOf(e,"sap.ui.layout.form.FormElement")){f="renameLabel";}break;case"hide":if(E.isInstanceOf(e,"sap.ui.layout.form.FormContainer")){f="removeSimpleFormGroup";}else if(E.isInstanceOf(e,"sap.ui.layout.form.FormElement")){f="hideSimpleFormField";}break;case"unhide":if(E.isInstanceOf(e,"sap.ui.layout.form.FormElement")){f="unhideSimpleFormField";}break;case"add":if(E.isInstanceOf(e,"sap.ui.layout.form.SimpleForm")){f="addSimpleFormGroup";}break;default:break;}return f;};a.prototype.getCommandClass=function(c){var C;switch(c){case"rename":C='sap.ui.rta.command.RenameForm';break;case"hide":C='sap.ui.rta.command.HideForm';break;case"unhide":C='sap.ui.rta.command.UnhideForm';break;case"add":C='sap.ui.rta.command.AddSimple';break;default:break;}return C;};a.prototype.getConfiguredElement=function(e){return this._getSimpleFormContainer(e);};a.prototype.getRenamableControl=function(e){if(E.isInstanceOf(e,"sap.ui.layout.form.FormElement")){return e.getLabel();}else if(E.isInstanceOf(e,"sap.ui.layout.form.FormContainer")){return e.getTitle();}};a.prototype.getLabel=function(e){return this.getRenamableControl(e).getText();};a.prototype.getLabelBinding=function(e){return e.getBindingInfo("text");};a.prototype.resumeLabelBinding=function(e){var b=e.getBinding("text");if(b){b.resume();}};a.prototype.createChangeData=function(c,C,h,s){var m={};var b=c.getBindingContext().getObject();var d=b.controlId?b.controlId:b.fieldLabel;var o=sap.ui.getCore().byId(d);var e=!!o;var f=function(){if(e){if(b.visibilityType==="hide"){m={controlId:d,changeType:h?"hideControl":"unhideControl",controlType:"SimpleForm"};}}return m;};return new Promise(function(r,g){r(f());});};a.prototype.getSelectedBlock=function(c){return U.findSupportedBlock(c,["sap.ui.layout.form.SimpleForm"]);};a.prototype.getClosestType=function(c){return U.getClosestTypeForControl(c,"sap.ui.layout.form.SimpleForm");};a.prototype.prepare=function(){var e=this._getSimpleFormElements(this.getControl());if(!this.getPrepared()){for(var i=0;i<e.length;i++){var t=e[i].getText?e[i].getText():e[i].getId();var v=e[i].getVisible?e[i].getVisible():e[i].getParent().getVisible();if(v===false){this._mAvailableElements[e[i].getId()]={fieldLabel:t,quickInfo:t,entityType:"",controlId:e[i].getId(),visibilityType:"hide"};}else{this._mHiddenElements[e[i].getId()]={fieldLabel:t,quickInfo:t,entityType:"",controlId:e[i].getId(),visibilityType:"hide"};}}sap.ui.rta.controlAnalyzer.Base.prototype.prepare.apply(this);}return Promise.resolve();};a.prototype._getSimpleFormElements=function(e){var b=[];var s=this._getSimpleFormContainer(e);var c=s.getContent();c.forEach(function(f){if(f instanceof sap.m.Label){b.push(f);}});return b;};a.prototype._getSimpleFormContainer=function(e){if(E.isInstanceOf(e,"sap.ui.layout.form.SimpleForm")){return e;}else if(E.isInstanceOf(e,"sap.ui.layout.form.Form")||E.isInstanceOf(e,"sap.ui.layout.form.FormContainer")||E.isInstanceOf(e,"sap.ui.layout.form.FormElement")){return this._getSimpleFormContainer(e.getParent());}};a.prototype._hasStableIds=function(e){if(E.isInstanceOf(e,"sap.ui.layout.form.SimpleForm")&&F.checkControlId(e)){var h=e.getContent().some(function(c){var H=!F.checkControlId(c);return H;});return!h;}};a.prototype._determineGroupIndex=function(e){var i=0;if(e.getMetadata().getName()==="sap.ui.layout.form.FormContainer"){var c=this._getSimpleFormContainer(e).getContent();var s=-1;var t=e.getTitle();if(t!==null){c.some(function(f,b){if(f===t){s=b;}if(s>=0&&b>s){if(f instanceof sap.ui.core.Title){i=b;return true;}}});i=(!i)?c.length:i;}}return i;};a.prototype._determineIndexOfFormElement=function(f,o){var c=f.getParent().getAggregation("formElements");var i;c.some(function(C,b){if(C===f){i=b;return true;}});i=(o)?i+1:i;return i;};a.prototype._getStableElementForCommand=function(e){var s;if(e.getMetadata().getName()==="sap.ui.layout.form.FormContainer"){s=e.getTitle();}else if(e.getMetadata().getName()==="sap.ui.layout.form.FormElement"){s=e.getLabel();}return s;};a.prototype.mapSpecificChangeData=function(t,s){var r;switch(t){case"Add":r=this._mapAddSpecificChangeData(t,s);break;default:r=this.prototype.mapSpecificChangeData(t,s);break;}return r;};a.prototype._mapAddSpecificChangeData=function(t,s){if(s.changeType==="addSimpleFormGroup"){s.groupLabel=s.labels[0];delete s.labels;}return s;};a.prototype.isHideable=function(e){var i=(E.isInstanceOf(e,"sap.ui.layout.form.FormElement")||E.isInstanceOf(e,"sap.ui.layout.form.FormContainer"));return(i&&!this.isMandatory(e));};return a;},true);};if(!jQuery.sap.isDeclared('sap.ui.rta.controlAnalyzer.ObjectPage')){
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

(c) Copyright 2009-2016 SAP SE. All rights reserved
 */
jQuery.sap.declare('sap.ui.rta.controlAnalyzer.ObjectPage');jQuery.sap.require('sap.ui.dt.ElementUtil');jQuery.sap.require('sap.ui.core.StashedControlSupport');sap.ui.define("sap/ui/rta/controlAnalyzer/ObjectPage",['sap/ui/rta/controlAnalyzer/Base','sap/ui/rta/Utils','sap/ui/dt/ElementUtil','sap/ui/core/StashedControlSupport'],function(B,U,E,S){"use strict";var O=B.extend("sap.ui.rta.controlAnalyzer.ObjectPage",{metadata:{library:"sap.ui.rta"}});O.prototype.setControl=function(c){var o=U.getClosestTypeForControl(c,"sap.uxap.ObjectPageLayout");this.setProperty("control",o,true);this.setProperty("selectedControl",c,true);};O.prototype.getSelectedBlock=function(c){return U.findSupportedBlock(c,["sap.uxap.ObjectPageLayout"]);};O.prototype.getClosestType=function(c){return U.getClosestTypeForControl(c,"sap.uxap.ObjectPageLayout");};O.prototype.getControlsFieldCollection=function(c){throw new Error('getControlsFieldCollection not yet implemented in ObjectPage');};O.prototype.createChangeData=function(c,C,h,s){var m={};var b=c.getBindingContext().getObject();var a=b.controlId?b.controlId:b.fieldLabel;var o=sap.ui.getCore().byId(a);var d=!!o;var f=function(){if(d){if(b.visibilityType==="hide"){m={controlId:a,changeType:h?"hideControl":"unhideControl"};}else if(b.visibilityType==="stash"){var e=U.getObjectPageSections(C);var t=U.determineTargetIndex(s,C,e,1);m={controlId:a,changeType:h?"stashControl":"unstashControl",parentAggregationName:"sections",iTargetIndex:t};}}return m;};return new Promise(function(r,e){r(f());});};O.prototype.findVisibleAndBoundFieldsAndLabelNames=function(c){var v=[];var f={};var F={};var e=E.findAllPublicElements(c);var i=0;for(i=0;i<e.length;i++){var o=e[i];if(o instanceof sap.m.ObjectAttribute){v.push(o.getBindingPath("text"));}}return{visibleAndBoundFields:v,fieldsAndLabelNames:f,fieldsAndBoundPropertyName:F};};O.prototype.prepare=function(){var c=this.getControl();var s=U.getObjectPageSections(c);if(!this.getPrepared()){for(var i=0;i<s.length;i++){var t=s[i].getTitle?s[i].getTitle():s[i].getId();if(s[i].getStashed&&(s[i].getStashed()||s[i].getVisible()===false)){this._mAvailableElements[s[i].getId()]={fieldLabel:t,quickInfo:t,entityType:"",controlId:s[i].getId(),visibilityType:"stash"};}else if(s[i].getVisible&&s[i].getVisible()===false){this._mAvailableElements[s[i].getTitle()]={fieldLabel:t,quickInfo:t,entityType:"",controlId:s[i].getId(),visibilityType:"hide"};}else{this._mHiddenElements[s[i].getTitle()]={fieldLabel:t,quickInfo:t,entityType:"",controlId:s[i].getId(),visibilityType:"hide"};}}sap.ui.rta.controlAnalyzer.Base.prototype.prepare.apply(this);}return Promise.resolve();};O.prototype.checkTargetZone=function(p,a,m){if(E.isInstanceOf(m,"sap.uxap.ObjectPageSection")){if(E.isInstanceOf(p,"sap.uxap.ObjectPageLayout")){if(m.getParent()===p&&a==="sections"){return true;}}}};O.prototype.isHideable=function(e){return(E.isInstanceOf(e,"sap.uxap.ObjectPageSection")&&!this.isMandatory(e));};return O;},true);};if(!jQuery.sap.isDeclared('sap.ui.rta.controlAnalyzer.SmartForm')){
/*
 * ! SAP UI development toolkit for HTML5 (SAPUI5)

(c) Copyright 2009-2016 SAP SE. All rights reserved
 */
jQuery.sap.declare('sap.ui.rta.controlAnalyzer.SmartForm');jQuery.sap.require('sap.ui.dt.ElementUtil');jQuery.sap.require('sap.ui.comp.odata.MetadataAnalyser');sap.ui.define("sap/ui/rta/controlAnalyzer/SmartForm",['sap/ui/rta/controlAnalyzer/Base','sap/ui/rta/Utils','sap/ui/dt/ElementUtil','sap/ui/rta/ModelConverter','sap/ui/comp/odata/MetadataAnalyser','sap/ui/rta/model/ElementPreprocessor'],function(B,U,E,M,a,b){"use strict";var S=B.extend("sap.ui.rta.controlAnalyzer.SmartForm",{metadata:{library:"sap.ui.rta",properties:{customFieldAvailable:{type:"object",defaultValue:false}}}});S.rules={};S.rules["EXCLUDEVISIBLERULE"]="excludeVisibleElements";S.rules["EXCLUDEIGNOREDFIELDS"]="excludeIgnoredFields";S.prototype.init=function(){var t=this;this._mVisibleAndBoundFields;this._mRegisteredRules={};this._mRegisteredRules[S.rules.EXCLUDEVISIBLERULE]=function(e){if(!t._mVisibleAndBoundFields){t._mVisibleAndBoundFields=t.findBoundFields(false);}return t._retrieveElementFromMap(t._mVisibleAndBoundFields,e);};this._mRegisteredRules[S.rules.EXCLUDEIGNOREDFIELDS]=function(e){var i=t._getIgnoredFields();if(e.isComplexProperty){return i.indexOf(e.complexTypePropertyName+"."+e.name)!==-1;}return i.indexOf(e.name)!==-1;};};S.prototype.setControl=function(c){var s=U.getClosestTypeForControl(c,"sap.ui.comp.smartform.SmartForm");this.setProperty("control",s,true);this.setProperty("selectedControl",c,true);};S.prototype.getFlexChangeType=function(t,e){var f;switch(t){case"add":if(E.isInstanceOf(e,"sap.ui.comp.smartform.SmartForm")){f="addGroup";}else if(E.isInstanceOf(e,"sap.ui.comp.smartform.Group")){f="addFields";}break;case"rename":if(E.isInstanceOf(e,"sap.ui.comp.smartform.SmartForm")){f="renameField";}else if(E.isInstanceOf(e,"sap.ui.comp.smartform.Group")){f="renameGroup";}else if(E.isInstanceOf(e,"sap.ui.comp.smartform.GroupElement")){f="renameField";}break;default:break;}return f;};S.prototype.mapSpecificChangeData=function(t,s){var r;switch(t){case"Add":r=this._mapAddSpecificChangeData(t,s);break;case"Rename":r=this._mapRenameSpecificChangeData(t,s);break;default:r=this.prototype.mapSpecificChangeData(t,s);break;}return r;};S.prototype.getRenamableControl=function(e){if(E.isInstanceOf(e,"sap.ui.comp.smartform.Group")){return e.getTitle();}else if(E.isInstanceOf(e,"sap.ui.comp.smartform.GroupElement")){return e.getLabel();}};S.prototype.getLabel=function(e){if(E.isInstanceOf(e,"sap.ui.comp.smartform.SmartForm")){return e.getTitle();}else if(E.isInstanceOf(e,"sap.ui.comp.smartform.Group")){return e.getLabel();}else if(E.isInstanceOf(e,"sap.ui.comp.smartform.GroupElement")){return e.getLabelText();}};S.prototype.getLabelBinding=function(e){if(E.isInstanceOf(e,"sap.ui.comp.smartform.SmartForm")){return e.getBindingInfo("title");}else if(E.isInstanceOf(e,"sap.ui.comp.smartform.Group")||E.isInstanceOf(e,"sap.ui.comp.smartform.GroupElement")){return e.getBindingInfo("label");}};S.prototype.resumeLabelBinding=function(e){if(E.isInstanceOf(e,"sap.ui.comp.smartform.SmartForm")){var o=e.getBinding("title");if(o){o.resume();}}else if(E.isInstanceOf(e,"sap.ui.comp.smartform.Group")||E.isInstanceOf(e,"sap.ui.comp.smartform.GroupElement")){var o=e.getBinding("label");if(o){o.resume();}}};S.prototype._mapAddSpecificChangeData=function(t,s){if(s.changeType==="addFields"){s.fieldLabels=s.labels;delete s.labels;}else if(s.changeType==="addGroup"){s.groupLabel=s.labels[0];delete s.labels;}return s;};S.prototype._mapRenameSpecificChangeData=function(t,s){var e=s.element;if(E.isInstanceOf(e,"sap.ui.comp.smartform.SmartForm")){s.fieldLabel=s.value;s.labelProperty="title";}else if(E.isInstanceOf(e,"sap.ui.comp.smartform.Group")){s.groupLabel=s.value;}else if(E.isInstanceOf(e,"sap.ui.comp.smartform.GroupElement")){s.fieldLabel=s.value;s.labelProperty="label";}delete s.value;delete s.element;return s;};S.prototype.getSelectedBlock=function(c){return U.findSupportedBlock(c,["sap.ui.comp.smartform.Group"]);};S.prototype.getClosestType=function(c){return U.getClosestTypeForControl(c,"sap.ui.comp.smartform.SmartForm");};S.prototype.createChangeData=function(c,C,h,s){var m={};var o=c.getBindingContext().getObject();var d;if(o.controlId){d=o.controlId;}else{if(o.complexTypePropertyName){d=C.getId()+"_"+o.entityName+"_"+o.complexTypePropertyName+"_"+o.name;}else{d=C.getId()+"_"+o.entityName+"_"+o.name;}}var e=sap.ui.getCore().byId(d);var f=!!e;var g=function(){if(f){m={controlId:d,changeType:h?"hideControl":"unhideControl"};}else{var i=o.complexTypePropertyName?o.complexTypePropertyName+"/"+o.name:o.name;if(C){var G;if(C instanceof sap.ui.comp.smartform.Group){G=C;}else{G=C.getGroups()[0];}var j=G.getGroupElements();var t=U.determineTargetIndex(s,C,j,-1);m={unhide:f,newControlId:d,jsType:"sap.ui.comp.smartfield.SmartField",selectorId:G.getId(),index:t,valueProperty:"value",changeType:"addField",fieldLabel:o.fieldLabel,fieldValue:i};}}return m;};if(h&&!this.isHideable(e)){return U.openRemoveElementConfirmationDialog(e).then(function(i){if(i){return g();}else{return null;}});}else{return new Promise(function(r,i){r(g());});}};S.prototype.findChangedFieldLabels=function(){if(!this._mFieldsAndLabelNames){this._mFieldsAndLabelNames=this._findChangedFieldLabels();}return this._mFieldsAndLabelNames;};S.prototype._findChangedFieldLabels=function(){var f={};var i=this.findBoundFields(true);var v=this.findBoundFields(false);var A=jQuery.extend({},i,v);for(var p in A){var F=sap.ui.getCore().byId(A[p]);var t=U.getLabelForElement(F);f[p]=t;}return f;};S.prototype.findBoundFields=function(o){var s=this.getControl();var g=s.getGroups();var f={elementIds:{},boundFields:{}};var i,j,k=0;for(i=0;i<g.length;i++){var e=g[i].getGroupElements();for(j=0;j<e.length;j++){var F=e[j];var c=F.getFields();for(k=0;k<c.length;k++){var d=c[k];if(d.mBindingInfos){for(var I in d.mBindingInfos){var p=U.getPathFromBindingInfo(I,d.mBindingInfos);var P=d.getParent();if(P&&p){if(o&&!F.getVisible()){this._addBoundFields(f,p,d);continue;}if(F.getVisible()&&!o){this._addBoundFields(f,p,d);}}}}}}}return f.boundFields;};S.prototype._addBoundFields=function(f,p,F){var P=F.getParent();if(f.boundFields[p]){if(P.getFields().length===1){f.boundFields[p]=P.getId();}else if(f.elementIds[F.getId()]&&f.elementIds[F.getId()].getFields()===1){f.boundFields[p]=P.getId();}}else{f.boundFields[p]=P.getId();}f.elementIds[F.getId()]=P;};S.prototype._prepareCustomFields=function(){var t=this;return U.isCustomFieldAvailable(this.getSelectedControl()).then(function(r){if(r){t.setCustomFieldAvailable(r);}return r;});};S.prototype._getIgnoredFields=function(){var s=this.getControl();if(s){var c=s.getIgnoredFields();if(c){var i=c.split(",");return i;}}return[];};S.prototype.getCustomFieldAvailable=function(){if(!this.getPrepared()){this._raiseIllegalState();}return this.getProperty("customFieldAvailable");};S.prototype.getCustomizeControlModel=function(c,f){var C=this.getClosestType(c);var e=C.getEntityType();if(e){e=e.replace(/\s+/g,'').match(/([^,]+)/g);}if(!f){return M.getConvertedModelWithBoundAndRenamedLabels(C,e,this);}else{return M.getConvertedModelWithBoundAndRenamedLabels(C,e,this).then(function(d){return d.filter(function(m){return!m.checked;});});}};S.prototype.prepare=function(){if(!this.getPrepared()){var f=this._getFieldFetcherPromise();var i=this._prepareCustomFields();return Promise.all([f,i]);}else{return new Promise().resolve();}};S.prototype._getFieldFetcherPromise=function(){var t=this;return U.fetchODataPropertiesFor(this.getControl().getModel()).then(function(p){var e=t.getBoundEntityType();Object.keys(p).forEach(function(s){p[s].forEach(function(o){var c=t._applyChanges(o);var f=t._applyRules(c);if(!f&&c.entityName===e){t._mAvailableElements[c.name]=c;}else{t._mHiddenElements[c.name]=c;}});});t._mAvailableElements=Object.keys(t._mAvailableElements).reduce(function(A,s){var o=t._mAvailableElements[s];if(!o.controlId||!Object.keys(A).some(function(k){var P=A[k];return P.controlId===o.controlId;})){A[s]=o;}return A;},{});sap.ui.rta.controlAnalyzer.Base.prototype.prepare.apply(t);});};S.prototype._applyRules=function(e){var f=this._getRules();var F=false;for(var r in f){var R=f[r];if(R(e)){F=true;break;}}return F;};S.prototype._applyChanges=function(e){var c=e;var f=this._getChanges();f.forEach(function(C){c=C(c);});return c;};S.prototype._getRules=function(){return this._mRegisteredRules;};S.prototype.getBoundEntityType=function(){var c=this.getSelectedControl();if(E.isInstanceOf(c,"sap.ui.comp.smartform.GroupElement")){c=c.getParent();}if(c.getBindingContext()&&c.getModel()){return U.getBoundEntityType(c);}};S.prototype._retrieveElementFromMap=function(e,o){var r;if(o.isComplexProperty){r=e[o.complexTypePropertyName+"/"+o.name];}else{r=e[o.name];}return r;};S.prototype._determineGroupIndex=function(e){var I=0;if(e.getMetadata().getName()==="sap.ui.comp.smartform.Group"){var g=e.getParent().getAggregation("formContainers");for(var i=0;i<g.length;i++){if(g[i].getId()===e.getId()){I=i+1;break;}}}return I;};S.prototype._getChanges=function(){var t=this;return[function(e){var c=t.findChangedFieldLabels(e);var C=t._retrieveElementFromMap(c,e);if(C){e["fieldLabel"]=C;}return e;},function(e){var c;if(!t._mBoundFields){t._mBoundFields=t.findBoundFields(true);}if(e.isComplexProperty){c=t._mBoundFields[e.complexTypePropertyName+"/"+e.name];}else{c=t._mBoundFields[e.name];}if(c){e["controlId"]=c;}return e;}];};S.prototype.checkTargetZone=function(p,A,m){var s=E.getClosestElementOfType(m,"sap.ui.comp.smartform.SmartForm");var t=E.getClosestElementOfType(p,"sap.ui.comp.smartform.SmartForm");if(s===t){return true;}};S.prototype.isMandatory=function(e){var m=false;if(E.isInstanceOf(e,"sap.ui.comp.smartform.GroupElement")){var f=e.getFields();for(var i=0;i<f.length;i++){var g=f[i];if(E.isInstanceOf(g,"sap.ui.comp.smartfield.SmartField")&&g.getMandatory()){m=true;break;}}}else if(E.isInstanceOf(e,"sap.ui.comp.smartform.Group")){var G=e.getGroupElements();for(var j=0;j<G.length;j++){return this.isMandatory(G[j]);}}return m;};S.prototype.isHideable=function(e){return((E.isInstanceOf(e,"sap.ui.comp.smartform.GroupElement")||E.isInstanceOf(e,"sap.ui.comp.smartform.Group"))&&!this.isMandatory(e));};return S;},true);};if(!jQuery.sap.isDeclared('sap.ui.rta.plugin.CreateContainer')){jQuery.sap.declare('sap.ui.rta.plugin.CreateContainer');jQuery.sap.require('sap.ui.dt.Plugin');jQuery.sap.require('sap.ui.fl.Utils');jQuery.sap.require('sap.ui.dt.OverlayRegistry');sap.ui.define("sap/ui/rta/plugin/CreateContainer",['sap/ui/dt/Plugin','sap/ui/fl/Utils','sap/ui/rta/Utils','sap/ui/dt/OverlayRegistry'],function(P,F,R,O){"use strict";var C=P.extend("sap.ui.rta.plugin.CreateContainer",{metadata:{library:"sap.ui.rta",properties:{},associations:{},events:{}}});C.prototype.getEffectiveDesignTimeMetadata=function(o){return o.getDesignTimeMetadata();};C.prototype._getParentOverlay=function(s,o){var p;if(s){p=o.getPublicParentElementOverlay();}else{p=o;}return p;};C.prototype.getCreateAction=function(s,o){var p=this._getParentOverlay(s,o);var d=this.getEffectiveDesignTimeMetadata(p);var a=d.getAggregationAction("createContainer",o.getElementInstance());return a[0];};C.prototype.isCreateAvailable=function(s,o){return!!this.getCreateAction(s,o);};C.prototype.isCreateEnabled=function(s,o){var a=this.getCreateAction(s,o);if(!a){return false;}if(a.isEnabled&&typeof a.isEnabled==="function"){var i=a.isEnabled;return i.call(null,o.getElementInstance());}else{return true;}};C.prototype._getCreatedContainerId=function(a,n){var i=n;if(a.getCreatedContainerId&&typeof a.getCreatedContainerId==="function"){var m=a.getCreatedContainerId;i=m.call(null,n);}return O.getOverlay(i);};C.prototype._determineIndex=function(p,s,a,g){return R.getIndex(p,s,a,g);};C.prototype._getText=function(a,d,t){var c=d.getLibraryText(a.containerTitle);var T=sap.ui.getCore().getLibraryResourceBundle("sap.ui.rta");return T.getText(t,c);};C.prototype.getCreateContainerText=function(s,o){var a=this.getCreateAction(s,o);var p=this._getParentOverlay(s,o);var d=this.getEffectiveDesignTimeMetadata(p);var t="CTX_CREATE_CONTAINER";return this._getText(a,d,t);};C.prototype._getContainerTitle=function(a,d){var t="TITLE_CREATE_CONTAINER";return this._getText(a,d,t);};C.prototype.handleCreate=function(s,o){var a=this.getCreateAction(s,o);var p=this._getParentOverlay(s,o);var d=this.getEffectiveDesignTimeMetadata(p);var t=p.getElementInstance();var v=F.getViewForControl(t);var S;if(s){S=o.getElementInstance();}var n=v.createId(jQuery.sap.uid());var g=d.getAggregation(a.aggregation).getIndex;var i=this._determineIndex(t,S,a.aggregation,g);var c=this.getCommandFactory().getCommandFor(t,"createContainer",{newControlId:n,label:this._getContainerTitle(a,d),index:i},d);this.fireElementModified({"command":c});var N=this._getCreatedContainerId(a,n);N.setSelected(true);return N;};return C;},true);};if(!jQuery.sap.isDeclared('sap.ui.rta.plugin.MultiSelection')){
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

(c) Copyright 2009-2016 SAP SE. All rights reserved
 */
jQuery.sap.declare('sap.ui.rta.plugin.MultiSelection');jQuery.sap.require('sap.ui.dt.Plugin');jQuery.sap.require('sap.ui.dt.ElementUtil');sap.ui.define("sap/ui/rta/plugin/MultiSelection",['sap/ui/dt/Plugin','sap/ui/dt/ElementUtil','sap/ui/rta/Utils'],function(P,E,R){"use strict";var M=P.extend("sap.ui.rta.plugin.MultiSelection",{metadata:{library:"sap.ui.rta",properties:{multiSelectionTypes:{type:"string[]"}}}});M.prototype.init=function(){P.prototype.init.apply(this,arguments);this._fnKeyDown=this._onKeyDown.bind(this);this._fnKeyUp=this._onKeyUp.bind(this);window.addEventListener("keydown",this._fnKeyDown);window.addEventListener("keyup",this._fnKeyUp);};M.prototype.exit=function(){P.prototype.exit.apply(this,arguments);window.removeEventListener("keydown",this._fnKeyDown);window.removeEventListener("keyup",this._fnKeyUp);};M.prototype.setDesignTime=function(d){this._oDesignTime=d;if(this._oDesignTime){this._oDesignTime.detachSelectionChange(this._onDesignTimeSelectionChange,this);}P.prototype.setDesignTime.apply(this,arguments);if(d){d.attachSelectionChange(this._onDesignTimeSelectionChange,this);}};M.prototype._onKeyDown=function(e){if(sap.ui.Device.os.name===sap.ui.Device.os.OS.WINDOWS){if(e.keyCode===17){this._oDesignTime.setSelectionMode(sap.ui.dt.SelectionMode.Multi);}}else if(sap.ui.Device.os.name===sap.ui.Device.os.OS.MACINTOSH){if(e.keyCode===91||e.keyCode===93){this._oDesignTime.setSelectionMode(sap.ui.dt.SelectionMode.Multi);}}};M.prototype._onKeyUp=function(e){if(sap.ui.Device.os.name===sap.ui.Device.os.OS.WINDOWS){if(e.keyCode===17){this._oDesignTime.setSelectionMode(sap.ui.dt.SelectionMode.Single);}}else if(sap.ui.Device.os.name===sap.ui.Device.os.OS.MACINTOSH){if(e.keyCode===91||e.keyCode===93){this._oDesignTime.setSelectionMode(sap.ui.dt.SelectionMode.Single);}}};M.prototype._onDesignTimeSelectionChange=function(e){if(this._oDesignTime.getSelectionMode()===sap.ui.dt.SelectionMode.Single){return;}var m=this.getMultiSelectionTypes();var b=true;var c=e.getParameter("selection")[e.getParameter("selection").length-1];var s=this._oDesignTime.getSelection();if(s&&s.length===1){c.setSelected(true);return;}if(!c||this._oDesignTime.getSelectionMode()===sap.ui.dt.SelectionMode.Single){return;}m.forEach(function(t,i,a){s.forEach(function(S){if(!E.isInstanceOf(S.getElementInstance(),t)){b=false;}});c.setSelected(b);});};return M;},true);};if(!jQuery.sap.isDeclared('sap.ui.rta.plugin.Remove')){
/*
 * ! SAP UI development toolkit for HTML5 (SAPUI5)

(c) Copyright 2009-2016 SAP SE. All rights reserved
 */
jQuery.sap.declare('sap.ui.rta.plugin.Remove');jQuery.sap.require('sap.ui.dt.Plugin');sap.ui.define("sap/ui/rta/plugin/Remove",['sap/ui/dt/Plugin','sap/ui/rta/Utils','sap/ui/rta/command/CompositeCommand'],function(P,U,C){"use strict";var R=P.extend("sap.ui.rta.plugin.Remove",{metadata:{library:"sap.ui.rta",properties:{},associations:{},events:{}}});R.prototype.registerElementOverlay=function(o){o.attachBrowserEvent("keydown",this._onKeyDown,this);};R.prototype._getEffectiveDesignTimeMetadata=function(o){var d;if(o.isInHiddenTree()){var p=o.getPublicParentAggregationOverlay();d=p.getDesignTimeMetadata();}else{d=o.getDesignTimeMetadata();}return d;};R.prototype._getRemoveAction=function(o){return this._getEffectiveDesignTimeMetadata(o).getAction("remove",o.getElementInstance());};R.prototype.isRemoveAvailable=function(o){return!!this._getRemoveAction(o);};R.prototype.isRemoveEnabled=function(o){var a=this._getRemoveAction(o);if(!a){return false;}if(typeof a.isEnabled!=="undefined"){if(typeof a.isEnabled==="function"){return a.isEnabled(o.getElementInstance());}else{return a.isEnabled;}}return true;};R.prototype._getConfirmationText=function(o){var a=this._getRemoveAction(o);if(a&&a.getConfirmationText){return a.getConfirmationText(o.getElementInstance());}};R.prototype.deregisterElementOverlay=function(o){o.detachBrowserEvent("keydown",this._onKeyDown,this);};R.prototype._onKeyDown=function(e){if(e.keyCode===jQuery.sap.KeyCodes.DELETE){e.stopPropagation();this.removeElement();}};R.prototype.removeElement=function(o){var s;if(o){s=o;}else{var d=this.getDesignTime();s=d.getSelection();}if(s.length>0){this._handleRemove(s);}};R.prototype._getRemoveCommand=function(e,r,d){return this.getCommandFactory().getCommandFor(e,"Remove",{removedElement:r},d);};R.prototype._fireElementModified=function(c){if(c.getCommands().length){this.fireElementModified({"command":c});}};R.prototype._handleRemove=function(s){var t=this;var p=[];var c=new C();s.forEach(function(o){var a;var r=o.getElementInstance();var e;var d=t._getEffectiveDesignTimeMetadata(o);if(o.isInHiddenTree()){e=o.getPublicParentElementOverlay().getElementInstance();}else{e=r;}if(t.isRemoveEnabled(o)){var b=t._getConfirmationText(o);if(b){p.push(U.openRemoveConfirmationDialog(r,b).then(function(f){if(f){a=t._getRemoveCommand(e,r,d);c.addCommand(a);}}));}else{a=t._getRemoveCommand(e,r,d);c.addCommand(a);}}});if(p.length){Promise.all(p).then(function(){t._fireElementModified(c);});}else{t._fireElementModified(c);}};return R;},true);};if(!jQuery.sap.isDeclared('sap.ui.rta.plugin.Rename')){
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

(c) Copyright 2009-2016 SAP SE. All rights reserved
 */
jQuery.sap.declare('sap.ui.rta.plugin.Rename');jQuery.sap.require('jquery.sap.global');jQuery.sap.require('sap.ui.dt.Plugin');jQuery.sap.require('sap.ui.dt.ElementUtil');jQuery.sap.require('sap.ui.dt.OverlayUtil');jQuery.sap.require('sap.ui.dt.OverlayRegistry');jQuery.sap.require('sap.ui.dt.DOMUtil');sap.ui.define("sap/ui/rta/plugin/Rename",['jquery.sap.global','sap/ui/dt/Plugin','sap/ui/dt/ElementUtil','sap/ui/dt/OverlayUtil','sap/ui/dt/OverlayRegistry','sap/ui/rta/Utils','sap/ui/dt/DOMUtil'],function(q,P,E,O,a,U,D){"use strict";var R=P.extend("sap.ui.rta.plugin.Rename",{metadata:{library:"sap.ui.rta",properties:{oldValue:"string"},associations:{},events:{"editable":{},"nonEditable":{}}}});R.prototype.exit=function(){P.prototype.exit.apply(this,arguments);if(this._$oEditableControlDomRef){this._stopEdit();}clearTimeout(this._iStopTimeout);};R.prototype.setDesignTime=function(d){this._aSelection=[];var o=this.getDesignTime();if(o){o.detachSelectionChange(this._onDesignTimeSelectionChange,this);}P.prototype.setDesignTime.apply(this,arguments);if(d){d.attachSelectionChange(this._onDesignTimeSelectionChange,this);this._aSelection=d.getSelection();}};R.prototype._getEffectiveDesignTimeMetadata=function(o){var d;if(o.isInHiddenTree()){var p=o.getPublicParentAggregationOverlay();if(p){d=p.getDesignTimeMetadata();}}else{d=o.getDesignTimeMetadata();}return d;};R.prototype._getRenameAction=function(o){var d=this._getEffectiveDesignTimeMetadata(o);if(d&&d.getAction){return d.getAction("rename",o.getElementInstance());}else{return;}};R.prototype.isRenameAvailable=function(o){var r=this._getRenameAction(o);if(r){return true;}else{return false;}};R.prototype.isRenameEnabled=function(o){var A=this._getRenameAction(o);if(!A){return false;}if(typeof A.isEnabled!=="undefined"){if(typeof A.isEnabled==="function"){return A.isEnabled(o.getElementInstance());}else{return A.isEnabled;}}return true;};R.prototype.registerElementOverlay=function(o){o.attachEvent("editableChange",this._manageClickEvent,this);if(this.isRenameAvailable(o)){o.setEditable(true);}};R.prototype.deregisterElementOverlay=function(o){o.detachEvent("editableChange",this._manageClickEvent,this);o.detachBrowserEvent("click",this._onClick,this);};R.prototype._onClick=function(e){var o=sap.ui.getCore().byId(e.currentTarget.id);if(this.isRenameEnabled(o)){this.startEdit(o);e.preventDefault();}};R.prototype._onDesignTimeSelectionChange=function(e){var t=this;var s=e.getParameter("selection");s.forEach(function(o){if(t._aSelection.indexOf(o)===-1){t._aSelection.push(o);}});t._aSelection.forEach(this._manageClickEvent,this);};R.prototype._manageClickEvent=function(e){var o=e.getSource?e.getSource():e;if(o.isSelected()&&this.isRenameAvailable(o)){o.attachBrowserEvent("click",this._onClick,this);}else{o.detachBrowserEvent("click",this._onClick,this);}};R.prototype.startEdit=function(o){this._oEditedOverlay=o;var e=o.getElementInstance();var d=this._getEffectiveDesignTimeMetadata(this._oEditedOverlay);var v=d.getAction("rename",e).domRef;var b=d.getAssociatedDomRef(e,v);this._$oEditableControlDomRef=q(b);var c=sap.ui.dt.OverlayRegistry.getOverlay(b.id)||o;var w=q("<div class='sapUiRtaEditableField'></div>").appendTo(c.$());this._$editableField=q("<div contentEditable='true'></div>").appendTo(w);if(this._$oEditableControlDomRef.text()===""){this._$oEditableControlDomRef.text("_?_");this._$editableField.text("");}else{this._$editableField.text(this._$oEditableControlDomRef.text());}D.copyComputedStyles(this._$oEditableControlDomRef,this._$editableField);this._$editableField.children().remove();this._$editableField.css({"-moz-user-modify":"read-write","-webkit-user-modify":"read-write","-ms-user-modify":"read-write","user-modify":"read-write","text-overflow":"clip","margin-top":parseInt(this._$editableField.css("margin-top"),10)-1+"px","margin-left":parseInt(this._$editableField.css("margin-left"),10)-1+"px"});this._$oEditableControlDomRef.css("visibility","hidden");this._$editableField.one("focus",this._onEditableFieldFocus.bind(this));this._$editableField.on("blur",this._onEditableFieldBlur.bind(this));this._$editableField.on("keydown",this._onEditableFieldKeydown.bind(this));this._$editableField.on("dragstart",this._stopPropagation.bind(this));this._$editableField.on("drag",this._stopPropagation.bind(this));this._$editableField.on("dragend",this._stopPropagation.bind(this));this._$editableField.on("click",this._stopPropagation.bind(this));this._$editableField.on("mousedown",this._stopPropagation.bind(this));this._$editableField.focus();this.setOldValue(this._getCurrentEditableFieldText());};R.prototype._stopPropagation=function(e){e.stopPropagation();};R.prototype._onEditableFieldFocus=function(e){this._oEditedOverlay.setSelected(false);var b=e.target;var r=document.createRange();r.selectNodeContents(b);var s=window.getSelection();s.removeAllRanges();s.addRange(r);};R.prototype._stopEdit=function(r){if(this._$oEditableControlDomRef.text()==="_?_"){this._$oEditableControlDomRef.text("");}this._oEditedOverlay.$().find(".sapUiRtaEditableField").remove();this._$oEditableControlDomRef.css("visibility","visible");if(r){var o=this._oEditedOverlay;this._iStopTimeout=setTimeout(function(){o.setSelected(true);o.focus();},0);}delete this._$editableField;delete this._$oEditableControlDomRef;delete this._oEditedOverlay;};R.prototype._onEditableFieldBlur=function(e){this._emitLabelChangeEvent();this._stopEdit();};R.prototype._onEditableFieldKeydown=function(e){if(e.keyCode===q.sap.KeyCodes.ENTER){e.preventDefault();this._emitLabelChangeEvent();this._stopEdit(true);}else if(e.keyCode===q.sap.KeyCodes.ESCAPE){e.preventDefault();this._stopEdit(true);}};R.prototype._emitLabelChangeEvent=function(){var t=this._getCurrentEditableFieldText();if(this.getOldValue()!==t){this._$oEditableControlDomRef.text(t);try{var r;var e;var o=this._oEditedOverlay.getElementInstance();var d=this._getEffectiveDesignTimeMetadata(this._oEditedOverlay);if(this._oEditedOverlay.isInHiddenTree()){e=this._oEditedOverlay.getPublicParentElementOverlay().getElementInstance();}else{e=o;}r=this.getCommandFactory().getCommandFor(e,"rename",{renamedElement:o,newValue:t},d);this.fireElementModified({"command":r});}catch(b){q.sap.log.error("Error during rename : ",b);}}};R.prototype._getCurrentEditableFieldText=function(){return this._$editableField.text();};return R;},true);};if(!jQuery.sap.isDeclared('sap.ui.rta.plugin.Selection')){
/*
 * ! SAP UI development toolkit for HTML5 (SAPUI5)

(c) Copyright 2009-2016 SAP SE. All rights reserved
 */
jQuery.sap.declare('sap.ui.rta.plugin.Selection');jQuery.sap.require('sap.ui.dt.Plugin');sap.ui.define("sap/ui/rta/plugin/Selection",['sap/ui/dt/Plugin','sap/ui/rta/Utils'],function(P,U){"use strict";function _(o){if(o&&!o.isSelectable()){var s=U.isEditable(o);o.setSelectable(s);return s;}return!!o;}var S=P.extend("sap.ui.rta.plugin.Selection",{metadata:{library:"sap.ui.rta",properties:{},associations:{},events:{}}});S.prototype.registerElementOverlay=function(o){_(o);o.attachBrowserEvent("click",this._onClick,this);o.attachBrowserEvent("keydown",this._onKeyDown,this);o.attachBrowserEvent("mousedown",this._onMouseDown,this);};S.prototype.deregisterElementOverlay=function(o){o.detachBrowserEvent("click",this._onClick,this);o.detachBrowserEvent("keydown",this._onKeyDown,this);o.detachBrowserEvent("mousedown",this._onMouseDown,this);};S.prototype._onKeyDown=function(e){var o=U.getFocusedOverlay();_(o);if(e.keyCode===jQuery.sap.KeyCodes.ENTER){if((o)&&(!o.isSelected())){o.setSelected(true);e.stopPropagation();}}else if((e.keyCode===jQuery.sap.KeyCodes.ARROW_UP)&&(e.shiftKey===false)&&(e.altKey===false)&&(e.ctrlKey===false)){if(o){var p=o.getParentElementOverlay();if(p&&_(p)){p.focus();e.stopPropagation();}}}else if((e.keyCode===jQuery.sap.KeyCodes.ARROW_DOWN)&&(e.shiftKey===false)&&(e.altKey===false)&&(e.ctrlKey===false)){if(o){var f=U.getFirstFocusableChildOverlay(o);if(f){f.focus();e.stopPropagation();}}}else if((e.keyCode===jQuery.sap.KeyCodes.ARROW_LEFT)&&(e.shiftKey===false)&&(e.altKey===false)&&(e.ctrlKey===false)){if(o){var a=U.getPreviousFocusableSiblingOverlay(o);if(a){a.focus();e.stopPropagation();}}}else if((e.keyCode===jQuery.sap.KeyCodes.ARROW_RIGHT)&&(e.shiftKey===false)&&(e.altKey===false)&&(e.ctrlKey===false)){if(o){var n=U.getNextFocusableSiblingOverlay(o);if(n){n.focus();e.stopPropagation();}}}};S.prototype._onMouseDown=function(e){if(sap.ui.Device.browser.name=="ie"){var o=sap.ui.getCore().byId(e.currentTarget.id);if(_(o)){o.focus();e.stopPropagation();}else{o.getDomRef().blur();}e.preventDefault;}};S.prototype._onClick=function(e){var o=sap.ui.getCore().byId(e.currentTarget.id);if(_(o)){o.setSelected(!o.getSelected());e.preventDefault();e.stopPropagation();}};return S;},true);};if(!jQuery.sap.isDeclared('sap.ui.rta.plugin.additionalElements.AdditionalElementsAnalyzer')){jQuery.sap.declare('sap.ui.rta.plugin.additionalElements.AdditionalElementsAnalyzer');jQuery.sap.require('sap.ui.comp.odata.MetadataAnalyser');jQuery.sap.require('sap.ui.comp.smartfield.AnnotationHelper');jQuery.sap.require('sap.ui.core.StashedControlSupport');jQuery.sap.require('sap.ui.dt.ElementUtil');sap.ui.define("sap/ui/rta/plugin/additionalElements/AdditionalElementsAnalyzer",['sap/ui/comp/odata/MetadataAnalyser','sap/ui/comp/smartfield/AnnotationHelper','sap/ui/core/StashedControlSupport','sap/ui/dt/ElementUtil','sap/ui/rta/Utils'],function(M,A,S,E,R){"use strict";var a=new A();function _(j,m){var n=m?m:j.getModel();var B=j.getBindingContext();if(B){var p=n.oMetadata._getEntityTypeByPath(B.getPath());return p.name;}return"";}function b(p){if(p&&p.type){if(p.type.toLowerCase().indexOf("edm")!==0){return true;}}return false;}function c(O,m){return O.reduce(function(j,p){var P=p;if(b(p)){P=m.getFieldsByComplexTypeName(p.type).map(function(C){C.bindingPath=p.name+"/"+C.name;C.entityName=p.entityName;C.referencedComplexPropertyName=p.fieldLabel?p.fieldLabel:p.name;return C;});}else{P.bindingPath=p.name;}return j.concat(P);},[]);}function d(O,j){return O.filter(function(p){return p.visible;}).filter(function(p){var F=a.getFieldControlPath(p);if(F){var m=j.getBindingContext().getProperty(F);return m!==0;}return true;});}function e(j){var m=j.getModel();var r=[];if(m){var s=m.getMetadata().getName();if(s==="sap.ui.model.odata.ODataModel"||s==="sap.ui.model.odata.v2.ODataModel"){r=m.getMetaModel().loaded().then(function(){var n=new M(m);var p=_(j,m);var O=n.getFieldsByEntityTypeName(p)||[];O=c(O,n);O=d(O,j);return O;});}}return r;}function f(O){return{selected:false,label:O.renamedLabel?O.renamedLabel:O.fieldLabel,referencedComplexPropertyName:O.referencedComplexPropertyName?O.referencedComplexPropertyName:"",duplicateComplexName:O.duplicateComplexName?O.duplicateComplexName:false,tooltip:O.quickInfo||O.fieldLabel,type:"odata",entityType:O.entityName,name:O.name,bindingPath:O.bindingPath,originalLabel:O.renamedLabel&&O.renamedLabel!==O.fieldLabel?O.fieldLabel:""};}function g(D){var j=D.element;var m=D.action;return{selected:false,label:R.getLabelForElement(j,m.getLabel),tooltip:R.getLabelForElement(j,m.getLabel),referencedComplexPropertyName:j.referencedComplexPropertyName?j.referencedComplexPropertyName:"",duplicateComplexName:j.duplicateComplexName?j.duplicateComplexName:false,bindingPaths:j.bindingPaths,originalLabel:j.renamedLabel&&j.renamedLabel!==j.labelFromOData?j.labelFromOData:"",type:"invisible",element:j};}function h(j,m){var B=[];if(m.getBoundChildren){m.getBoundChildren(j).forEach(function(F){if(F.mBindingInfos){for(var I in F.mBindingInfos){var p=R.getPathFromBindingInfo(I,F.mBindingInfos);if(p){B.push(p);}}}});}return B;}function i(s,j){var B=[];E.getAggregation(j,s).forEach(function(C){if(jQuery.isEmptyObject(C.mBindingInfos)){for(var m in C.getMetadata().getAllAggregations()){B=B.concat(i(m,C));}}else{B.push(C);}});return B;}function k(j,r){if(r){return E.findAllSiblingsInContainer(j,r);}else{return[j];}}function l(O){O.forEach(function(m,n,O){if(m["duplicateComplexName"]!==true){for(var j=n+1;j<O.length-1;j++){if(m.fieldLabel===O[j].fieldLabel){m["duplicateComplexName"]=true;O[j]["duplicateComplexName"]=true;}}}});return O;}var o={enhanceInvisibleElements:function(p,r){return Promise.resolve().then(function(){return e(p);}).then(function(O){O=l(O);var I=r.elements||[];return I.map(function(j){var t=j.getMetadata().getName();var T=r.types[t];var m=T.action;j.bindingPaths=h(j,m);j.fieldLabel=R.getLabelForElement(j,m.getLabel);O.some(function(u){if(u.fieldLabel===j.fieldLabel){j.duplicateComplexName=true;return true;}});O.some(function(u){if(j.bindingPaths&&j.bindingPaths.indexOf(u.bindingPath)>-1){j.labelFromOData=u.fieldLabel;if(j.fieldLabel!==j.labelFromOData){j.renamedLabel=true;}if(u.referencedComplexPropertyName){j.referencedComplexPropertyName=u.referencedComplexPropertyName;}return true;}});return{element:j,action:m};});}).then(function(j){return j.map(g);});},getUnboundODataProperties:function(j,m){return Promise.resolve().then(function(){return e(j);}).then(function(O){var r=k(j,m.relevantContainer);var n=r.reduce(function(P,C){return P.concat(i.bind(null,m.aggregation)(C));},[]);var p={};var v=n.reduce(function(P,C){if(C.mBindingInfos){for(var I in C.mBindingInfos){var s=R.getPathFromBindingInfo(I,C.mBindingInfos);if(s){P[s]=true;p[s]=R.getLabelForElement(C,m.getLabel);}}}return P;},{});var F=m.filter?m.filter:function(){return true;};O=O.reduce(function(O,D){D["renamedLabel"]=p[D.bindingPath];if(!v[D.bindingPath]&&F(j,D)){return O.concat(D);}else{return O;}},[]);O=l(O);return O;}).then(function(u){return u.map(f);});}};return o;});};if(!jQuery.sap.isDeclared('sap.ui.rta.plugin.additionalElements.AdditionalElementsPlugin')){jQuery.sap.declare('sap.ui.rta.plugin.additionalElements.AdditionalElementsPlugin');jQuery.sap.require('jquery.sap.global');jQuery.sap.require('sap.ui.dt.Plugin');jQuery.sap.require('sap.ui.model.json.JSONModel');jQuery.sap.require('sap.ui.dt.ElementUtil');jQuery.sap.require('sap.ui.dt.OverlayRegistry');jQuery.sap.require('sap.ui.core.StashedControlSupport');jQuery.sap.require('sap.ui.dt.ElementDesignTimeMetadata');sap.ui.define("sap/ui/rta/plugin/additionalElements/AdditionalElementsPlugin",["jquery.sap.global","sap/ui/dt/Plugin","sap/ui/model/json/JSONModel",'sap/ui/dt/ElementUtil','sap/ui/dt/OverlayRegistry','sap/ui/rta/Utils','sap/ui/core/StashedControlSupport','sap/ui/dt/ElementDesignTimeMetadata'],function(q,P,J,E,O,U,S,a){"use strict";function _(s,o){var p,r;if(s){p=o.getParentElementOverlay();r=o.getPublicParentElementOverlay();}else{p=o;if(o.isInHiddenTree()){r=o.getPublicParentElementOverlay();}else{r=o;}}return{publicParentOverlay:r,parentOverlay:p,publicParent:r.getElementInstance(),parent:p.getElementInstance()};}function b(p,C){return C.sParentAggregationName;}function c(o,s){var I=E.getAggregation(o,s).filter(function(o){return o.getVisible&&!o.getVisible();});var p=S.getStashedControls(o.getId());return I.concat(p);}function d(s,o){var p=_(s,o);var D;var r={};if(o.isInHiddenTree()){D=p.publicParentOverlay.getDesignTimeMetadata();var R=D.getAggregationAction("reveal",p.parent)[0];if(R){if(!R.getAggregationName){R.getAggregationName=b;}var G=R.getInvisibleElements||c;var I=G(p.publicParent,R.aggregation);r[R.aggregation]={reveal:{elements:I,types:I.reduce(function(w,x){w[x.getMetadata().getName()]={designTimeMetadata:D,action:R};return w;},{})}};}}else{var t=[p.parentOverlay];var u=j(p.parent,p.parentOverlay.getDesignTimeMetadata());if(u!==p.parent){t=E.findAllSiblingsInContainer(p.parent,u).map(function(w){return O.getOverlay(w);});}var v;if(s){v=[o.getElementInstance().sParentAggregationName];}v=p.parentOverlay.getAggregationOverlays().filter(function(w){return!w.getDesignTimeMetadata().isIgnored();}).map(function(w){return w.getAggregationName();});r=v.reduce(function(w,x){var I=t.reduce(function(y,z){return y.concat(c(z.getElementInstance(),x));},[]);var T=I.reduce(function(T,y){var z=y.getMetadata().getName();if(!T[z]){if(z==="sap.ui.core._StashedControl"){T[z]={designTimeMetadata:new a({data:{name:{singular:function(){return sap.uxap.i18nModel.getResourceBundle().getText("SECTION_CONTROL_NAME");},plural:function(){return sap.uxap.i18nModel.getResourceBundle().getText("SECTION_CONTROL_NAME_PLURAL");}},actions:{reveal:{changeType:"unstashControl",getAggregationName:b}}}}),action:{changeType:"unstashControl",getAggregationName:b}};}else{var o=O.getOverlay(y);if(o){var D=o.getDesignTimeMetadata();var R=D&&D.getAction("reveal",y);if(R){if(!R.getAggregationName){R.getAggregationName=b;}T[z]={designTimeMetadata:D,action:R};}}}}return T;},{});if(I.length>0&&Object.keys(T).length>0){w[x]={reveal:{elements:I,types:T}};}return w;},{});}return r;}function e(s,o){var p=_(s,o);var D=p.publicParentOverlay.getDesignTimeMetadata();var r=D.getAggregationAction("addODataProperty",p.parent);var t=r.reduce(function(u,v){u[v.aggregation]={addODataProperty:{designTimeMetadata:D,action:v}};return u;},{});return t;}function f(s,o){var r=d(s,o);var p=e(s,o);var t=q.extend(true,r,p);var u=Object.keys(t);if(u.length===0){return{};}else if(u.length>1){q.sap.log.error("reveal or addODataProperty action defined for more than 1 aggregation, that is not yet possible");}var v=u[0];t[v].aggregation=v;return t[v];}var g=true,h=false;function i(r,o,p,s){var N=[];var C;var t;if(o.addODataProperty){var u=o.aggregation;var D=o.addODataProperty.designTimeMetadata;C=D.getAggregationDescription(u,p);if(C){t=s?C.singular:C.plural;N.push(t);}}if(o.reveal){Object.keys(o.reveal.types).forEach(function(w){var x=o.reveal.types[w];C=x.designTimeMetadata.getName(p);if(C){t=s?C.singular:C.plural;N.push(t);}});}var v=N.reduce(function(w,x){if(w.indexOf(x)===-1){w.push(x);}return w;},[]);var T=sap.ui.getCore().getLibraryResourceBundle("sap.ui.rta");if(v.length===1){t=v[0];}else{t=T.getText("MULTIPLE_CONTROL_NAME");}return T.getText(r,t);}function j(p,D){if(D.getData().getRelevantContainer){return D.getData().getRelevantContainer(p);}else{return p;}}var A=P.extend("sap.ui.rta.plugin.additionalElements.AdditionalElementsPlugin",{metadata:{library:"sap.ui.rta",properties:{analyzer:"object",dialog:"object",commandFactory:"object"},associations:{},events:{}},getContextMenuTitle:function(o,p){var r=_(o,p);var s=f(o,p);return i("CTX_ADD_ELEMENTS",s,r.parent,g);},isAvailable:function(o,p){var r=f(o,p);return r.reveal||r.addODataProperty;},isEnabled:function(o,p){if(o){if(!U.hasParentStableId(p)){return false;}}var r=f(o,p);if(r.reveal&&r.reveal.elements.length===0&&!r.addODataProperty){return false;}return U.isEditable(p);},showAvailableElements:function(o,p){var r=p[0];var s=_(o,r);var t=o&&r.getElementInstance();var u=[];var v=this;var w=f(o,r);if(w.reveal){u.push(this.getAnalyzer().enhanceInvisibleElements(s.publicParent,w.reveal));}if(w.addODataProperty){w.addODataProperty.relevantContainer=j(s.publicParent,w.addODataProperty.designTimeMetadata);u.push(this.getAnalyzer().getUnboundODataProperties(s.publicParent,w.addODataProperty));}if(w.aggregation){this._setDialogTitle(w,s.parent);}return Promise.resolve().then(function(){if(w.addODataProperty){return U.isServiceUpToDate();}}).then(function(){if(w.addODataProperty){return U.isCustomFieldAvailable(s.parent);}}).then(function(C){if(C){v._oCurrentFieldExtInfo=C;v.getDialog().setCustomFieldEnabled(true);v.getDialog().detachEvent('openCustomField',v._onOpenCustomField,v);v.getDialog().attachEvent('openCustomField',null,v._onOpenCustomField,v);}}).then(l.bind(null,u)).then(function(x){if(v.getDialog().getModel()){v.getDialog().getModel().setProperty("/elements",x);}else{v.getDialog().setModel(new J({elements:x}));}return v.getDialog().open().then(function(){v._createCommands(o,r,s,t,w.designTimeMetadata,w);}).catch(function(y){if(y instanceof Error){throw y;}});}).catch(function(x){if(x instanceof Error){throw x;}else{q.sap.log.info("Service not up to date, skipping add dialog","sap.ui.rta");}});},_setDialogTitle:function(o,p){var D=i("HEADER_ADDITIONAL_ELEMENTS",o,p,h);this.getDialog().setTitle(D);},_onOpenCustomField:function(o){var C=sap.ushell&&sap.ushell.Container&&sap.ushell.Container.getService("CrossApplicationNavigation");var H=(C&&C.hrefForExternal({target:{semanticObject:"CustomField",action:"develop"},params:{businessContexts:this._oCurrentFieldExtInfo.BusinessContexts,serviceName:this._oCurrentFieldExtInfo.ServiceName,serviceVersion:this._oCurrentFieldExtInfo.ServiceVersion,entityType:this._oCurrentFieldExtInfo.EntityType}}));U.openNewWindow(H);},_createCommands:function(s,o,p,r,D,t){var u=this;var v=k(this.getDialog());if(v.length>0){var C=this.getCommandFactory().getCommandFor(p.parent,"composite");v.forEach(function(w){var x;switch(w.type){case"invisible":var R=w.element;var T=R.getMetadata().getName();var y=t.reveal.types[T];var D=y.designTimeMetadata;if(p.publicParent!=p.parent){var z=D.createAggregationDesignTimeMetadata(t.aggregation);x=u.getCommandFactory().getCommandFor(p.publicParent,"reveal",{revealedElementId:R.getId(),hiddenParent:p.parent},z);}else{x=u.getCommandFactory().getCommandFor(R,"reveal",{},D);}C.addCommand(x);var B=y.action.getAggregationName(p.parent,R);var F=m(R,p);var G=p.parent;var H=U.getIndex(p.parent,r,B);var I=U.getIndex(F,R,B)-1;H=n(F,G,I,H);if(H!==I||p.parent!==R.getParent()){var K=p.publicParentOverlay.getDesignTimeMetadata();x=u.getCommandFactory().getCommandFor(p.publicParent,"move",{movedElements:[{element:R,sourceIndex:I,targetIndex:H}],source:{publicParent:p.publicParent,publicAggregation:t.aggregation,parent:F,aggregation:B},target:{publicParent:p.publicParent,publicAggregation:t.aggregation,parent:G,aggregation:B}},K);if(x){C.addCommand(x);}else{q.sap.log.warning("No move action configured for "+p.publicParent.getMetadata().getName()+", aggregation: "+t.aggregation,"sap.ui.rta");}}break;case"odata":var L=t.addODataProperty.designTimeMetadata;var M=L.createAggregationDesignTimeMetadata(t.aggregation);var N=U.getIndex(p.parent,r,t.aggregation,M.getData().getIndex);x=u.getCommandFactory().getCommandFor(p.publicParent,"addODataProperty",{newControlId:U.createFieldLabelId(p.publicParent,w.entityType,w.bindingPath),index:N,label:w.label,bindingString:w.bindingPath},L);C.addCommand(x);break;}});this.fireElementModified({"command":C});}}});function k(D){return D.getModel().getObject("/elements").filter(function(o){return o.selected;});}function l(p){return Promise.all(p).then(function(o){var r=o[0]||[];if(r&&o[1]){r=r.concat(o[1]);}return r;});}function m(r,p){var o=r.getParent();if(!o&&r.sParentId){o=sap.ui.getCore().byId(r.sParentId);}else if(!o){o=p.parent;}return o;}function n(s,t,o,T){if(s===t&&o<T&&o>-1){return T-1;}return T;}A.hasRevealActionsOnChildren=function(o){var r=d(false,o);return!!r&&Object.keys(r).length>0;};return A;});};if(!jQuery.sap.isDeclared('sap.ui.rta.util.FakeLrepConnectorLocalStorage')){jQuery.sap.declare('sap.ui.rta.util.FakeLrepConnectorLocalStorage');sap.ui.define("sap/ui/rta/util/FakeLrepConnectorLocalStorage",["sap/ui/rta/util/FakeLrepLocalStorage"],function(F){"use strict";var a={};a.create=function(c){if(Array.isArray(c)){c.forEach(function(e){F.saveChange(e.fileName,e);});}else{F.saveChange(c.fileName,c);}return Promise.resolve();};a.deleteChange=function(c){F.deleteChange(c.sChangeName);return Promise.resolve({response:undefined,status:"nocontent"});};a.deleteChanges=function(){F.deleteChanges();return Promise.resolve({response:undefined,status:"nocontent"});};a.loadChanges=function(c){var C=F.getChanges(),i=this.sInitialComponentJsonPath;return new Promise(function(r,b){jQuery.getJSON(i).done(function(R){R.changes=C;var d={changes:R,componentClassName:c};r(d);}).fail(function(e){b(e);});});};return a;},true);};if(!jQuery.sap.isDeclared('sap.ui.rta.controlAnalyzer.ControlAnalyzerFactory')){
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

(c) Copyright 2009-2016 SAP SE. All rights reserved
 */
jQuery.sap.declare('sap.ui.rta.controlAnalyzer.ControlAnalyzerFactory');sap.ui.define("sap/ui/rta/controlAnalyzer/ControlAnalyzerFactory",['sap/ui/rta/controlAnalyzer/SmartForm','sap/ui/rta/controlAnalyzer/Form','sap/ui/rta/controlAnalyzer/ObjectPage'],function(){"use strict";var C={};var _={'sap.ui.comp.smartform':{'Constructor':sap.ui.rta.controlAnalyzer.SmartForm},'sap.ui.layout.form':{'Constructor':sap.ui.rta.controlAnalyzer.Form},'sap.uxap':{'Constructor':sap.ui.rta.controlAnalyzer.ObjectPage},'sap':{'Constructor':sap.ui.rta.controlAnalyzer.Base},'findControlAnalyzerByName':function(c,n){var r=c._mapOfControllers[n];if(!r){var i=n.lastIndexOf('.');if(i>0){r=c._mapOfControllers.findControlAnalyzerByName(c,n.substr(0,i));}else if(i===-1){r=c._mapOfControllers.sap;}}return r;}};C._mapOfControllers=_;C.getControlAnalyzerFor=function(c){var r=null;if(c){var t=c.getMetadata().getName();var d=this._mapOfControllers.findControlAnalyzerByName(this,t);if(d){r=d.instance=new d.Constructor({"control":c});}}return r;};return C;},true);};if(!jQuery.sap.isDeclared('sap.ui.rta.command.AddODataProperty')){
/*
 * ! SAP UI development toolkit for HTML5 (SAPUI5)

(c) Copyright 2009-2016 SAP SE. All rights reserved
 */
jQuery.sap.declare('sap.ui.rta.command.AddODataProperty');jQuery.sap.require('jquery.sap.global');jQuery.sap.require('sap.ui.fl.Utils');jQuery.sap.require('sap.ui.fl.changeHandler.BaseTreeModifier');sap.ui.define("sap/ui/rta/command/AddODataProperty",['jquery.sap.global','sap/ui/rta/command/FlexCommand','sap/ui/rta/controlAnalyzer/ControlAnalyzerFactory',"sap/ui/fl/Utils","sap/ui/fl/changeHandler/BaseTreeModifier"],function(q,F,C,a,B){"use strict";var A=F.extend("sap.ui.rta.command.AddODataProperty",{metadata:{library:"sap.ui.rta",properties:{index:{type:"int"},newControlId:{type:"string"},label:{type:"string"},bindingString:{type:"string"}}}});A.prototype._getSpecificChangeInfo=function(){return{changeType:this.getChangeType(),index:this.getIndex(),newControlId:this.getNewControlId(),label:this.getLabel(),bindingPath:this.getBindingString()};};A.prototype._getFlexChange=function(){var s=this._getSpecificChangeInfo();var c=this._completeChangeContent(s);return{change:c,selectorElement:this._getElement()};};A.prototype._getForwardActionData=function(e){return this._getFlexChange();};A.prototype.undo=function(){var s=this.getNewControlId();var o=sap.ui.getCore().byId(s);if(o){o.destroy();}};A.prototype.serialize=function(){return this._getSpecificChangeInfo();};return A;},true);};if(!jQuery.sap.isDeclared('sap.ui.rta.command.AddSmart')){jQuery.sap.declare('sap.ui.rta.command.AddSmart');jQuery.sap.require('jquery.sap.global');jQuery.sap.require('sap.ui.fl.Utils');jQuery.sap.require('sap.ui.fl.changeHandler.BaseTreeModifier');sap.ui.define("sap/ui/rta/command/AddSmart",['jquery.sap.global','sap/ui/rta/command/FlexCommand','sap/ui/rta/controlAnalyzer/ControlAnalyzerFactory',"sap/ui/fl/Utils","sap/ui/fl/changeHandler/BaseTreeModifier"],function(q,F,C,a,B){"use strict";var A=F.extend("sap.ui.rta.command.AddSmart",{metadata:{library:"sap.ui.rta",properties:{source:{type:"object"},index:{type:"float"},newControlId:{type:"string"},labels:{type:"any[]"},jsTypes:{type:"any[]"},fieldValues:{type:"any[]"},valuePropertys:{type:"any[]"}},associations:{},events:{}}});A.prototype._getSpecificChangeInfo=function(){var s={changeType:this.getChangeType(),index:this.getIndex(),newControlId:this.getNewControlId(),labels:this.getLabels()};if(this.getJsTypes()){s.jsTypes=this.getJsTypes();}if(this.getFieldValues()){s.fieldValues=this.getFieldValues();}if(this.getValuePropertys()){s.valueProperty=this.getValuePropertys();}var c=C.getControlAnalyzerFor(this._getElement());if(c){s=c.mapSpecificChangeData("Add",s);}return s;};A.prototype._getFlexChange=function(){var s=this._getSpecificChangeInfo();var c=this._completeChangeContent(s);return{change:c,selectorElement:this._getElement()};};A.prototype._getForwardActionData=function(e){return this._getFlexChange();};A.prototype.undo=function(){var s=this.getNewControlId();var o=sap.ui.getCore().byId(s);if(o){o.destroy();}};A.prototype.serialize=function(){return this._getSpecificChangeInfo();};return A;},true);};if(!jQuery.sap.isDeclared('sap.ui.rta.command.CommandFactory')){
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

(c) Copyright 2009-2016 SAP SE. All rights reserved
 */
jQuery.sap.declare('sap.ui.rta.command.CommandFactory');jQuery.sap.require('sap.ui.base.ManagedObject');jQuery.sap.require('sap.ui.dt.ElementUtil');jQuery.sap.require('sap.ui.fl.registry.ChangeRegistry');sap.ui.define("sap/ui/rta/command/CommandFactory",['sap/ui/base/ManagedObject','sap/ui/rta/controlAnalyzer/ControlAnalyzerFactory','sap/ui/dt/ElementUtil','sap/ui/fl/registry/ChangeRegistry'],function(M,C,E,a){"use strict";var g=function(s,l){var r=a.getInstance().getRegistryItems({controlType:s,changeTypeName:l});if(r&&r[s]&&r[s][l]){var R=r[s][l];return R.getChangeTypeMetadata().getChangeHandler();}else{jQuery.sap.log.warning("No '"+l+"' change handler for "+s+" registered");}};var c=function(o,l,s){var n=l.getName();var A=C.getControlAnalyzerFor(o);if(A.mapSettings){s=A.mapSettings(n,o,s);}var p=A.getConfiguredElement(o);var q=p.getMetadata().getName();var r=A.getFlexChangeType(n,o,s);if(r){var t=g(q,r);if(t){l.setChangeHandler(t);l.setChangeType(r);if(o!==p&&l.setOriginalElement){var S=A._getStableElementForCommand(o);l.setOriginalElement(S);}}}else{jQuery.sap.log.warning("No "+n+" change type registered for "+q);}return true;};var f=function(o,l,A){var s;if(typeof(A)==="string"){s=A;}else{s=A&&A.changeType;}if(!s){return false;}var n=o.getMetadata().getName();var p=g(n,s);if(!p){return false;}l.setChangeHandler(p);l.setChangeType(s);return true;};var b=function(o,l,s,D){var n=s.element||sap.ui.getCore().byId(s.element.id);var A=D.getAggregationAction("createContainer",n)[0];var S=f(o,l,A);if(S){l.setCreateContainerMetadata(A);return true;}else{return false;}};var d=function(o,l,s,n){var S=s.source.publicAggregation;var A=n.createAggregationDesignTimeMetadata(S);var p=s.movedElements[0].element||sap.ui.getCore().byId(s.movedElements[0].id);var q=A.getMoveAction(p);A.destroy();return f(o,l,q);};var e=function(o,l,s,D){var r=s.renamedElement;var A=D.getAction("rename",r);var S=f(o,l,A);if(S){l.setRenameMetadata(A);return true;}else{return false;}};var h=function(o,l,s,D){var r=s.removedElement||sap.ui.getCore().byId(s.removedElement.id);var A=D.getAction("remove",r);var S=f(o,l,A);if(S){l.setRemoveMetadata(A);return true;}else{return false;}};var i=function(o,l,s,D){var n=s.element;var A=D.getAggregationAction("addODataProperty",n)[0];return f(o,l,A);};var j=function(o,l,s,D){var r=s.hiddenParent;var A=D.getAction("reveal",r);return f(o,l,A);};var F=function(o,s){var A=C.getControlAnalyzerFor(o);return A.getCommandClass(s);};var G=function(o){if(o.getMetadata){var A=C.getControlAnalyzerFor(o);return A.getConfiguredElement(o);}else{return o;}};var m={"hide":{findClass:F,configure:c},"unhide":{findClass:F,configure:c},"stash":{clazz:'sap.ui.rta.command.Stash'},"unstash":{clazz:'sap.ui.rta.command.Unstash'},"group":{clazz:'sap.ui.rta.command.Group'},"ungroup":{clazz:'sap.ui.rta.command.Ungroup'},"add":{findClass:F,configure:c},"createContainer":{clazz:'sap.ui.rta.command.CreateContainer',configure:b},"move":{clazz:'sap.ui.rta.command.Move',configure:d},"remove":{clazz:'sap.ui.rta.command.Remove',configure:h},"composite":{clazz:'sap.ui.rta.command.CompositeCommand'},"rename":{clazz:'sap.ui.rta.command.Rename',configure:e},"property":{clazz:'sap.ui.rta.command.Property'},"bindProperty":{clazz:'sap.ui.rta.command.BindProperty'},"addODataProperty":{clazz:'sap.ui.rta.command.AddODataProperty',configure:i},"reveal":{clazz:'sap.ui.rta.command.Reveal',configure:j},"settings":{clazz:'sap.ui.rta.command.Settings'}};var k=M.extend("sap.ui.rta.command.CommandFactory",{metadata:{library:"sap.ui.rta",properties:{},associations:{},events:{}}});k.getCommandFor=function(o,s,S,D){s=s[0].toLowerCase()+s.slice(1);var l=m[s];if(!l){throw new Error("Command '"+s+"' doesn't exist, check typing");}var n;if(l.findClass){n=l.findClass(o,s);}else{n=l.clazz;}jQuery.sap.require(n);var p=jQuery.sap.getObject(n);var q=G(o);S=jQuery.extend(S,{element:q,name:s});var r=new p(S);var t=true;if(l.configure){t=l.configure(o,r,S,D);}if(t){r.prepareActionData();return r;}else{r.destroy();}};return k;},true);};if(!jQuery.sap.isDeclared('sap.ui.rta.command.CreateContainer')){
/*
 * ! SAP UI development toolkit for HTML5 (SAPUI5)

(c) Copyright 2009-2016 SAP SE. All rights reserved
 */
jQuery.sap.declare('sap.ui.rta.command.CreateContainer');jQuery.sap.require('jquery.sap.global');sap.ui.define("sap/ui/rta/command/CreateContainer",['jquery.sap.global','sap/ui/rta/command/FlexCommand','sap/ui/rta/controlAnalyzer/ControlAnalyzerFactory'],function(q,F,C){"use strict";var a=F.extend("sap.ui.rta.command.CreateContainer",{metadata:{library:"sap.ui.rta",properties:{index:{type:"int"},newControlId:{type:"string"},label:{type:"string"},createContainerMetadata:{type:"object"}},associations:{},events:{}}});a.prototype._getSpecificChangeInfo=function(f){var s={changeType:this.getChangeType(),index:this.getIndex(),newControlId:this.getNewControlId(),newLabel:this.getLabel()};return s;};a.prototype._getFlexChange=function(){var p=this.getPreparedActionData(F.FORWARD);if(!p){var s=this._getSpecificChangeInfo();p=this._completeChangeContent(s);}return p;};a.prototype._getForwardActionData=function(e){return this._getFlexChange();};a.prototype._getBackwardActionData=function(e){var g=this.getCreateContainerMetadata().getState;var A=this.getNewControlId();var o=sap.ui.getCore().byId(A);if(g){return g.call(null,o);}else{q.sap.log.error("No getState implementation found for createContainer action ",o.getMetadata().getName()+".designtime");}};a.prototype.undo=function(){var r=this.getCreateContainerMetadata().restoreState;var A=this.getNewControlId();var o=sap.ui.getCore().byId(A);if(r){r.call(null,o);}else{q.sap.log.error("No restoreState implementation found for createContainer action ",o.getMetadata().getName()+".designtime");}};a.prototype.serialize=function(){return this._getSpecificChangeInfo();};return a;},true);};if(!jQuery.sap.isDeclared('sap.ui.rta.command.Group')){jQuery.sap.declare('sap.ui.rta.command.Group');jQuery.sap.require('sap.ui.dt.ElementDesignTimeMetadata');sap.ui.define("sap/ui/rta/command/Group",['sap/ui/rta/command/BaseCommand','sap/ui/rta/Utils','sap/ui/rta/controlAnalyzer/ControlAnalyzerFactory','sap/ui/dt/ElementDesignTimeMetadata'],function(B,U,C,E){"use strict";var G=B.extend("sap.ui.rta.command.Group",{metadata:{library:"sap.ui.rta",properties:{source:{type:"any"},index:{type:"float"},labels:{type:"any[]"},jsTypes:{type:"any[]"},fieldValues:{type:"any[]"},valuePropertys:{type:"any[]"},groupFields:{type:"any[]"},smartForm:{type:"any"}},associations:{},events:{}}});G.prototype.init=function(){this._aCommands=[];this._aOdataFields=[];};G.prototype.undo=function(){this._updateElement();for(var i=0;i<this._aCommands.length;i++){this._aCommands[i].undo();}this.getElement().destroy();};G.prototype.execute=function(){var t=this;return this._createGroupCommands().then(function(){for(var i=0;i<t._aCommands.length;i++){t._aCommands[i].execute();}});};G.prototype.getCommands=function(){return this._aCommands;};G.prototype.serialize=function(){var s=[];for(var i=0;i<this._aCommands.length;i++){s.push(this._aCommands[i].serialize());}return s;};G.prototype._updateElement=function(){var t=this;sap.ui.getCore().applyChanges();var p=this._aOdataFields.map(function(f){return t._getBindingPath(f);});var e=U.createNewSmartFormGroupElementId(this.getSmartForm(),p);this.setElement(sap.ui.getCore().byId(e));};G.prototype._createGroupCommands=function(){if(this._aCommands.length>0){return Promise.resolve();}var t=this;var s=sap.ui.rta.controlAnalyzer.ControlAnalyzerFactory.getControlAnalyzerFor(this.getSmartForm());var g=this.getGroupFields();return s.prepare().then(function(){var J=[];var f=[];var F=[];var a=[];var h=s.getHiddenElements();t._aOdataFields=[];for(var i=0;i<g.length;i++){var b=g[i].getFields();for(var z=0;z<b.length;z++){var o=b[z];var p=U.getElementBindingPaths(o);var c=U.findFieldBindingPathInFieldsArray(p,h);var d=h[c];var P=t._getBindingPath(d);t._aOdataFields.push(d);J.push(o.getMetadata().getName());f.push(d["fieldLabel"]);F.push(P);a.push(p[c].valueProperty);}var e=sap.ui.rta.command.CommandFactory.getCommandFor(g[i],"Hide");t._aCommands.push(e);}var n=U.createNewSmartFormGroupElementId(t.getSmartForm(),F);if(sap.ui.getCore().byId(n)){var k=sap.ui.getCore().byId(n);var l=k.getParent();return l.getMetadata().loadDesignTime().then(function(D){var m=sap.ui.rta.command.CommandFactory.getCommandFor(k,"Unhide");var q=sap.ui.rta.command.CommandFactory.getCommandFor(l,"Move",{movedElements:[{element:k,sourceIndex:0,targetIndex:t.getIndex()}],target:{publicAggregation:"formElements",aggregation:"formElements",parent:l},source:{publicAggregation:"formElements",aggregation:"formElements",parent:l}},new E({data:D}));var N;for(var j=0;j<f.length;j++){N=N?N+"/"+f[j]:f[j];}var r=sap.ui.rta.command.CommandFactory.getCommandFor(k,"Rename",{newValue:N});t._aCommands.push(r);t._aCommands.push(m);t._aCommands.push(q);});}else{t._aCommands.push(U.createNewAddFieldsCommand(t.getSmartForm(),t.getSource().getParent(),t.getIndex(),J,f,a,F));}});};G.prototype._getBindingPath=function(d){var p="";if(d.isComplexProperty){p=d.complexTypePropertyName+"/"+d.name;}else{p=d.name;}return p;};return G;},true);};if(!jQuery.sap.isDeclared('sap.ui.rta.command.Ungroup')){jQuery.sap.declare('sap.ui.rta.command.Ungroup');sap.ui.define("sap/ui/rta/command/Ungroup",['sap/ui/rta/command/BaseCommand','sap/ui/rta/Utils','sap/ui/rta/controlAnalyzer/ControlAnalyzerFactory'],function(B,U,C){"use strict";var a=B.extend("sap.ui.rta.command.Ungroup",{metadata:{library:"sap.ui.rta",properties:{changeType:{type:"string",defaultValue:"UngroupControl"},smartForm:{type:"object"}},associations:{},events:{}}});a.prototype.init=function(){this._aCommands=[];this._aUngroupFields=[];};a.prototype.undo=function(){var u=this._aUngroupFields;var j=[];var f=[];var F=[];var b=[];if(u){for(var i=0;i<u.length;i++){var e=sap.ui.getCore().byId(u[i].controlId);var d=u[i];j.push(e.getFields()[0].getMetadata().getName());f.push(d["sap:label"]);var p="";if(d.isComplexProperty){p=d.complexTypePropertyName+"/"+d.name;}else{p=d.name;}F.push(p);b.push(d.valueProperty);var o=sap.ui.rta.command.CommandFactory.getCommandFor(e,"Hide");o.execute();}var A=U.createNewAddFieldsCommand(this.getSmartForm(),e.getParent(),0,j,f,b,F);A.execute();}};a.prototype.execute=function(){var t=this;return this._createUngroupCommands().then(function(){for(var i=0;i<t._aCommands.length;i++){t._aCommands[i].execute();}t._updateElement();t.getElement().destroy();});};a.prototype.getCommands=function(){return this._aCommands;};a.prototype.serialize=function(){var s=[];for(var i=0;i<this._aCommands.length;i++){s.push(this._aCommands[i].serialize());}return s;};a.prototype._createUngroupCommands=function(){var t=this;var g=this.getElement().getParent();if(this._aCommands.length>0){return Promise.resolve();}var s=sap.ui.rta.controlAnalyzer.ControlAnalyzerFactory.getControlAnalyzerFor(this.getSmartForm());return s.prepare().then(function(){var h=s.getHiddenElements();var f=t.getElement().getFields();for(var i=0;i<f.length;i++){var F=f[i];var p=U.getElementBindingPaths(F);var b=U.findFieldBindingPathInFieldsArray(p,h);var o=h[b];o["valueProperty"]=p[b].valueProperty;if(o&&o.controlId){var G=sap.ui.getCore().byId(o.controlId);var u=sap.ui.rta.command.CommandFactory.getCommandFor(G,"Unhide");t._aCommands.push(u);}else if(o&&!o.controlId){var P=t._getBindingPath(o);var n=U.createNewAddFieldsCommand(t.getSmartForm(),g,0,[F.getMetadata().getName()],[o["sap:label"]],[p[o.name].valueProperty],[P]);t._aCommands.push(n);o["controlId"]=n.getNewControlId();}t._aUngroupFields.push(o);}});};a.prototype._updateElement=function(){sap.ui.getCore().applyChanges();if(this._aUngroupFields.length===0||(this.getElement()&&!this.getElement().bIsDestroyed)){return;}var p=[];for(var i=0;i<this._aUngroupFields.length;i++){p.push(this._getBindingPath(this._aUngroupFields[i]));}var e=U.createNewSmartFormGroupElementId(this.getSmartForm(),p);this.setElement(sap.ui.getCore().byId(e));};a.prototype._getBindingPath=function(d){var p="";if(d.isComplexProperty){p=d.complexTypePropertyName+"/"+d.name;}else{p=d.name;}return p;};return a;},true);};if(!jQuery.sap.isDeclared('sap.ui.rta.plugin.RTAElementMover')){
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

(c) Copyright 2009-2016 SAP SE. All rights reserved
 */
jQuery.sap.declare('sap.ui.rta.plugin.RTAElementMover');jQuery.sap.require('sap.ui.dt.plugin.ElementMover');jQuery.sap.require('sap.ui.dt.OverlayUtil');jQuery.sap.require('sap.ui.dt.ElementUtil');jQuery.sap.require('sap.ui.fl.Utils');sap.ui.define("sap/ui/rta/plugin/RTAElementMover",['sap/ui/dt/plugin/ElementMover','sap/ui/dt/OverlayUtil','sap/ui/dt/ElementUtil','sap/ui/fl/Utils','sap/ui/rta/Utils','sap/ui/rta/command/CommandFactory'],function(E,O,a,F,U,C){"use strict";var R=E.extend("sap.ui.rta.plugin.RTAElementMover",{metadata:{library:"sap.ui.rta",properties:{commandFactory:{type:"any",defaultValue:C},movableTypes:{type:"string[]",defaultValue:["sap.ui.core.Element"]}},associations:{},events:{}}});function g(o,i){var r;if(o.isInHiddenTree()&&o.getPublicParentElementOverlay()){r=o.getPublicParentElementOverlay().getElementInstance();}else if(!o.isInHiddenTree()){var e=o.getElementInstance();var d=o.getDesignTimeMetadata();if(i&&!d.getData().getRelevantContainer){r=e;}else{r=d.getRelevantContainer(e);}}return r;}E.prototype.isMovableType=function(e){return true;};R.prototype.checkMovable=function(o){var m=E.prototype.checkMovable.apply(this,arguments);var e;if(m){e=o.getElementInstance();m=U.isEditable(o);if(m){var p=o.getPublicParentAggregationOverlay();if(p){var P=p.getDesignTimeMetadata();var M=P.getMoveAction(e);m=!!(M);}else{m=false;}}}return m&&U.hasParentStableId(o);};R.prototype.checkTargetZone=function(A){var t=E.prototype.checkTargetZone.call(this,A);if(t){var m=this.getMovedOverlay();var o=A.getParent();var M=g(m,false);var T=g(o,true);if(!M||!T){return false;}else{t=(M===T)&&U.isEditable(o,m.getElementInstance());}}return t;};return R;},true);};if(!jQuery.sap.isDeclared('sap.ui.rta.plugin.additionalElements.AddElementsDialog')){
/*
 * ! SAP UI development toolkit for HTML5 (SAPUI5)

(c) Copyright 2009-2016 SAP SE. All rights reserved
 */
jQuery.sap.declare('sap.ui.rta.plugin.additionalElements.AddElementsDialog');jQuery.sap.require('jquery.sap.global');jQuery.sap.require('sap.ui.dt.OverlayRegistry');jQuery.sap.require('sap.ui.core.Control');jQuery.sap.require('sap.ui.commons.Label');jQuery.sap.require('sap.ui.commons.LabelDesign');jQuery.sap.require('sap.m.Dialog');jQuery.sap.require('sap.ui.model.json.JSONModel');jQuery.sap.require('sap.m.SearchField');jQuery.sap.require('sap.m.Button');jQuery.sap.require('sap.m.Toolbar');jQuery.sap.require('sap.m.ToolbarSpacer');jQuery.sap.require('sap.ui.model.Filter');jQuery.sap.require('sap.ui.model.FilterOperator');jQuery.sap.require('sap.m.List');jQuery.sap.require('sap.m.CustomListItem');jQuery.sap.require('sap.m.ListType');jQuery.sap.require('sap.m.ScrollContainer');jQuery.sap.require('sap.ui.model.Sorter');jQuery.sap.require('sap.ui.dt.ElementUtil');jQuery.sap.require('sap.m.VBox');sap.ui.define("sap/ui/rta/plugin/additionalElements/AddElementsDialog",['jquery.sap.global','sap/ui/rta/library','sap/ui/rta/Utils','sap/ui/dt/OverlayRegistry','sap/ui/core/Control','sap/ui/commons/Label','sap/ui/commons/LabelDesign','sap/m/Dialog','sap/ui/model/json/JSONModel','sap/m/SearchField','sap/m/Button','sap/m/Toolbar','sap/m/ToolbarSpacer','sap/ui/model/Filter','sap/ui/model/FilterOperator','sap/ui/rta/controlAnalyzer/ControlAnalyzerFactory','sap/ui/rta/command/CommandFactory','sap/ui/rta/command/CompositeCommand','sap/m/List','sap/m/CustomListItem','sap/m/ListType','sap/m/ScrollContainer','sap/ui/model/Sorter','sap/ui/dt/ElementUtil','sap/m/VBox'],function(q,l,U,O,C,L,a,D,J,S,B,T,b,F,c,d,e,f,g,h,i,j,k,E,V){"use strict";var A=C.extend("sap.ui.rta.plugin.additionalElements.AddElementsDialog",{metadata:{library:"sap.ui.rta",properties:{"customFieldEnabled":{type:"boolean",defaultValue:false},"title":{type:"string"}},aggregations:{"_dialog":{type:"sap.ui.core.Control",visibility:"hidden",multiple:false}},events:{"opened":{},"openCustomField":{}}}});A.prototype.init=function(){var t=this;this._oTextResources=sap.ui.getCore().getLibraryResourceBundle("sap.ui.rta");this._bAscendingSortOrder=false;this._oDialog=new D().addStyleClass("sapUIRtaFieldRepositoryDialog");this.setAggregation("_dialog",this._oDialog);var m=this._createContent();var n=this._createButtons();m.forEach(function(o){t._oDialog.addContent(o);});n.forEach(function(o){t._oDialog.addButton(o);});this._oDialog.setInitialFocus(this._oInput);};A.prototype._createContent=function(){var t=this;this._oInput=new S({width:"100%",liveChange:[this._updateModelFilter,this]}).addStyleClass("resourceListIF");var r=new B({text:"",icon:"sap-icon://sort",press:[this._resortList,this]});this._oCustomFieldButton=new B({text:"",icon:"sap-icon://add",tooltip:this._oTextResources.getText("BTN_FREP_CCF"),enabled:this.getCustomFieldEnabled(),press:[this._redirectToCustomFieldCreation,this]});this._oToolbarSpacer1=new b();this.oInputFields=new T({content:[this._oInput,r,this._oToolbarSpacer1,this._oCustomFieldButton]});var o=new L({design:a.Bold,tooltip:"{tooltip}",text:{parts:[{path:"label"},{path:"referencedComplexPropertyName"},{path:"duplicateComplexName"}],formatter:function(u,R,w){if(w&&R){u+=" ("+R+")";}return u;}}});var m=new L({text:{parts:[{path:"originalLabel"}],formatter:function(u){if(u){return t._oTextResources.getText("LBL_FREP",u);}return"";}},visible:{parts:[{path:"originalLabel"}],formatter:function(u){if(u){return true;}return false;}}});var v=new V();v.addItem(o);v.addItem(m);var s=new k("label",this._bAscendingSortOrder);this._oList=new g({mode:"MultiSelect",includeItemInSelection:true,growing:false,growingScrollToLoad:false}).setNoDataText(this._oTextResources.getText("MSG_NO_FIELDS"));var n=new h({type:i.Active,selected:"{selected}",content:[v]});this._oList.bindItems({path:"/elements",template:n,sorter:s});var p=new j({content:this._oList,vertical:true,horizontal:false}).addStyleClass("sapUIRtaCCDialogScrollContainer");return[this.oInputFields,p];};A.prototype._createButtons=function(){var o=new B({text:this._oTextResources.getText("BTN_FREP_OK"),press:[this._submitDialog,this]});var m=new B({text:this._oTextResources.getText("BTN_FREP_CANCEL"),press:[this._cancelDialog,this]});return[o,m];};A.prototype._submitDialog=function(){this._oDialog.close();this._fnResolve();};A.prototype._cancelDialog=function(){this._oList.removeSelections();this._oDialog.close();this._fnReject();};A.prototype.open=function(o){var t=this;return new Promise(function(r,m){t._fnResolve=r;t._fnReject=m;t._oDialog.oPopup.attachOpened(function(){t.fireOpened();});t._oDialog.open();});};A.prototype._resortList=function(o){this._bAscendingSortOrder=!this._bAscendingSortOrder;var m=this._oList.getBinding("items");var s=[];s.push(new k("label",this._bAscendingSortOrder));m.sort(s);};A.prototype._updateModelFilter=function(o){var v=o.getParameter("newValue");var m=this._oList.getBinding("items");if((typeof v)==="string"){var n=new F("label",c.Contains,v);var p=new F("tooltip",c.Contains,v);var r=new F({filters:[n,p],and:false});m.filter([r]);}else{m.filter([]);}};A.prototype._redirectToCustomFieldCreation=function(o){this.fireOpenCustomField();this._oDialog.close();};A.prototype.setTitle=function(t){C.prototype.setProperty.call(this,"title",t,true);this._oDialog.setTitle(t);};A.prototype.setCustomFieldEnabled=function(m){C.prototype.setProperty.call(this,"customFieldEnabled",m,true);this._oCustomFieldButton.setEnabled(m);};return A;},true);};if(!jQuery.sap.isDeclared('sap.ui.rta.ui.AddElementsDialog')){jQuery.sap.declare('sap.ui.rta.ui.AddElementsDialog');jQuery.sap.require('jquery.sap.global');jQuery.sap.require('sap.ui.dt.OverlayRegistry');jQuery.sap.require('sap.ui.core.Control');jQuery.sap.require('sap.ui.commons.Label');jQuery.sap.require('sap.ui.commons.LabelDesign');jQuery.sap.require('sap.m.Dialog');jQuery.sap.require('sap.ui.model.json.JSONModel');jQuery.sap.require('sap.m.SearchField');jQuery.sap.require('sap.m.Button');jQuery.sap.require('sap.m.Toolbar');jQuery.sap.require('sap.m.ToolbarSpacer');jQuery.sap.require('sap.ui.model.Filter');jQuery.sap.require('sap.ui.model.FilterOperator');jQuery.sap.require('sap.m.List');jQuery.sap.require('sap.m.CustomListItem');jQuery.sap.require('sap.m.ListType');jQuery.sap.require('sap.m.ScrollContainer');jQuery.sap.require('sap.ui.model.Sorter');jQuery.sap.require('sap.ui.dt.ElementUtil');sap.ui.define("sap/ui/rta/ui/AddElementsDialog",['jquery.sap.global','sap/ui/rta/library','sap/ui/rta/Utils','sap/ui/dt/OverlayRegistry','sap/ui/core/Control','sap/ui/commons/Label','sap/ui/commons/LabelDesign','sap/m/Dialog','sap/ui/model/json/JSONModel','sap/m/SearchField','sap/m/Button','sap/m/Toolbar','sap/m/ToolbarSpacer','sap/ui/model/Filter','sap/ui/model/FilterOperator','sap/ui/rta/controlAnalyzer/ControlAnalyzerFactory','sap/ui/rta/command/CommandFactory','sap/ui/rta/command/CompositeCommand','sap/m/List','sap/m/CustomListItem','sap/m/ListType','sap/m/ScrollContainer','sap/ui/model/Sorter','sap/ui/dt/ElementUtil'],function(q,l,U,O,C,L,a,D,J,S,B,T,b,F,c,d,e,f,g,h,i,j,k,E){"use strict";var A=C.extend("sap.ui.rta.ui.AddElementsDialog",{metadata:{library:"sap.ui.rta",properties:{"commandStack":{type:"sap.ui.core.Control"}},associations:{"rootControl":{type:"sap.ui.core.Control"}},events:{"opened":{},"closed":{},"openCustomField":{}}}});A.prototype.init=function(){this._aData=[];var t=this;this._oModel=new J();this._oTextResources=sap.ui.getCore().getLibraryResourceBundle("sap.ui.rta");this._bAscendingSortOrder=false;this._oDialog=this._createDialog();var m=this._createContent();var n=this._createButtons();m.forEach(function(o){t._oDialog.addContent(o);});n.forEach(function(o){t._oDialog.addButton(o);});this._oDialog.setInitialFocus(this._oInput);};A.prototype._createDialog=function(){var o;o=new D({title:this._oTextResources.getText("HEADER_FREP")}).addStyleClass("sapUIRtaFieldRepositoryDialog");return o;};A.prototype._createContent=function(){this._oInput=new S({width:"100%",liveChange:[this._updateModelFilter,this]}).addStyleClass("resourceListIF");var r=new B({text:"",icon:"sap-icon://sort",press:[this._resortList,this]});this._oCustomFieldButton=new B({text:"",icon:"sap-icon://add",tooltip:this._oTextResources.getText("BTN_FREP_CCF"),enabled:false,press:[this._redirectToCustomFieldCreation,this]});this._oToolbarSpacer1=new b();this.oInputFields=new T({content:[this._oInput,r,this._oToolbarSpacer1,this._oCustomFieldButton]});var o=new L({design:a.Bold,tooltip:{parts:[{path:"quickInfo"},{path:"fieldLabel"}],formatter:function(p,t){if(!p){return t;}return p;}},text:"{fieldLabel}"});var s=new k("fieldLabel",this._bAscendingSortOrder);this._oList=new g({mode:"MultiSelect",includeItemInSelection:true,growing:false,growingScrollToLoad:false,select:[this._fnSelected,this]}).setNoDataText(this._oTextResources.getText("MSG_NO_FIELDS"));var m=new h({type:i.Active,selected:"{checked}",content:[o]});this._oModel.setData({modelData:this._aData});this._oList.setModel(this._oModel);this._oList.bindItems({path:"/modelData",template:m,sorter:s});var n=new j({content:this._oList,vertical:true,horizontal:false}).addStyleClass("sapUIRtaCCDialogScrollContainer");return[this.oInputFields,n];};A.prototype._createButtons=function(){var o=new B({text:this._oTextResources.getText("BTN_FREP_OK"),press:[this.applyChanges,this]});var m=new B({text:this._oTextResources.getText("BTN_FREP_CANCEL"),press:[this.cancelDialog,this]});return[o,m];};A.prototype.applyChanges=function(){if(this._oCompositeCommand.getCommands().length>0){this.getCommandStack().pushAndExecute(this._oCompositeCommand);}this._oList.removeSelections();this._oCompositeCommand=null;this._mCommands=[];this._oCurrentAnalyzer=null;this._oCurrentSelectedBlock=null;this._oDialog.close();};A.prototype.cancelDialog=function(){this._oList.removeSelections();this._oCompositeCommand=null;this._mCommands=[];this._oCurrentAnalyzer=null;this._oCurrentSelectedBlock=null;this._oDialog.close();};A.prototype._fnSelected=function(o){var I=o.getParameter("listItem");var m=I.getBindingContext().getObject();var s=m.name?m.name:null;if(!s){s=m.controlId?m.controlId:null;}if(s){var n=this._mCommands[s];this._executeCommandForSelectedElement(I,n,s);}else{q.sap.log.error("Change could not be applied because of missing id of listItem\n");}};A.prototype._evaluateTargetIndex=function(s,t,m,n){var I=(s===t&&m<n)?n-1:n;return I;};A.prototype._getMoveCommand=function(o,m,s){var r;var n=sap.ui.getCore().byId(m.controlId);var p=n?n.getParent():null;var t=O.getOverlay(o).getDesignTimeMetadata();var u;var v;if(o&&p&&(o.getId()!==n.getId())){if(E.isInstanceOf(o,"sap.ui.layout.form.SimpleForm")){var w;if(E.isInstanceOf(s,"sap.ui.layout.form.FormContainer")){v=s.getAggregation("formElements").length;w=s;}else if(E.isInstanceOf(s,"sap.ui.layout.form.FormElement")){v=this._oCurrentAnalyzer._determineIndexOfFormElement(s,true);w=s.getParent();}u=this._oCurrentAnalyzer._determineIndexOfFormElement(n.getParent(),false);var x=n.getParent().getParent();v=this._evaluateTargetIndex(x,w,u,v);r=e.getCommandFor(o,"Move",{movedElements:[{element:n.getParent(),sourceIndex:u,targetIndex:v}],source:{publicParent:o,publicAggregation:"form",parent:x,aggregation:"formElements"},target:{publicParent:o,publicAggregation:"form",parent:w,aggregation:"formElements"}},t);}else{var y=E.getAggregation(p,"formElements");if(y.length>0){u=y.indexOf(n);var z=E.getAggregation(o,"formElements");var G=o.getMetadata().getClass();var v=(s instanceof G)?z.length:z.indexOf(s)+1;v=this._evaluateTargetIndex(p,o,u,v);r=e.getCommandFor(p,"Move",{movedElements:[{element:n,sourceIndex:u,targetIndex:v}],source:{parent:p,publicAggregation:n.sParentAggregationName,aggregation:n.sParentAggregationName},target:{parent:o,publicAggregation:"formElements",aggregation:"formElements"}},t);}}}return r;};A.prototype._executeCommandForSelectedElement=function(I,o,s){var m=I.getSelected();var t=this;if(o){delete t._mCommands[s];t._oCompositeCommand.removeCommand(o);return;}return this._oCurrentAnalyzer.createChangeData(I,this._oCurrentSelectedBlock,!m,this._oSelectedControl).then(function(n){if(n){if(n.changeType==="addField"){o=e.getCommandFor(t._oCurrentSelectedBlock,"Add",{index:n.index,newControlId:n.newControlId,labels:[n.fieldLabel],jsTypes:[n.jsType],fieldValues:[n.fieldValue],valuePropertys:[n.valueProperty]});t._mCommands[s]=o;t._oCompositeCommand.insertCommand(o);}else if(n.changeType==="unhideControl"){if(n.controlType&&n.controlType==="SimpleForm"){var p=sap.ui.getCore().byId(n.controlId).getParent();o=e.getCommandFor(p,"Unhide");}else{o=e.getCommandFor(sap.ui.getCore().byId(n.controlId),"Unhide");}var M=t._getMoveCommand(t._oCurrentSelectedBlock,n,t._oSelectedControl);if(M){var r=new f();r.addCommand(M);r.addCommand(o);o=r;}t._mCommands[s]=o;t._oCompositeCommand.insertCommand(o);}else if(n.changeType==="unstashControl"){o=e.getCommandFor(sap.ui.getCore().byId(n.controlId),"Unstash");o.setParentAggregationName(n.parentAggregationName);o.setIndex(n.iTargetIndex);t._mCommands[s]=o;t._oCompositeCommand.insertCommand(o);}}else{I.setSelected(!m);}}).catch(function(n){q.sap.log.error("Change could not be applied \n"+n);});};A.prototype.open=function(o){var t=this;this._oSelectedControl=o;this._mCommands=[];this._oCompositeCommand=new f();if(o.getMetadata().getName().indexOf("ObjectPage")!==-1){this._oDialog.setTitle(this._oTextResources.getText("HEADER_SREP"));}else{this._oDialog.setTitle(this._oTextResources.getText("HEADER_FREP"));}U.isServiceUpToDate(o).then(function(){t._oCurrentAnalyzer=d.getControlAnalyzerFor(o);return t._oCurrentAnalyzer.prepare();}).then(function(){var m=t._oCurrentAnalyzer.getCustomFieldAvailable?t._oCurrentAnalyzer.getCustomFieldAvailable():false;if(m){t.setShowCreateCustomField(true);t._oCurrentFieldExtInfo=m;t.attachEventOnce('openCustomField',null,t._onOpenCustomField,t);}else{t.setShowCreateCustomField(false);}}).then(function(){if(t._oCurrentAnalyzer){t._oCurrentSelectedBlock=t._oCurrentAnalyzer.getSelectedBlock(o);if(/[&?](sap-rta-oldmodel=(true|x)[&#]?)+/i.test(window.location.search)){t._oCurrentAnalyzer.getCustomizeControlModel(o,true).then(function(n){t._oModel.setData({modelData:n});t._oDialog.oPopup.attachOpened(function(){t.fireOpened();});t._oDialog.open();});}else{var m=t._oCurrentAnalyzer.getAvailableElements();t._oModel.setData({modelData:m});t._oDialog.oPopup.attachOpened(function(){t.fireOpened();});t._oDialog.open();}}})["catch"](function(){t.fireOpened();});};A.prototype._resortList=function(o){this._bAscendingSortOrder=!this._bAscendingSortOrder;var m=this._oList.getBinding("items");var s=[];s.push(new k("fieldLabel",this._bAscendingSortOrder));m.sort(s);};A.prototype._redirectToCustomFieldCreation=function(o){this.fireOpenCustomField();this._oDialog.close();};A.prototype.setShowCreateCustomField=function(s){this._oCustomFieldButton.setEnabled(s);};A.prototype._onOpenCustomField=function(o){var m=sap.ushell&&sap.ushell.Container&&sap.ushell.Container.getService("CrossApplicationNavigation");var H=(m&&m.hrefForExternal({target:{semanticObject:"CustomField",action:"develop"},params:{businessContexts:this._oCurrentFieldExtInfo.BusinessContexts,serviceName:this._oCurrentFieldExtInfo.ServiceName,serviceVersion:this._oCurrentFieldExtInfo.ServiceVersion,entityType:this._oCurrentFieldExtInfo.EntityType}}));U.openNewWindow(H);};A.prototype._updateModelFilter=function(o){var v=o.getParameter("newValue");var m=this._oList.getBinding("items");if((typeof v)==="string"){var n=new F("fieldLabel",c.Contains,v);var p=new F("quickInfo",c.Contains,v);var r=new F({filters:[n,p],and:false});m.filter([r]);}else{m.filter([]);}};return A;},true);};if(!jQuery.sap.isDeclared('sap.ui.rta.ui.SettingsDialog')){jQuery.sap.declare('sap.ui.rta.ui.SettingsDialog');jQuery.sap.require('jquery.sap.global');jQuery.sap.require('sap.ui.core.Control');jQuery.sap.require('sap.m.Dialog');jQuery.sap.require('sap.ui.layout.VerticalLayout');jQuery.sap.require('sap.m.Label');jQuery.sap.require('sap.m.Input');jQuery.sap.require('sap.m.Select');jQuery.sap.require('sap.ui.core.Item');jQuery.sap.require('sap.m.Button');jQuery.sap.require('sap.m.CheckBox');jQuery.sap.require('sap.ui.dt.ElementUtil');sap.ui.define("sap/ui/rta/ui/SettingsDialog",['jquery.sap.global','sap/ui/rta/library','sap/ui/core/Control','sap/m/Dialog','sap/ui/layout/VerticalLayout','sap/m/Label','sap/m/Input','sap/m/Select','sap/ui/core/Item','sap/m/Button','sap/m/CheckBox','sap/ui/rta/command/CommandFactory','sap/ui/rta/command/CompositeCommand','sap/ui/dt/ElementUtil'],function(q,l,C,D,V,L,I,S,a,B,b,c,d,E){"use strict";var e=C.extend("sap.ui.rta.ui.SettingsDialog",{metadata:{library:"sap.ui.rta",properties:{"commandStack":{type:"sap.ui.core.Control"}},associations:{"element":{type:"sap.ui.core.Element"}}}});e.prototype.init=function(){this._oTextResources=sap.ui.getCore().getLibraryResourceBundle("sap.ui.rta");this._oDialog=this._createDialog();};e.prototype._createDialog=function(){return new D({title:this._oTextResources.getText("HEADER_SETTINGS"),contentHeight:"500px",draggable:true,buttons:[new B({text:this._oTextResources.getText("BTN_FREP_OK"),press:[this._applyChangesAndClose,this]}),new B({text:this._oTextResources.getText("BTN_FREP_CANCEL"),press:[this._cancelDialog,this]})]}).addStyleClass("sapUiPopupWithPadding").addStyleClass("sapUiSizeCompact");};e.prototype._applyChangesAndClose=function(){this._applyChanges();this._oDialog.close();};e.prototype._iterateExecutedCommands=function(f){var t=this;Object.keys(this._mCommands).forEach(function(p){f(t._mCommands[p]);});};e.prototype._applyChanges=function(){var o=new d();this._iterateExecutedCommands(function(f){o.addCommand(f);});if(o.getCommands().length){this.getCommandStack().pushExecutedCommand(o);}};e.prototype._cancelDialog=function(){this._iterateExecutedCommands(function(o){o.undo();});this._oDialog.close();};e.prototype._executePropertyChangeCommand=function(o,p,n,O){if(!this._mCommands[p]){var P=c.getCommandFor(o,"property",{propertyName:p,newValue:n,oldValue:O});this._mCommands[p]=P;P.execute();}else{this._mCommands[p].undo();delete this._mCommands[p];}};e.prototype._createBooleanEditor=function(o,p,P){var t=this;var f=new b({text:p,selected:P});f.attachSelect(function(g){var n=g.getParameter("selected");var O=!n;t._executePropertyChangeCommand(o,p,n,O);});return f;};e.prototype._createStringEditor=function(o,p,P){var t=this;var i=new I({value:P});i.attachChange(function(f){var n=f.getParameter("value");var O=P;t._executePropertyChangeCommand(o,p,n,O);});return i;};e.prototype._createEnumEditor=function(o,p,P,v){var t=this;var s=new S();Object.keys(p).forEach(function(k){s.addItem(new a({text:k,key:p[k]}));});s.setSelectedKey(v);s.attachChange(function(f){var i=f.getParameter("selectedItem");if(i){var n=i.getKey();var O=v;t._executePropertyChangeCommand(o,P,n,O);}});return s;};e.prototype._updateDialogContent=function(o){var t=this;this._oDialog.removeAllContent();var v=new V();var p=o.getMetadata().getAllProperties();Object.keys(p).forEach(function(P){var f;var g=p[P];var h=o[g._sGetter]();if(g.type==="boolean"){f=t._createBooleanEditor(o,P,h);v.addContent(f);}else if(g.type==="string"||g.type==="sap.ui.core.CSSSize"){f=new V();var i=t._createStringEditor(o,P,h);f.addContent(new L({text:P,labelFor:i.getId()}));f.addContent(i);f.addStyleClass("sapUiRtaDialogEntryWithMargin");}else{var j=q.sap.getObject(g.type);if(j){f=new V();var k=t._createEnumEditor(o,j,P,h);f.addContent(new L({text:P,labelFor:k.getId()}));f.addContent(k);f.addStyleClass("sapUiRtaDialogEntryWithMargin");}}if(f){v.addContent(f);}});this._oDialog.addContent(v);};e.prototype.open=function(o){this._mCommands={};this._updateDialogContent(o);this._oDialog.open();};return e;},true);};if(!jQuery.sap.isDeclared('sap.ui.rta.plugin.DragDrop')){
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

(c) Copyright 2009-2016 SAP SE. All rights reserved
 */
jQuery.sap.declare('sap.ui.rta.plugin.DragDrop');jQuery.sap.require('jquery.sap.global');jQuery.sap.require('sap.ui.dt.plugin.ControlDragDrop');sap.ui.define("sap/ui/rta/plugin/DragDrop",['jquery.sap.global','sap/ui/dt/plugin/ControlDragDrop','sap/ui/rta/plugin/RTAElementMover'],function(q,C,R){"use strict";var D=C.extend("sap.ui.rta.plugin.DragDrop",{metadata:{library:"sap.ui.rta",properties:{elementMover:{type:"sap.ui.dt.plugin.ElementMover"}},associations:{},events:{dragStarted:{}}}});D.prototype.init=function(){C.prototype.init.apply(this,arguments);this.setElementMover(new R());};D.prototype.registerElementOverlay=function(o){if(o.isMovable()){this._attachMovableBrowserEvents(o);}C.prototype.registerElementOverlay.apply(this,arguments);};D.prototype.deregisterElementOverlay=function(o){C.prototype.deregisterElementOverlay.apply(this,arguments);this._detachMovableBrowserEvents(o);};D.prototype._attachMovableBrowserEvents=function(o){o.attachBrowserEvent("mouseover",this._onMouseOver,this);o.attachBrowserEvent("mouseleave",this._onMouseLeave,this);};D.prototype._detachMovableBrowserEvents=function(o){o.detachBrowserEvent("mouseover",this._onMouseOver,this);o.detachBrowserEvent("mouseleave",this._onMouseLeave,this);};D.prototype.onDragStart=function(o){this.fireDragStarted();C.prototype.onDragStart.apply(this,arguments);this.getDesignTime().getSelection().forEach(function(o){o.setSelected(false);});o.$().addClass("sapUiRtaOverlayPlaceholder");};D.prototype.onDragEnd=function(o){C.prototype.onDragEnd.apply(this,arguments);o.$().removeClass("sapUiRtaOverlayPlaceholder");o.setSelected(true);o.focus();};D.prototype.onMovableChange=function(o){C.prototype.onMovableChange.apply(this,arguments);if(o.isMovable()){this._attachMovableBrowserEvents(o);}else{this._detachMovableBrowserEvents(o);}};D.prototype._onMouseOver=function(e){var o=sap.ui.getCore().byId(e.currentTarget.id);if(o!==this._oPreviousHoverTarget){if(this._oPreviousHoverTarget){this._oPreviousHoverTarget.$().removeClass("sapUiRtaOverlayHover");}this._oPreviousHoverTarget=o;o.$().addClass("sapUiRtaOverlayHover");}e.preventDefault();e.stopPropagation();};D.prototype._onMouseLeave=function(e){if(this._oPreviousHoverTarget){this._oPreviousHoverTarget.$().removeClass("sapUiRtaOverlayHover");}delete this._oPreviousHoverTarget;e.preventDefault();e.stopPropagation();};return D;},true);};if(!jQuery.sap.isDeclared('sap.ui.rta.RuntimeAuthoring')){
/*
 * ! SAP UI development toolkit for HTML5 (SAPUI5)

(c) Copyright 2009-2016 SAP SE. All rights reserved
 */
jQuery.sap.declare('sap.ui.rta.RuntimeAuthoring');jQuery.sap.require('jquery.sap.global');jQuery.sap.require('sap.ui.base.ManagedObject');jQuery.sap.require('sap.ui.dt.ElementUtil');jQuery.sap.require('sap.ui.dt.DesignTime');jQuery.sap.require('sap.ui.dt.OverlayRegistry');jQuery.sap.require('sap.ui.dt.Overlay');jQuery.sap.require('sap.ui.dt.plugin.CutPaste');jQuery.sap.require('sap.ui.dt.plugin.ContextMenu');jQuery.sap.require('sap.ui.dt.plugin.TabHandling');jQuery.sap.require('sap.ui.fl.FlexControllerFactory');jQuery.sap.require('sap.ui.fl.transport.Transports');jQuery.sap.require('sap.ui.fl.transport.TransportSelection');jQuery.sap.require('sap.ui.fl.Utils');jQuery.sap.require('sap.ui.fl.registry.Settings');jQuery.sap.require('sap.m.MessageBox');jQuery.sap.require('sap.m.MessageToast');sap.ui.define("sap/ui/rta/RuntimeAuthoring",['jquery.sap.global','sap/ui/base/ManagedObject','sap/ui/rta/ui/ToolsMenu','sap/ui/dt/ElementUtil','sap/ui/dt/DesignTime','sap/ui/dt/OverlayRegistry','sap/ui/dt/Overlay','sap/ui/rta/command/Stack','sap/ui/rta/command/CommandFactory','sap/ui/rta/command/LREPSerializer','sap/ui/rta/plugin/Rename','sap/ui/rta/plugin/DragDrop','sap/ui/rta/plugin/RTAElementMover','sap/ui/dt/plugin/CutPaste','sap/ui/rta/plugin/Remove','sap/ui/rta/plugin/CreateContainer','sap/ui/rta/plugin/additionalElements/AdditionalElementsPlugin','sap/ui/rta/plugin/additionalElements/AddElementsDialog','sap/ui/rta/plugin/additionalElements/AdditionalElementsAnalyzer','sap/ui/rta/plugin/Selection','sap/ui/rta/plugin/MultiSelection','sap/ui/rta/plugin/Settings','sap/ui/dt/plugin/ContextMenu','sap/ui/dt/plugin/TabHandling','sap/ui/fl/FlexControllerFactory','sap/ui/rta/ui/SettingsDialog','sap/ui/rta/ui/AddElementsDialog','./Utils','sap/ui/fl/transport/Transports','sap/ui/fl/transport/TransportSelection','sap/ui/fl/Utils','sap/ui/fl/registry/Settings','sap/m/MessageBox','sap/m/MessageToast','sap/ui/rta/controlAnalyzer/ControlAnalyzerFactory'],function(q,M,T,E,D,O,a,C,b,L,R,c,d,e,f,g,A,h,j,S,k,l,m,n,F,o,p,U,r,s,t,u,v,w,x){"use strict";var y=M.extend("sap.ui.rta.RuntimeAuthoring",{metadata:{library:"sap.ui.rta",associations:{"rootControl":{type:"sap.ui.core.Control"}},properties:{"customFieldUrl":"string","showCreateCustomField":"boolean","showToolbars":{type:"boolean",defaultValue:true},"showSettingsDialog":{type:"boolean",defaultValue:true},"showWindowUnloadDialog":{type:"boolean",defaultValue:true},"commandStack":{type:"sap.ui.rta.command.Stack"}},events:{"start":{},"stop":{},"failed":{},"selectionChange":{parameters:{selection:{type:"sap.ui.dt.Overlay[]"}}},"undoRedoStackModified":{}}},_sAppTitle:null});y.prototype.init=function(){this._onCommandStackModified=this._adaptUndoRedoButtons.bind(this);};y.prototype.start=function(){var i=this;this._aPopups=[];this._oTextResources=sap.ui.getCore().getLibraryResourceBundle("sap.ui.rta");this._aSupportedControls=["sap.ui.comp.smartform.Group","sap.uxap.ObjectPageSection","sap.uxap.ObjectPageLayout"];if(!this._oDesignTime){this._oRootControl=sap.ui.getCore().byId(this.getRootControl());this._oRTAElementMover=new d();this._oRTAElementMover.setCommandFactory(b);this._oRTADragDropPlugin=new c({elementMover:this._oRTAElementMover,commandFactory:b}).attachElementModified(this._handleElementModified,this);this._oRTADragDropPlugin.attachDragStarted(this._handleStopCutPaste,this);this._oCutPastePlugin=new e({elementMover:this._oRTAElementMover,commandFactory:b}).attachElementModified(this._handleElementModified,this);this._oRemovePlugin=new f({commandFactory:b}).attachElementModified(this._handleElementModified,this);this._oAdditionalElementsPlugin=new A({commandFactory:b,analyzer:j,dialog:new h()}).attachElementModified(this._handleElementModified,this);this._oRenamePlugin=new R({commandFactory:b}).attachElementModified(this._handleElementModified,this);this._oRenamePlugin.attachEditable(this._handleStopCutPaste,this);this._oSelectionPlugin=new S();this._oMultiSelectionPlugin=new k({multiSelectionTypes:["sap.ui.comp.smartform.GroupElement"]});this._oSettingsPlugin=new l({commandFactory:b,commandStack:this.getCommandStack()}).attachElementModified(this._handleElementModified,this);this._oCreateContainerPlugin=new g({commandFactory:b}).attachElementModified(this._handleElementModified,this);this._oContextMenuPlugin=new m();this._oTabHandlingPlugin=new n();this._buildContextMenu();q.sap.measure.start("rta.dt.startup","Measurement of RTA: DesignTime start up");this._oDesignTime=new D({rootElements:[this._oRootControl],plugins:[this._oRTADragDropPlugin,this._oCutPastePlugin,this._oRemovePlugin,this._oRenamePlugin,this._oSelectionPlugin,this._oMultiSelectionPlugin,this._oSettingsPlugin,this._oCreateContainerPlugin,this._oContextMenuPlugin,this._oTabHandlingPlugin,this._oAdditionalElementsPlugin]});q(a.getOverlayContainer()).addClass("sapUiRta");this._oDesignTime.attachSelectionChange(function(_){i.fireSelectionChange({selection:_.getParameter("selection")});},this);this._oDesignTime.attachEventOnce("synced",function(){i.fireStart();q.sap.measure.end("rta.dt.startup","Measurement of RTA: DesignTime start up");});this._oDesignTime.attachEventOnce("syncFailed",function(){i.fireFailed();});}if(this.getShowToolbars()){this._createToolsMenu();var $={"onAfterRendering":function(){this._oToolsMenu._oToolBar.focus();this._oToolsMenu._oToolBar.removeEventDelegate($,this);}};this._oToolsMenu._oToolBar.addEventDelegate($,this);this._oToolsMenu.show();}this._oldUnloadHandler=window.onbeforeunload;window.onbeforeunload=this._onUnload.bind(this);};var z=function(i){var $=i.message||i.status||i;var _=sap.ui.getCore().getLibraryResourceBundle("sap.ui.rta");q.sap.log.error("Failed to transfer runtime adaptation changes to layered repository",$);q.sap.require("sap.m.MessageBox");var a1=_.getText("MSG_LREP_TRANSFER_ERROR")+"\n"+_.getText("MSG_ERROR_REASON",$);sap.m.MessageBox.error(a1);};y.prototype.setCommandStack=function(i){var $=this.getProperty("commandStack");if($){$.detachModified(this._onCommandStackModified);}if(this._oInternalCommandStack){this._oInternalCommandStack.destroy();delete this._oInternalCommandStack;}var _=this.setProperty("commandStack",i);if(i){i.attachModified(this._onCommandStackModified);}if(this._oSettingsPlugin){this._oSettingsPlugin.setCommandStack(i);}return _;};y.prototype.getCommandStack=function(){var i=this.getProperty("commandStack");if(!i){i=new C();this._oInternalCommandStack=i;}this.setCommandStack(i);return i;};y.prototype._adaptUndoRedoButtons=function(){if(this.getShowToolbars()){var i=this.getCommandStack();var $=i.canUndo();var _=i.canRedo();this._oToolsMenu.adaptUndoRedoEnablement($,_);this._oToolsMenu.adaptTransportEnablement(this._bChangesExist||$);this._oToolsMenu.adaptRestoreEnablement(this._bChangesExist||$);}this.fireUndoRedoStackModified();};y.prototype._closeToolBars=function(){if(this.getShowToolbars()){return this._oToolsMenu.hide();}else{return Promise.resolve();}};y.prototype.getSelection=function(){if(this._oDesignTime){return this._oDesignTime.getSelection();}else{return[];}};y.prototype.stop=function(i){var $=this;return((i)?Promise.resolve():this._serializeToLrep()).then(this._closeToolBars.bind(this)).then(function(){$.exit();$.fireStop();})['catch'](z);};y.prototype.restore=function(){this._onRestore();};y.prototype.transport=function(){this._onTransport();};y.prototype.undo=function(){this._onUndo();};y.prototype.redo=function(){this._onRedo();};y.prototype.canUndo=function(){return this.getCommandStack().canUndo();};y.prototype.canRedo=function(){return this.getCommandStack().canRedo();};y.prototype._onUnload=function(){var i=this.getCommandStack();var $=i.canUndo()||i.canRedo();if($&&this.getShowWindowUnloadDialog()){var _=this._oTextResources.getText("MSG_UNSAVED_CHANGES");return _;}else{window.onbeforeunload=this._oldUnloadHandler;}};y.prototype._serializeToLrep=function(){var i=new L({commandStack:this.getCommandStack(),rootControl:this.getRootControl()});return i.saveCommands();};y.prototype._onUndo=function(){this._handleStopCutPaste();this.getCommandStack().undo();};y.prototype._onRedo=function(){this._handleStopCutPaste();this.getCommandStack().redo();};y.prototype._createToolsMenu=function(){var i=this;if(!this._oToolsMenu){this._sAppTitle=this._getApplicationTitle();this._oToolsMenu=new T();this._oToolsMenu.createToolbar();this._oToolsMenu.setTitle(this._sAppTitle);this._oToolsMenu.setRootControl(this._oRootControl);this._oToolsMenu.checkTransportAvailable().then(function($){i._bATOTransportEnabled=$;});this._checkChangesExist().then(function($){i._bChangesExist=$;i._oToolsMenu.adaptTransportEnablement($);i._oToolsMenu.adaptRestoreEnablement($);});this._oToolsMenu.attachToolbarClose(this.stop.bind(this,false),this);this._oToolsMenu.attachTransport(this._onTransport,this);this._oToolsMenu.attachRestore(this._onRestore,this);this._oToolsMenu.attachUndo(this._onUndo,this);this._oToolsMenu.attachRedo(this._onRedo,this);}};y.prototype.exit=function(){if(this._oDesignTime){q(a.getOverlayContainer()).removeClass("sapUiRta");this._oDesignTime.destroy();this._oDesignTime=null;}if(this._oToolsMenu){this._oToolsMenu.destroy();this._oToolsMenu=null;}this.setCommandStack(null);window.onbeforeunload=this._oldUnloadHandler;};y.prototype._onTransport=function(){var i=this;function $(_){if(_.message==='createAndApply failed'){return;}t.log.error("transport error"+_);return i._showMessage(v.Icon.ERROR,"HEADER_TRANSPORT_ERROR","MSG_TRANSPORT_ERROR",_);}this._handleStopCutPaste();return this._openSelection().then(this._checkTransportInfo).then(function(_){if(_){var a1=F.createForControl(i._oRootControl);return i._serializeToLrep().then(function(){return a1.getComponentChanges().then(function(b1){if(b1.length>0){return i._createAndApplyChanges(b1,a1).then(i._transportAllLocalChanges.bind(i,_,a1))['catch']($);}});})['catch'](z);}});};y.prototype._checkTransportInfo=function(i){if(i&&i.transport&&i.packageName!=="$TMP"){return i;}else{return false;}};y.prototype._openSelection=function(){return new s().openTransportSelection(null,this._oRootControl);};y.prototype._createAndApplyChanges=function(i,$){var _=this;return Promise.resolve().then(function(){function a1(b1){return b1&&b1.selector&&b1.selector.id;}i.filter(a1).forEach(function(b1){var c1=sap.ui.getCore().byId(b1.selector.id);$.createAndApplyChange(b1,c1);});})['catch'](function(a1){t.log.error("Create and apply error: "+a1);return a1;}).then(function(a1){return $.saveAll().then(function(){if(a1){throw a1;}});})['catch'](function(a1){t.log.error("Create and apply and/or save error: "+a1);return _._showMessage(v.Icon.ERROR,"HEADER_TRANSPORT_APPLYSAVE_ERROR","MSG_TRANSPORT_APPLYSAVE_ERROR",a1);});};y.prototype._deleteChanges=function(){var i=this;var $=new s();var _=F.createForControl(this._oRootControl);_.getComponentChanges().then(function(a1){return u.getInstance(t.getComponentClassName(i._oRootControl)).then(function(b1){if(!b1.isProductiveSystem()&&!b1.hasMergeErrorOccured()){return $.setTransports(a1,i._oRootControl);}}).then(function(){return _.discardChanges(a1);}).then(function(){return window.location.reload();});})["catch"](function(a1){return i._showMessage(v.Icon.ERROR,"HEADER_RESTORE_FAILED","MSG_RESTORE_FAILED",a1);});};y.prototype._showMessage=function(i,$,_,a1){if(a1){var b1=this._oTextResources.getText(_,[a1.message||a1]);}else{var b1=this._oTextResources.getText(_);}var c1=this._oTextResources.getText($);return new Promise(function(d1){v.show(b1,{icon:i,title:c1,onClose:d1});});};y.prototype._showMessageToast=function(i){var $=this._oTextResources.getText(i);w.show($);};y.needsRestart=function(){var i=!!window.localStorage.getItem("sap.ui.rta.restart");return i;};y.enableRestart=function(){window.localStorage.setItem("sap.ui.rta.restart",true);};y.disableRestart=function(){window.localStorage.removeItem("sap.ui.rta.restart");};y.prototype._onRestore=function(){var i=this;var $=this._oTextResources.getText("FORM_PERS_RESET_MESSAGE");var _=this._oTextResources.getText("FORM_PERS_RESET_TITLE");this._handleStopCutPaste();function a1(b1){if(b1==="OK"){i.getCommandStack().removeAllCommands();y.enableRestart();i._deleteChanges();}}v.confirm($,{icon:v.Icon.WARNING,title:_,onClose:a1});};y.prototype._transportAllLocalChanges=function(i,$){var _=this;return $.getComponentChanges().then(function(a1){var b1=new r();var c1=b1._convertToChangeTransportData(a1);var d1={};d1.package=i.packageName;d1.transportId=i.transport;d1.changeIds=c1;return b1.makeChangesTransportable(d1).then(function(){a1.forEach(function(e1){if(e1.getPackage()==='$TMP'){var f1=e1.getDefinition();f1.packageName=i.packageName;e1.setResponse(f1);}});}).then(function(){_._showMessageToast("MSG_TRANSPORT_SUCCESS");});});};y.prototype._isEqualParentInfo=function(i,$){var _=!!i&&!!$;if(_&&(i.parent&&$.parent)){_=i.parent.getId()===$.parent.getId();}if(_&&(i.index||$.index)){_=i.index===$.index;}if(_&&(i.aggregation||$.aggregation)){_=i.aggregation===$.aggregation;}return _;};y.prototype._handleElementModified=function(i){this._handleStopCutPaste();var $=i.getParameter("command");if($ instanceof sap.ui.rta.command.BaseCommand){this.getCommandStack().pushAndExecute($);}};y.prototype._handleRemoveElement=function(i){this._oRemovePlugin.removeElement(i);};y.prototype._openSettingsDialog=function(i){var $=(i.mParameters)?i.getParameter("selectedOverlays"):i;var _=$[0].getElementInstance();this._handleStopCutPaste();if(!this._oSettingsDialog){this._oSettingsDialog=new o();}this._oSettingsDialog.setCommandStack(this.getCommandStack());this._oSettingsDialog.open(_);};var B=function(i){return this._oDesignTime.getSelection().length<2;};var H=function(i){return U.hasParentStableId(i);};var I=function(i){return i.getMovable();};var G=function(i){return i.getElementInstance().getMetadata().getName()==="sap.ui.comp.smartform.GroupElement";};var J=function(i){return i.getElementInstance().getMetadata().getName()==="sap.ui.comp.smartform.Group";};var K=function(i){var $=i.getElementInstance();var _=x.getControlAnalyzerFor($);if(_._getSimpleFormContainer){return!!_._getSimpleFormContainer($);}else{return false;}};var N=function(i){var $=i.getElementInstance();return $.getMetadata().getName()==="sap.uxap.ObjectPageSection";};var P=function(i){var $=i.getElementInstance();return $.getMetadata().getName()==="sap.uxap.ObjectPageLayout";};var Q=function(i){return this._oRemovePlugin.isRemoveAvailable(i);};var V=function(i){return this._oRemovePlugin.isRemoveEnabled(i);};var W=function(i){return this._oRenamePlugin.isRenameAvailable(i);};var X=function(i){return this._oRenamePlugin.isRenameEnabled(i);};var Y=function(i){return this._oSettingsPlugin.isSettingsAvailable(i);};var Z=function(i){return this._oSettingsPlugin.isSettingsEnabled(i);};y.prototype._buildContextMenu=function(){var i=this;this._oContextMenuPlugin.addMenuItem({id:"CTX_RENAME_LABEL",text:i._oTextResources.getText("CTX_RENAME"),handler:this._handleRename.bind(this),available:W.bind(this),enabled:function($){return(B.call(i,$)&&X.call(i,$));}});if(/[&?](sap-rta-new-add=(true|x)[&#]?)+/i.test(window.location.search)){this._oContextMenuPlugin.addMenuItem({id:"CTX_ADD_ELEMENTS_AS_SIBLING",text:i._oAdditionalElementsPlugin.getContextMenuTitle.bind(i._oAdditionalElementsPlugin,true),handler:i._oAdditionalElementsPlugin.showAvailableElements.bind(i._oAdditionalElementsPlugin,true),available:i._oAdditionalElementsPlugin.isAvailable.bind(i._oAdditionalElementsPlugin,true),enabled:function($){return B.call(i,$)&&i._oAdditionalElementsPlugin.isEnabled(true,$);}});this._oContextMenuPlugin.addMenuItem({id:"CTX_ADD_ELEMENTS_AS_CHILD",text:i._oAdditionalElementsPlugin.getContextMenuTitle.bind(i._oAdditionalElementsPlugin,false),handler:i._oAdditionalElementsPlugin.showAvailableElements.bind(i._oAdditionalElementsPlugin,false),available:i._oAdditionalElementsPlugin.isAvailable.bind(i._oAdditionalElementsPlugin,false),enabled:function($){return B.call(i,$)&&i._oAdditionalElementsPlugin.isEnabled(false,$);}});}else{this._oContextMenuPlugin.addMenuItem({id:"CTX_ADD_FORM_FIELD",text:i._oTextResources.getText("CTX_ADD_FIELD"),handler:this._handleAddElement.bind(this),available:function($){var _=$.getElementInstance();return K($)&&((E.isInstanceOf(_,"sap.ui.layout.form.FormElement"))||(E.isInstanceOf(_,"sap.ui.layout.form.FormContainer")&&_.getTitle()!==null)||(E.isInstanceOf(_,"sap.ui.layout.form.FormContainer")&&_.getToolbar()!==null));},enabled:H});this._oContextMenuPlugin.addMenuItem({id:"CTX_ADD_FIELD",text:i._oTextResources.getText("CTX_ADD_FIELD"),handler:this._handleAddElement.bind(this),available:function($){return J($)||G($);},enabled:function($){return B.call(i,$)&&(J($)||H($));}});this._oContextMenuPlugin.addMenuItem({id:"CTX_ADD_SECTION",text:i._oTextResources.getText("CTX_ADD_SECTION"),handler:this._handleAddElement.bind(this),available:function($){return N($)||P($);},enabled:function($){return U.hasObjectPageLayoutInvisibleSections.bind(U)&&(P($)||H($));}});}this._oContextMenuPlugin.addMenuItem({id:"CTX_CREATE_CHILD_CONTAINER",text:this._oCreateContainerPlugin.getCreateContainerText.bind(this._oCreateContainerPlugin,false),handler:this._createContainer.bind(this,false),available:this._oCreateContainerPlugin.isCreateAvailable.bind(this._oCreateContainerPlugin,false),enabled:this._oCreateContainerPlugin.isCreateEnabled.bind(this._oCreateContainerPlugin,false)});this._oContextMenuPlugin.addMenuItem({id:"CTX_CREATE_SIBLING_CONTAINER",text:this._oCreateContainerPlugin.getCreateContainerText.bind(this._oCreateContainerPlugin,true),handler:this._createContainer.bind(this,true),available:this._oCreateContainerPlugin.isCreateAvailable.bind(this._oCreateContainerPlugin,true),enabled:this._oCreateContainerPlugin.isCreateEnabled.bind(this._oCreateContainerPlugin,true)});this._oContextMenuPlugin.addMenuItem({id:"CTX_REMOVE",text:i._oTextResources.getText("CTX_REMOVE"),handler:this._handleRemoveElement.bind(this),available:Q.bind(this),enabled:V.bind(this)});this._oContextMenuPlugin.addMenuItem({id:"CTX_CUT",text:i._oTextResources.getText("CTX_CUT"),handler:this._handleCutElement.bind(this),available:I,enabled:function(){return i._oDesignTime.getSelection().length===1;}});this._oContextMenuPlugin.addMenuItem({id:"CTX_PASTE",text:i._oTextResources.getText("CTX_PASTE"),handler:this._handlePasteElement.bind(this),available:I,enabled:function($){return i._oCutPastePlugin.isElementPasteable($);}});this._oContextMenuPlugin.addMenuItem({id:"CTX_GROUP_FIELDS",text:i._oTextResources.getText("CTX_GROUP_FIELDS"),handler:this._handleGroupElements.bind(this),available:function(){var $=i._oDesignTime.getSelection();return($.length>1);},enabled:function(){var $=true;var _=[];var a1=i._oDesignTime.getSelection();a1.forEach(function(b1){var c1=b1.getElementInstance();_=_.concat(c1.getFields());});if(a1.length>3||_.length>3){return false;}a1.some(function(b1){var c1=b1.getElementInstance();if(U.hasGroupElementUnBoundFields(c1)){$=false;return true;}});return $;}});this._oContextMenuPlugin.addMenuItem({id:"CTX_UNGROUP_FIELDS",text:i._oTextResources.getText("CTX_UNGROUP_FIELDS"),handler:this._handleUngroupElements.bind(this),available:function($){var _=$.getElementInstance();var a1=i._oDesignTime.getSelection();return G($)&&_.getFields().length>1&&a1.length<2;},enabled:function($){var _=$.getElementInstance();return!U.hasGroupElementUnBoundFields(_);}});this._oContextMenuPlugin.addMenuItem({id:"CTX_SETTINGS",text:i._oTextResources.getText("CTX_SETTINGS"),handler:this._handleSettings.bind(this),available:Y.bind(this),enabled:Z.bind(this)});};y.prototype._createContainer=function(i,$){this._handleStopCutPaste();var _=this;var a1=$[0];var b1=this._oCreateContainerPlugin.handleCreate(i,a1);var c1={"onAfterRendering":function(){setTimeout(function(){_._oRenamePlugin.startEdit(b1);},0);b1.removeEventDelegate(c1);}};b1.addEventDelegate(c1);};y.prototype._handleRename=function(i){var $=i[0];this._oRenamePlugin.startEdit($);};y.prototype._handleAddElement=function(i){this._handleStopCutPaste();var $=i[0].getElementInstance();if(!this._oAddElementsDialog){this._oAddElementsDialog=new p({rootControl:this._oRootControl});}this._oAddElementsDialog.setCommandStack(this.getCommandStack());this._oAddElementsDialog.open($);};y.prototype._handleCutElement=function(i){var $=i[0];this._oCutPastePlugin.cut($);};y.prototype._handlePasteElement=function(i){var $=i[0];this._oCutPastePlugin.paste($);};y.prototype._handleStopCutPaste=function(){this._oCutPastePlugin.stopCutAndPaste();};y.prototype._handleGroupElements=function(){this._handleStopCutPaste();var $=this._oDesignTime.getSelection();var _=this._oContextMenuPlugin.getContextElement();var a1=U.getClosestTypeForControl(_,"sap.ui.comp.smartform.Group");var b1=a1.getGroupElements().indexOf(_);var c1=U.findSupportedBlock(_,this._aSupportedControls);var d1=U.getClosestTypeForControl(_,"sap.ui.comp.smartform.SmartForm");var e1=[];for(var i=0;i<$.length;i++){var f1=$[i].getElementInstance();e1.push(f1);}var g1=b.getCommandFor(c1,"group",{source:_,index:b1,groupFields:e1,smartForm:d1});this.getCommandStack().pushAndExecute(g1);};y.prototype._handleUngroupElements=function(){this._handleStopCutPaste();var i=this._oContextMenuPlugin.getContextElement();var $=U.getClosestTypeForControl(i,"sap.ui.comp.smartform.SmartForm");var _=b.getCommandFor(i,"ungroup",{smartForm:$});this.getCommandStack().pushAndExecute(_);};y.prototype._handleSettings=function(i){this._oSettingsPlugin.handleSettings(i);};y.prototype._getSmartFormForElement=function(i){while(i&&!E.isInstanceOf(i,"sap.ui.comp.smartform.SmartForm")){i=i.getParent();}return i;};y.prototype._getApplicationTitle=function(){var i="";var $=sap.ui.core.Component.getOwnerComponentFor(this._oRootControl);if($){i=$.getMetadata().getManifestEntry("sap.app").title;}return i;};y.prototype._checkChangesExist=function(){var i=F.createForControl(this._oRootControl);if(i.getComponentName().length>0){return i.getComponentChanges().then(function($){return $.length>0;});}else{return Promise.resolve(false);}};return y;},true);};
