/*
 * ! SAP UI development toolkit for HTML5 (SAPUI5)

(c) Copyright 2009-2016 SAP SE. All rights reserved
 */
sap.ui.define(['jquery.sap.global','sap/ui/comp/library','./SelectionController','./Util','sap/ui/comp/navpopover/flexibility/changes/AddLink','sap/ui/comp/navpopover/flexibility/changes/RemoveLink','sap/ui/fl/changeHandler/JsControlTreeModifier','./Factory'],function(q,C,S,U,A,R,J,F){"use strict";var a={};a.isSettingsAvailable=function(){return F.getService("CrossApplicationNavigation")&&F.getService("FlexConnector").isVendorLayer();};a.getStableElements=function(n){if(!n||!(n instanceof sap.ui.comp.navpopover.NavigationPopoverHandler)){return null;}var s=n.getNavigationPopoverStableId();if(!s){return null;}var o=n._getAppComponent();if(!o){return null;}return[{id:s,appComponent:o}];};a.execute=function(n,g){return new Promise(function(r,b){if(!n||!(n instanceof sap.ui.comp.navpopover.NavigationPopoverHandler)){return b(new Error("oNavigationPopoverHandler is not of supported type sap.ui.comp.navpopover.NavigationPopoverHandler"));}var s=n.getNavigationPopoverStableId();if(!s){return b(new Error("StableId is not defined. SemanticObject="+n.getSemanticObject()));}var o=n._getAppComponent();if(!o){return b(new Error("AppComponent is not defined. oControl="+n.getControl()));}var c=sap.ui.getCore().byId(n.getControl());n._getPopover().then(function(N){a._applyUnsavedChanges(s,g,N,o);var m=U.availableAction2MItems(N);var M=U.availableAction2MColumnsItems(N);n._destroyPopover();new S().openSelectionDialog(m,M,c).then(function(d){if(!d){r([]);}var e=a._prepareResult(d.addedLinks,sap.ui.comp.navpopover.ChangeHandlerType.addLink,s,o);var f=a._prepareResult(d.removedLinks,sap.ui.comp.navpopover.ChangeHandlerType.removeLink,s,o);r(e.concat(f));})['catch'](function(d){return b(d);});});});};a._prepareResult=function(m,c,s,o){return m.map(function(M){return{selectorControl:{id:s,controlType:"sap.ui.comp.navpopover.NavigationPopover",appComponent:o},changeSpecificData:{changeType:c,content:M}};});};a._applyUnsavedChanges=function(s,g,n,o){var c=g(s,[sap.ui.comp.navpopover.ChangeHandlerType.addLink,sap.ui.comp.navpopover.ChangeHandlerType.removeLink]);c.forEach(function(b){switch(b.getChangeType()){case sap.ui.comp.navpopover.ChangeHandlerType.addLink:A.applyChange(b,n,{modifier:J,appComponent:o});break;case sap.ui.comp.navpopover.ChangeHandlerType.removeLink:R.applyChange(b,n,{modifier:J,appComponent:o});break;}});};return a;},true);
