/*
 * ! SAP UI development toolkit for HTML5 (SAPUI5)

(c) Copyright 2009-2016 SAP SE. All rights reserved
 */
sap.ui.define(['sap/ui/comp/library','sap/ui/comp/navpopover/flexibility/changes/AddLink','sap/ui/comp/navpopover/flexibility/changes/RemoveLink','sap/ui/fl/Utils','sap/ui/fl/FlexControllerFactory','sap/ui/fl/ChangePersistenceFactory'],function(C,A,R,F,a,b){"use strict";var c={getAppComponentForControl:function(o){return F.getAppComponentForControl(o);},isVendorLayer:function(){return F.isVendorLayer();},createAndSaveChangesForControl:function(m,o){var t=this;return new Promise(function(r,d){if(!m){return r();}t.createChangesForControl(m.removedLinks,o,sap.ui.comp.navpopover.ChangeHandlerType.removeLink);t.createChangesForControl(m.addedLinks,o,sap.ui.comp.navpopover.ChangeHandlerType.addLink);t.saveChangesForControl(o).then(function(e){return r();})['catch'](function(e){return d(e);});});},createChangesForControl:function(m,o,s){if(!m.length){return;}if(!s){throw new Error("sChangeType should be filled");}var f=a.createForControl(o);m.forEach(function(M){f.createAndApplyChange({changeType:s,content:M,isUserDependent:true},o);});},saveChangesForControl:function(o){return new Promise(function(r,d){a.createForControl(o).saveAll().then(function(e){return r();})['catch'](function(e){return d(e);});});},readChangesForControl:function(s,o){var d=this.getAppComponentForControl(o);var e=F.getFlexReference(d.getManifestObject());var m=b.getChangePersistenceForComponent(e).getChangesMapForComponent();return m[s]?m[s]:[];},discardChangesForControl:function(d,o){return new Promise(function(r,e){if(!d.length){return r();}a.createForControl(o).discardChanges(d).then(function(){return r();})['catch'](function(E){return e(E);});});},activateApplyChangeStatistics:function(){var t=this;this.aStatistics=[];var w=function(o,n){if(t.aStatistics.findIndex(function(s){return s.stableId===n.getId()&&s.changeId===o.getId();})<0){var g=n.getAvailableActions().find(function(h){return h.getKey()===o.getContent().key;});t.aStatistics.push({stableId:n.getId(),changeId:o.getId(),layer:o.getLayer(),key:o.getContent().key,text:g?g.getText():'',changeType:o.getChangeType()});}};var f=jQuery.proxy(A.applyChange,A);var d=function(o,n,p){w(o,n);f(o,n,p);};A.applyChange=d;var r=jQuery.proxy(R.applyChange,R);var e=function(o,n,p){w(o,n);r(o,n,p);};R.applyChange=e;},_formatStatistic:function(s){var l=s.layer;switch(s.layer){case"VENDOR":l=""+l;break;case"CUSTOMER":l="        "+l;break;case"USER":l="                "+l;break;default:l=""+l;}var v;switch(s.changeType){case sap.ui.comp.navpopover.ChangeHandlerType.addLink:v="On";break;case sap.ui.comp.navpopover.ChangeHandlerType.removeLink:v="Off";break;default:v="";}return{formattedLayer:l,formattedValue:v};},printStatisticOfText:function(l){var t=this;jQuery.sap.log.info("VENDOR ------------ CUSTOMER ----------- USER --------------------------------------");this.aStatistics.filter(function(s){return s.text===l;}).forEach(function(s){var f=t._formatStatistic(s);jQuery.sap.log.info(s.stableId+" "+f.formattedLayer+" '"+s.text+"' "+f.formattedValue);});},printStatisticAll:function(){var t=this;jQuery.sap.log.info("idx - VENDOR ------------ CUSTOMER ----------- USER --------------------------------------");this.aStatistics.forEach(function(s,i){var f=t._formatStatistic(s);jQuery.sap.log.info(i+" "+s.stableId+" "+f.formattedLayer+" '"+s.text+"' "+f.formattedValue);});},getNavigationPopoverStableID:function(s){return s.getNavigationPopoverHandler().getNavigationPopoverStableId();}};return c;},true);
