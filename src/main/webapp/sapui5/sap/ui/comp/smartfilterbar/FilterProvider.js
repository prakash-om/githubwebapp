/*
 * ! SAP UI development toolkit for HTML5 (SAPUI5)

(c) Copyright 2009-2016 SAP SE. All rights reserved
 */
sap.ui.define(['jquery.sap.global','sap/m/ComboBox','sap/m/DatePicker','sap/m/DateRangeSelection','sap/m/TimePicker','sap/m/Input','sap/m/MultiComboBox','sap/m/MultiInput','sap/m/SearchField','sap/m/Token','sap/ui/comp/odata/MetadataAnalyser','sap/ui/comp/providers/ValueHelpProvider','sap/ui/comp/providers/ValueListProvider','sap/ui/model/Filter','sap/ui/model/json/JSONModel','sap/ui/comp/odata/ODataType','sap/ui/comp/util/FormatUtil','sap/ui/base/EventProvider','sap/ui/comp/util/IdentifierUtil'],function(q,C,D,a,T,I,M,b,S,c,d,V,f,F,J,O,g,E,h){"use strict";var l=function(p){this._bInitialized=false;this._bPending=true;this._bConsiderAnalyticalParameters=false;if(p){this._oParentODataModel=p.model;this._sServiceURL=p.serviceUrl;this._sBasicSearchFieldName=p.basicSearchFieldName;this._isBasicSearchEnabled=p.enableBasicSearch;this._bUseContainsAsDefault=p.useContainsAsDefaultFilter==="true";this.sEntityType=p.entityType;this.sEntitySet=p.entitySet;this._isRunningInValueHelpDialog=p.isRunningInValueHelpDialog;this._oAdditionalConfiguration=p.additionalConfiguration;this.sDefaultDropDownDisplayBehaviour=p.defaultDropDownDisplayBehaviour;this.sDefaultTokenDisplayBehaviour=p.defaultTokenDisplayBehaviour;if(typeof p.dateFormatSettings==="string"){try{this._oDateFormatSettings=p.dateFormatSettings?JSON.parse(p.dateFormatSettings):undefined;}catch(e){}}else{this._oDateFormatSettings=p.dateFormatSettings;}this._oSmartFilter=p.smartFilter;this._bConsiderAnalyticalParameters=p.considerAnalyticalParameters;}this.sFilterModelName=l.FILTER_MODEL_NAME;this._sBasicFilterAreaID=l.BASIC_FILTER_AREA_ID;this._aAnalyticalParameters=[];this._aFilterBarViewMetadata=[];this._aFilterBarFieldNames=[];this._aFilterBarMultiValueFieldMetadata=[];this._aFilterBarDateFieldNames=[];this._aFilterBarTimeFieldNames=[];this._aFilterBarTimeIntervalFieldNames=[];this._aFilterBarDateTimeMultiValueFieldNames=[];this._aFilterBarStringFieldNames=[];this._aFieldGroupAnnotation=[];this._oMetadataAnalyser=new d(this._oParentODataModel||this._sServiceURL);this.oModel=new J();this._aValueListProvider=[];this._aValueHelpDialogProvider=[];this._mConditionTypeFields={};this._intialiseMetadata();this._bInitialized=true;};l.FILTER_MODEL_NAME="fi1t3rM0d31";l.BASIC_FILTER_AREA_ID="_BASIC";l.BASIC_SEARCH_FIELD_ID="_BASIC_SEARCH_FIELD";l.CUSTOM_FIELDS_MODEL_PROPERTY="_CUSTOM";l.FIELD_NAME_REGEX=/\./g;l.prototype._intialiseMetadata=function(){var G,e,s,o,k,i,j,m,n,p,r,t;this._aFilterBarViewMetadata.push({groupName:this._sBasicFilterAreaID,index:0,fields:[]});if(!this.sEntitySet&&this.sEntityType){this.sEntitySet=this._oMetadataAnalyser.getEntitySetNameFromEntityTypeName(this.sEntityType);}this.sEntityType=this._oMetadataAnalyser.getEntityTypeNameFromEntitySetName(this.sEntitySet);k=this._oMetadataAnalyser.getAllFilterableFieldsByEntitySetName(this.sEntitySet);if(k){this._updateDisplayBehaviour();this._aFieldGroupAnnotation=this._oMetadataAnalyser.getFieldGroupAnnotation(this.sEntityType);s=this._oMetadataAnalyser.getSelectionFieldsAnnotation(this.sEntityType);if(s&&s.selectionFields){this._aSelectionFields=s.selectionFields;}if(this._aFieldGroupAnnotation){G=this._aFieldGroupAnnotation.length;for(i=0;i<G;i++){o=this._aFieldGroupAnnotation[i];p=this._createGroupMetadata(o);p.index=this._aFilterBarViewMetadata.length;this._aFilterBarViewMetadata.push(p);}}G=k.length;for(i=0;i<G;i++){o=k[i];e=o.fields.length;p=this._createGroupMetadata(o);this._aFilterBarViewMetadata.push(p);for(j=0;j<e;j++){m=o.fields[j];if(m.type.indexOf("Edm.")===0){n=this._createFieldMetadata(m);p.fields.push(n);this._aFilterBarFieldNames.push(n.fieldName);}}}}t=this._getAdditionalConfigurationForCustomGroups(k);G=t.length;for(j=0;j<G;j++){p=this._createGroupMetadataForCustomGroup(t[j]);if(p){this._aFilterBarViewMetadata.push(p);}}r=this._getAdditionalConfigurationForCustomFilterFields();e=r.length;for(j=0;j<e;j++){n=this._createFieldMetadataForCustomFilterFields(r[j]);if(n){this._aFilterBarViewMetadata[0].fields.push(n);}}if(this._hasBasicSearch()){n=this._createBasicSearchFieldMetadata();this._aFilterBarViewMetadata[0].fields.push(n);}if(this._bConsiderAnalyticalParameters){this._createAnalyticalParameters();}this._applyGroupId();this._applyIndexes();this._createInitialModel(true);this._initializeConditionTypeFields();this.setPending(this.isPending());};l.prototype._createAnalyticalParameters=function(){var o;if(this._oMetadataAnalyser.isSemanticAggregation(this.sEntityType)){q.sap.require("sap.ui.model.analytics.odata4analytics");try{o=new sap.ui.model.analytics.odata4analytics.Model(new sap.ui.model.analytics.odata4analytics.Model.ReferenceByModel(this._oParentODataModel));}catch(e){throw"Failed to instantiate analytical extensions for given OData model: "+e.message;}var Q=o&&o.findQueryResultByName(this.sEntitySet);this._oParameterization=Q&&Q.getParameterization();this._createAnalyticParameters(this._oParameterization);}};l.prototype.attachPendingChange=function(e){if(!this._oEventProvider){this._oEventProvider=new E();}this._oEventProvider.attachEvent("PendingChange",e);};l.prototype.detachPendingChange=function(e){if(this._oEventProvider){this._oEventProvider.detachEvent("PendingChange",e);}};l.prototype.setPending=function(v){var e=this._bPending!==v;this._bPending=v;if(e&&this._oEventProvider){var p={};p.pending=v;this._oEventProvider.fireEvent("PendingChange",p);}};l.prototype.isPending=function(){if(!this._bInitialized){return true;}for(var n in this._mConditionTypeFields){if(this._mConditionTypeFields[n].conditionType.isPending()){return true;}}return false;};l.prototype._updateDisplayBehaviour=function(){this._sTextArrangementDisplayBehaviour=this._oMetadataAnalyser.getTextArrangementValue(this.sEntityType);if(!this.sDefaultDropDownDisplayBehaviour){if(this._sTextArrangementDisplayBehaviour){this.sDefaultDropDownDisplayBehaviour=this._sTextArrangementDisplayBehaviour;}else{this.sDefaultDropDownDisplayBehaviour=sap.ui.comp.smartfilterbar.DisplayBehaviour.descriptionOnly;}}if(!this.sDefaultTokenDisplayBehaviour){if(this._sTextArrangementDisplayBehaviour){this.sDefaultTokenDisplayBehaviour=this._sTextArrangementDisplayBehaviour;}else{this.sDefaultTokenDisplayBehaviour=sap.ui.comp.smartfilterbar.DisplayBehaviour.descriptionAndId;}}};l.prototype._hasBasicSearch=function(){return this._isBasicSearchEnabled;};l.prototype._getAdditionalConfigurationForCustomFilterFields=function(){var e,j,i,r;if(!this._oAdditionalConfiguration){return[];}e=this._oAdditionalConfiguration.getControlConfiguration();if(!this._aFilterBarFieldNames||!this._aFilterBarFieldNames.length){return e;}r=[];j=e.length;for(i=0;i<j;i++){if(this._aFilterBarFieldNames.indexOf(e[i].key)<0){r.push(e[i]);}}return r;};l.prototype._getAdditionalConfigurationForCustomGroups=function(o){var G,e,n,i,r,j,k,s;if(!this._oAdditionalConfiguration){return[];}G=this._oAdditionalConfiguration.getGroupConfiguration();if(!o||!o.length){return G;}r=[];n=o.length;e=G.length;for(i=0;i<e;i++){k=false;for(j=0;j<n;j++){s=o[j].groupName||o[j].groupEntityName;if(s===G[i].key){k=true;break;}}if(!k){r.push(G[i]);}}return r;};l.prototype._createInitialModelForField=function(j,o,u){var e,i,H=false,k=false,L=null,s=null,m,n=null,p=[],r=[];if(!o||o.isCustomFilterField){return;}if(o.filterRestriction!==sap.ui.comp.smartfilterbar.FilterType.multiple){k=true;}if(u){e=o.defaultFilterValues;H=e&&e.length;}if(o.filterRestriction===sap.ui.comp.smartfilterbar.FilterType.single){if(H){i=e[0];L=i.low;}j[o.fieldName]=L;}else if(o.filterRestriction===sap.ui.comp.smartfilterbar.FilterType.interval&&o.type!=="Edm.Time"){if(H){i=e[0];L=i.low;s=i.high;}j[o.fieldName]={low:L,high:s};}else{if(H){m=e.length;while(m--){i=e[m];if(k){n={"exclude":i.sign==="E","operation":i.operator==="CP"?"Contains":i.operator,"keyField":o.fieldName,"value1":i.low,"value2":i.high};}else{n={key:i.low,text:i.low};}p.push(n);}}this._aFilterBarMultiValueFieldMetadata.push(o);j[o.fieldName]={value:null};if(k){r=p.slice(0);p=[];j[o.fieldName].ranges=r;}j[o.fieldName].items=p;this._updateMultiValueControl(o.control,p,r);}};l.prototype._createInitialModel=function(u){var o,G,e,k,j,i;o={};this._bCreatingInitialModel=true;this._aFilterBarMultiValueFieldMetadata=[];if(this._aFilterBarViewMetadata){G=this._aFilterBarViewMetadata.length;for(i=0;i<G;i++){k=this._aFilterBarViewMetadata[i];e=k.fields.length;for(j=0;j<e;j++){this._createInitialModelForField(o,k.fields[j],u);}}}if(this._aAnalyticalParameters){e=this._aAnalyticalParameters.length;for(j=0;j<e;j++){this._createInitialModelForField(o,this._aAnalyticalParameters[j],u);}}this.oModel.setData(o);if(!u){this._clearConditionTypeFields();}this._updateConditionTypeFields();this._bCreatingInitialModel=false;};l.prototype._updateMultiValueControl=function(o,e,r){var i=0,t=null,j=null,R=null,s=null,k=null;if(o&&e){i=e.length;if(o instanceof b){t=[];while(i--){s=e[i].text||e[i].key;t.push(new c({key:e[i].key,text:s,tooltip:s}));}if(r){i=r.length;while(i--){R=r[i];if(R.tokenText){s=R.tokenText;}else{s=g.getFormattedRangeText(R.operation,R.value1,R.value2,R.exclude);}j=new c({text:s,tooltip:s});j.data("range",R);t.push(j);}}o.setTokens(t);}if(o instanceof M){k=[];while(i--){k.push(e[i].key);}o.setSelectedKeys(k);}}};l.prototype._applyIndexes=function(){var e,i;if(!this._aFilterBarViewMetadata){return;}this._aFilterBarViewMetadata=this._sortByIndex(this._aFilterBarViewMetadata);e=this._aFilterBarViewMetadata.length;for(i=0;i<e;i++){if(this._aFilterBarViewMetadata[i].fields){this._aFilterBarViewMetadata[i].fields=this._sortByIndex(this._aFilterBarViewMetadata[i].fields);}}};l.prototype._sortByIndex=function(A){var e,i,j,r,k,o;if(!A||!A.length){return A;}r=[];e=[];j=A.length;for(i=0;i<j;i++){o=A[i];k=o.index;if(k>=0){e.push(o);}else{r.push(o);}}j=e.length;if(j){e=e.sort(function(m,n){return m.index-n.index;});if(!r.length){r=e;}else{for(i=0;i<j;i++){o=e[i];if(o.index>=r.length){r.push(o);}else{r.splice(o.index,0,o);}}}}return r;};l.prototype._applyGroupId=function(){var e,i,m,j,o,n,k;e=this._aFilterBarViewMetadata.length;for(i=0;i<e;i++){if(!this._aFilterBarViewMetadata[i].fields){continue;}m=this._aFilterBarViewMetadata[i].fields.length;for(j=0;j<m;j++){o=this._aFilterBarViewMetadata[i].fields[j];if(o&&o.groupId&&o.groupId!==this._aFilterBarViewMetadata[i].groupName){n=undefined;for(k=0;k<e;k++){if(this._aFilterBarViewMetadata[k].groupName===o.groupId){n=this._aFilterBarViewMetadata[k];break;}}if(n){this._aFilterBarViewMetadata[i].fields.splice(j,1);j--;m--;n.fields=n.fields||[];n.fields.push(o);}}}}};l.prototype._createFilterControlId=function(o){var s=this._oSmartFilter.getId();var G=h.replace(o.groupName||"");var n=h.replace(o.name);return s+"-filterItemControl"+G+"-"+n;};l.prototype._createGroupMetadata=function(o){var G,e,s;s=o.groupName||o.groupEntityName;e=this._oAdditionalConfiguration.getGroupConfigurationByKey(s);G={};G.groupName=s;G.groupLabel=this._getGroupLabel(o,e);G.fields=[];G.index=this._getGroupIndex(e);return G;};l.prototype._createGroupMetadataForCustomGroup=function(G){var o;o={};o.groupName=G.key;o.groupLabel=G.label;o.fields=[];o.index=this._getGroupIndex(G);return o;};l.prototype._createControl=function(o){var e,t,i=false,j,k={},m,n;if(o.customControl){return o.customControl;}if(o.precision||o.scale){k.precision=o.precision;k.scale=o.scale;}if(o.maxLength){k.maxLength=o.maxLength;}if(o.displayFormat){k.displayFormat=o.displayFormat;}if(o.fControlConstructor===a||o.fControlConstructor===D){j=this._oDateFormatSettings;}t=O.getType(o.type,j,k);e=new o.fControlConstructor(this._createFilterControlId(o));if(o.fControlConstructor===a){e.bindProperty('dateValue',this.sFilterModelName+">/"+o.fieldName+"/low");e.bindProperty('secondDateValue',this.sFilterModelName+">/"+o.fieldName+"/high");}else if(o.fControlConstructor===C){if(e.setForceSelection){e.setForceSelection(true);}this._associateValueList(e,"items",o);e.attachSelectionChange(function(){if(this._bUpdatingFilterData||this._bCreatingInitialModel){return;}e.fireChange({filterChangeReason:o.fieldName,value:""});}.bind(this));e.bindProperty('selectedKey',this.sFilterModelName+">/"+o.fieldName);}else if(o.fControlConstructor===M){this._associateValueList(e,"items",o);e.attachSelectionChange(function(p){if(this._bUpdatingFilterData||this._bCreatingInitialModel){return;}var r=p.getSource(),s=null,K=[],L;s=r.getSelectedItems();if(s){L=s.length;while(L--){K.push({key:s[L].getKey(),text:s[L].getText()});}}if(this.oModel){this.oModel.setProperty("/"+o.fieldName+"/items",K);}r.fireChange({filterChangeReason:o.fieldName,value:""});}.bind(this));e.bindProperty('value',this.sFilterModelName+">/"+o.fieldName+"/value");}else if(o.fControlConstructor===b){if(o.controlType===sap.ui.comp.smartfilterbar.ControlType.date||o.type==="Edm.Time"){e.setValueHelpOnly(true);if(o.filterRestriction===sap.ui.comp.smartfilterbar.FilterType.interval){this._associateValueHelpDialog(e,o,false,false);}else{this._associateValueHelpDialog(e,o,true,true);}}else{if(o.hasValueHelpDialog){this._associateValueHelpDialog(e,o,o.filterRestriction!==sap.ui.comp.smartfilterbar.FilterType.multiple,true);}else{e.setShowValueHelp(false);}e.bindProperty('value',{path:this.sFilterModelName+">/"+o.fieldName+"/value",type:t});}this._handleMultiInput(e,o,t);}else if(o.fControlConstructor===I){if(o.filterRestriction===sap.ui.comp.smartfilterbar.FilterType.interval){i=true;e.bindProperty('value',this.sFilterModelName+">/"+o.fieldName+"/low");if(!this.oResourceBundle){this.oResourceBundle=sap.ui.getCore().getLibraryResourceBundle("sap.ui.comp");}if(!this.sIntervalPlaceholder){this.sIntervalPlaceholder=this.oResourceBundle.getText("INTERVAL_PLACEHOLDER_TEXT");}e.setPlaceholder(this.sIntervalPlaceholder);}else{e.bindProperty('value',{path:this.sFilterModelName+">/"+o.fieldName,type:t});}if(o.hasValueHelpDialog){e.setShowValueHelp(true);this._associateValueHelpDialog(e,o,false,false);}}else if(o.fControlConstructor===D||o.fControlConstructor===T){e.bindProperty('dateValue',this.sFilterModelName+">/"+o.fieldName);}if(e instanceof D){if(this._oDateFormatSettings&&this._oDateFormatSettings.style){e.setDisplayFormat(this._oDateFormatSettings.style);}e.attachChange(function(p){var v=p.getParameter("valid");e.data("__mandatoryEmpty",null);if(v){e.setValueState(sap.ui.core.ValueState.None);e.setValueStateText();}else{e.setValueState(sap.ui.core.ValueState.Error);if(t){try{t.parseValue("foo","string");}catch(r){e.setValueStateText(r.message);}}}});}if(o.hasTypeAhead){e.setShowSuggestion(true);e.setFilterSuggests(false);this._associateValueList(e,"suggestionRows",o,true);}if(o.displayFormat==="UpperCase"&&e.attachChange&&e.setValue){e.attachChange(function(){var v=e.getValue();if(v){e.setValue(v.toUpperCase());}});}if(e instanceof I){if(!o.hasValueListAnnotation&&!i&&o.maxLength){m=parseInt(o.maxLength,10);if(!isNaN(m)){e.setMaxLength(m);}}}n=function(p){var r=p.getParameter("exception");if(e){if(r){if(e.setValueStateText){e.setValueStateText(r.message);}}if(e.setValueState){e.setValueState(sap.ui.core.ValueState.Error);}e.data("__mandatoryEmpty",null);}};e.attachParseError(n);e.attachFormatError(n);e.attachValidationError(n);e.attachValidationSuccess(function(p){if(e){if(e.setValueState){e.setValueState(sap.ui.core.ValueState.None);}if(e.setValueStateText){e.setValueStateText();}e.data("__mandatoryEmpty",null);delete e.__sValidationText;}});return e;};l.prototype._getControlConstructor=function(o){var e=I,i,j;if(o.isCustomFilterField){e=undefined;}else{i=(o.filterRestriction===sap.ui.comp.smartfilterbar.FilterType.single);j=(o.filterRestriction===sap.ui.comp.smartfilterbar.FilterType.interval);if(o.controlType===sap.ui.comp.smartfilterbar.ControlType.date){o.displayFormat="Date";if(i){e=D;}else{e=j?a:b;}this._aFilterBarDateFieldNames.push(o.fieldName);if(o.filterRestriction===sap.ui.comp.smartfilterbar.FilterType.multiple){this._aFilterBarDateTimeMultiValueFieldNames.push(o.fieldName);}}else if(o.controlType===sap.ui.comp.smartfilterbar.ControlType.dropDownList){e=(i)?C:M;if(!i){o.filterRestriction=sap.ui.comp.smartfilterbar.FilterType.multiple;}}else if(o.type==="Edm.Time"){if(i){e=T;}else{e=b;}this._aFilterBarTimeFieldNames.push(o.fieldName);if(j){this._aFilterBarTimeIntervalFieldNames.push(o.fieldName);}else if(o.filterRestriction===sap.ui.comp.smartfilterbar.FilterType.multiple){this._aFilterBarDateTimeMultiValueFieldNames.push(o.fieldName);}}else if(!i&&!j){e=b;}}return e;};l.prototype._handleMultiInput=function(o,e,t){o.setEnableMultiLineMode(true);o.attachTokenChange(function(k){if(this._bUpdatingFilterData||this._bCreatingInitialModel||k.getParameter("type")!=="tokensChanged"){return;}var m=k.getSource().getTokens(),n=[],L,p=null,r=null,R=[];if(m){L=m.length;while(L--){p=m[L];r=p.data("range");if(r){r.tokenText=p.getText();R.push(r);}else{n.push({key:p.getKey(),text:p.getText()});}}}if(this.oModel){this.oModel.setProperty("/"+e.fieldName+"/items",n);this.oModel.setProperty("/"+e.fieldName+"/ranges",R);}o.fireChange({filterChangeReason:e.fieldName,value:""});}.bind(this));var i,j=((e.type==="Edm.DateTime"&&e.displayFormat==="Date"));if(e.hasValueListAnnotation||(e.type==="Edm.String")||j){o.attachEvent("_validateOnPaste",function(k){var m=k.getParameter("texts"),p,L,s,n,r;L=m?m.length:0;if(L>1){k.preventDefault();p=this.oModel.getProperty("/"+e.fieldName);r=p.ranges||[];o.setValue("");while(L--){s=m[L];if(s){n=null;if(j){i=this._getDateValue(s,t);if(isNaN(i.getDate())){continue;}else{n=s;s=i;}}r.push({"exclude":false,"operation":"EQ","keyField":e.fieldName,"value1":s,"value2":null,"tokenText":n});}}this.oModel.setProperty("/"+e.fieldName+"/ranges",r);this._updateMultiValueControl(o,p.items,r);}}.bind(this));}};l.prototype._getDateValue=function(v,t){var o;try{o=t.parseValue(v,"string");if(o){return o;}}catch(e){}return new Date(v);};l.prototype._associateValueHelpDialog=function(o,e,s,i){this._aValueHelpDialogProvider.push(new V({loadAnnotation:e.hasValueListAnnotation,fullyQualifiedFieldName:e.fullName,metadataAnalyser:this._oMetadataAnalyser,control:o,filterModel:this.oModel,filterProvider:this,model:this._oParentODataModel,preventInitialDataFetchInValueHelpDialog:e.preventInitialDataFetchInValueHelpDialog,dateFormatSettings:this._oDateFormatSettings,supportMultiSelect:i,supportRanges:s,isUnrestrictedFilter:e.filterRestriction!==sap.ui.comp.smartfilterbar.FilterType.multiple,isSingleIntervalRange:e.filterRestriction===sap.ui.comp.smartfilterbar.FilterType.interval,fieldName:e.fieldName,type:e.filterType,scale:e.scale,precision:e.precision,maxLength:e.maxLength,displayFormat:e.displayFormat,displayBehaviour:e.displayBehaviour,title:e.label}));};l.prototype._associateValueList=function(o,A,e,H){if(e.hasValueListAnnotation){this._aValueListProvider.push(new f({control:o,fieldName:e.fieldName,typeAheadEnabled:H,aggregation:A,displayFormat:e.displayFormat,displayBehaviour:e.displayBehaviour,dateFormatSettings:this._oDateFormatSettings,loadAnnotation:true,fullyQualifiedFieldName:e.fullName,metadataAnalyser:this._oMetadataAnalyser,filterModel:this.oModel,filterProvider:this,model:this._oParentODataModel}));}};l.prototype._createAnalyticParameters=function(p){var e,o,P,j,k;if(p){P=p.getAllParameterNames();o=p.getEntitySet();if(o){e=p.getEntitySet().getQName();k=this._oMetadataAnalyser.getFieldsByEntitySetName(e);for(var i=0;i<k.length;i++){if(P.indexOf(k[i].name)>=0){j=this._createAnalyticParameterMetadata(k[i]);this._aAnalyticalParameters.push(j);}}}}};l.prototype._createAnalyticParameterMetadata=function(p){p.filterRestriction="single-value";var o=this._createFieldMetadata(p);o.fieldName="$Parameter."+p.name;o.isMandatory=true;o.isParameter=true;o.visibleInAdvancedArea=true;return o;};l.prototype.getAnalyticParameters=function(){return this._aAnalyticalParameters;};l.prototype.getAnalyticBindingPath=function(){var v,p=[],P=this.getAnalyticParameters();P.forEach(function(o){p.push(o.fieldName);});v=this.getFilledFilterData(p);return this._createAnalyticBindingPath(P,v);};l.prototype._createAnalyticBindingPath=function(p,v){var s,P="",o;o=this._getParameterizationRequest(this._oParameterization);if(o){p.forEach(function(e){s=v[e.fieldName];if(!s){s="";}o.setParameterValue(e.name,s);});P=o.getURIToParameterizationEntry()+'/'+this._oParameterization.getNavigationPropertyToQueryResult();}return P;};l.prototype._getParameterizationRequest=function(){return this._oParameterization?new sap.ui.model.analytics.odata4analytics.ParameterizationRequest(this._oParameterization):null;};l.prototype._createFieldMetadata=function(o){var e,i;o.fieldName=this._getFieldName(o);o.fieldNameOData=o.fieldName.replace(l.FIELD_NAME_REGEX,"/");i=this._oAdditionalConfiguration.getControlConfigurationByKey(o.fieldName);e=q.extend({},o);e.filterRestriction=this._getFilterRestriction(o,i);this._updateValueListMetadata(e,o);e.hasValueHelpDialog=this._hasValueHelpDialog(e,i);e.preventInitialDataFetchInValueHelpDialog=i?i.preventInitialDataFetchInValueHelpDialog:true;e.controlType=this._getControlType(e,i);if(i&&i.displayBehaviour&&i.displayBehaviour!=="auto"){e.displayBehaviour=i.displayBehaviour;}e.isCustomFilterField=!!(i&&i.customControl);e.visibleInAdvancedArea=!!(i&&i.visibleInAdvancedArea);e.label=this._getLabel(o,i);e.isMandatory=this._isMandatory(o,i);e.width=this._getWidth(i);e.isVisible=this._isVisible(i);e.groupId=this._getGroupID(o,i);e.index=this._getIndex(o,i);e.fControlConstructor=this._getControlConstructor(e);e.filterType=this._getFilterType(e);e.hasTypeAhead=this._hasTypeAhead(e,o,i);e.customControl=i?i.customControl:undefined;e.fCreateControl=function(n){var p,r;n.control=this._createControl(n);p=this.oModel.getData();r=p[n.fieldName];if(r){this._updateMultiValueControl(n.control,r.items,r.ranges);}}.bind(this);this._applyWidth(e);e.defaultFilterValues=i?i.defaultFilterValues:undefined;if(e.type==="Edm.String"){this._aFilterBarStringFieldNames.push(e.fieldName);}e.conditionType=null;var j=i?i.conditionType:null;if(j){var s="";if(typeof j==="object"){s=j.module;delete j.module;}else{s=j;j=null;}try{q.sap.require(s);var k=q.sap.getObject(s);if(k){e.conditionType=new k(e.fieldName,this,e);this._mConditionTypeFields[e.fieldName]=e;}if(j){e.conditionType.applySettings(j);}}catch(m){q.sap.log.error("Module "+s+" could not be loaded");}}return e;};l.prototype._getFilterType=function(o){if(O.isNumeric(o.type)){return"numeric";}else if(o.type==="Edm.DateTime"&&o.displayFormat==="Date"){return"date";}else if(o.type==="Edm.String"){return"string";}else if(o.type==="Edm.Boolean"){return"boolean";}else if(o.type==="Edm.Time"){return"time";}return undefined;};l.prototype._updateValueListMetadata=function(o,e){o.hasValueListAnnotation=e["sap:value-list"]!==undefined;if(o.hasValueListAnnotation){o.hasFixedValues=e["sap:value-list"]==="fixed-values";}else if(e["com.sap.vocabularies.Common.v1.ValueList"]){o.hasValueListAnnotation=true;o.hasFixedValues=this._oMetadataAnalyser.getValueListSemantics(e["com.sap.vocabularies.Common.v1.ValueList"])==="fixed-values";}};l.prototype._createBasicSearchFieldMetadata=function(){var o;var r=sap.ui.getCore().getLibraryResourceBundle("sap.ui.comp");o={};o.filterRestriction=sap.ui.comp.smartfilterbar.FilterType.single;o.name=l.BASIC_SEARCH_FIELD_ID;o.fieldName=l.BASIC_SEARCH_FIELD_ID;o.label=undefined;o.isMandatory=false;o.isVisible=true;o.groupId=l.BASIC_FILTER_AREA_ID;o.index=-1;o.control=new S(this._oSmartFilter.getId()+"-btnBasicSearch",{showSearchButton:true});if(!this._isRunningInValueHelpDialog){o.control.setPlaceholder(r.getText("FILTER_BAR_BSEARCH_PLACE_HOLDER"));}o.control.bindProperty('value',this.sFilterModelName+">/"+o.fieldName);return o;};l.prototype._applyWidth=function(o){if(o&&o.width&&o.control&&o.control.setWidth&&(typeof o.control.setWidth==='function')){o.control.setWidth(o.width);}};l.prototype._createFieldMetadataForCustomFilterFields=function(o){var e;if(!o||!o.customControl){return undefined;}e={};e.name=o.key;e.fieldName=o.key;e.label=o.label;e.visibleInAdvancedArea=!!(o&&o.visibleInAdvancedArea);e.isVisible=this._isVisible(o);e.groupId=o.groupId;e.isMandatory=this._isMandatory(undefined,o);e.index=o.index;e.width=this._getWidth(o);e.control=o.customControl;e.isCustomFilterField=true;this._applyWidth(e);return e;};l.prototype._getFieldName=function(o){if(!o.parentPropertyName){return o.name;}else{return o.parentPropertyName+"."+o.name;}};l.prototype._hasValueHelpDialog=function(o,e){var v=true;if(e){if(e.controlType===sap.ui.comp.smartfilterbar.ControlType.dropDownList){v=false;}else if(e.hasValueHelpDialog!==true){v=false;}}if(o&&!o.hasValueListAnnotation){if(o.filterRestriction===sap.ui.comp.smartfilterbar.FilterType.single||o.filterRestriction===sap.ui.comp.smartfilterbar.FilterType.multiple){v=false;}}return v;};l.prototype._isVisible=function(o){if(o&&o.isVisible===false){return false;}return true;};l.prototype._getWidth=function(o){if(o&&o.width){return o.width;}return undefined;};l.prototype._isMandatory=function(o,e){if(e&&e.mandatory!==sap.ui.comp.smartfilterbar.MandatoryType.auto){return e.mandatory===sap.ui.comp.smartfilterbar.MandatoryType.mandatory;}if(o){return o.requiredFilterField;}return false;};l.prototype._getFilterRestriction=function(o,e){var s;if(e&&e.filterType&&e.filterType!==sap.ui.comp.smartfilterbar.FilterType.auto){s=e.filterType;}else if(o.filterRestriction==="single-value"){s=sap.ui.comp.smartfilterbar.FilterType.single;}else if(o.filterRestriction==="multi-value"){s=sap.ui.comp.smartfilterbar.FilterType.multiple;}else if(o.filterRestriction==="interval"){s=sap.ui.comp.smartfilterbar.FilterType.interval;}else{s=sap.ui.comp.smartfilterbar.FilterType.auto;}return s;};l.prototype._getControlType=function(o,e){var s;if(e&&e.controlType&&e.controlType!==sap.ui.comp.smartfilterbar.ControlType.auto){s=e.controlType;}else if(o.type==="Edm.DateTime"&&o.displayFormat==="Date"){s=sap.ui.comp.smartfilterbar.ControlType.date;}else if(o.hasValueListAnnotation&&o.hasFixedValues){s=sap.ui.comp.smartfilterbar.ControlType.dropDownList;}else{s=sap.ui.comp.smartfilterbar.ControlType.input;}return s;};l.prototype._getGroupID=function(o,e){if(e&&e.groupId){return e.groupId;}else if(o&&(o.requiredFilterField||(this._aSelectionFields&&this._aSelectionFields.indexOf(o.fieldNameOData)>-1))){return this._sBasicFilterAreaID;}return this._getGroupIDFromFieldGroup(o);};l.prototype._getGroupIDFromFieldGroup=function(o){var L=0,e=null,G;if(o&&this._aFieldGroupAnnotation&&this._aFieldGroupAnnotation.length){L=this._aFieldGroupAnnotation.length;while(L--){e=this._aFieldGroupAnnotation[L];if(e&&e.fields&&e.fields.indexOf(o.fieldNameOData)>-1){G=e.groupName;break;}}}return G;};l.prototype._getLabel=function(o,e){if(e&&e.label){return e.label;}return this._getLabelFromFieldGroup(o)||o.fieldLabel||o.fieldName;};l.prototype._getLabelFromFieldGroup=function(o){var L=0,e=null,s;if(o&&this._aFieldGroupAnnotation&&this._aFieldGroupAnnotation.length){L=this._aFieldGroupAnnotation.length;while(L--){e=this._aFieldGroupAnnotation[L];if(e&&e.fields&&e.fields.indexOf(o.fieldNameOData)>-1){s=e.labels[o.fieldNameOData];break;}}}return s;};l.prototype._getIndex=function(o,e){if(e&&(e.index>=0)){return e.index;}else if(this._aSelectionFields&&this._aSelectionFields.indexOf(o.fieldNameOData)>-1){return this._aSelectionFields.indexOf(o.fieldNameOData);}return this._getIndexFromFieldGroup(o);};l.prototype._getIndexFromFieldGroup=function(o){var L=0,e=null,i;if(o&&this._aFieldGroupAnnotation&&this._aFieldGroupAnnotation.length){L=this._aFieldGroupAnnotation.length;while(L--){e=this._aFieldGroupAnnotation[L];if(e&&e.fields){i=e.fields.indexOf(o.fieldNameOData);if(i>-1){break;}i=undefined;}}}return i;};l.prototype._getGroupIndex=function(G){if(G&&(G.index||G.index===0)){return G.index;}};l.prototype._getGroupLabel=function(o,G){if(G&&G.label){return G.label;}return o.groupLabel||o.groupName||o.groupEntityName;};l.prototype._hasTypeAhead=function(o,e,i){var H;H=true;if(i){H=i.hasTypeAhead;}else if(e.type!=="Edm.String"){return false;}if(!(o.fControlConstructor===I||o.fControlConstructor===b)){return false;}return H;};l.prototype.getModel=function(){return this.oModel;};l.prototype.getFilterBarViewMetadata=function(){return this._aFilterBarViewMetadata;};l.prototype.getParameters=function(){var p,B=null;if(this.oModel){B=this.oModel.getProperty("/"+l.BASIC_SEARCH_FIELD_ID);}if(this._sBasicSearchFieldName||B){p={custom:{}};if(this._sBasicSearchFieldName){p.custom["search-focus"]=this._sBasicSearchFieldName;}p.custom["search"]=B||"";}return p;};l.prototype.getFilters=function(e){var o=null;if(this.oModel){o=this.oModel.getData();}return l.generateFilters(e,o,{dateSettings:this._oDateFormatSettings,useContainsAsDefault:this._bUseContainsAsDefault,stringFields:this._aFilterBarStringFieldNames,timeFields:this._aFilterBarTimeFieldNames});};l.prototype.getFilterData=function(){return this.oModel?this.oModel.getData():null;};l.prototype.getFilterDataAsString=function(){return this.oModel?this.oModel.getJSON():null;};l.prototype.getFilledFilterData=function(e){var o,i={},j,s,v;o=this.oModel?this.oModel.getData():null;if(o&&e){j=e.length;while(j--){s=e[j];if(s&&s!==l.BASIC_SEARCH_FIELD_ID){v=o[s];if(v&&v.hasOwnProperty("low")){if(v.low){i[s]=v;}}else if(v&&v.hasOwnProperty("items")){if(v.value&&typeof v.value==="string"){v.value=v.value.trim();}if(v.items.length||(v.ranges&&v.ranges.length)||v.value){i[s]=v;}}else if(v){if(typeof v==="string"){v=v.trim();}if(v){i[s]=v;}}}if(j===0){s=l.CUSTOM_FIELDS_MODEL_PROPERTY;v=o[s];if(v){i[s]=v;}}}}return q.extend(true,{},i);};l.prototype.getFilledFilterDataAsString=function(e){return JSON.stringify(this.getFilledFilterData(e));};l.prototype.setFilterData=function(j,r){var o=null,e=null,k=null;if(this.oModel&&j){this._bUpdatingFilterData=true;if(r){this._createInitialModel(false);}o=this._parseFilterData(j,r);if(o){this.oModel.setData(o,true);e=[];var s=arguments[2];if(s){e.push(s);}for(k in o){e.push(k);}this._handleFilterDataUpdate(e);}this._bUpdatingFilterData=false;}};l.prototype.setFilterDataAsString=function(j,r){if(j){this.setFilterData(JSON.parse(j),r);}};l.prototype._parseFilterData=function(j,r){return l.parseFilterData(this.oModel.getData(),j,{dateFields:this._aFilterBarDateFieldNames,timeFields:this._aFilterBarTimeFieldNames,timeIntervalFields:this._aFilterBarTimeIntervalFieldNames,dateTimeMultiValueFields:this._aFilterBarDateTimeMultiValueFieldNames,conditionTypeFields:this._mConditionTypeFields},r);};l.prototype._handleFilterDataUpdate=function(e){var i=0,o,j,k;if(this._aFilterBarMultiValueFieldMetadata){i=this._aFilterBarMultiValueFieldMetadata.length;while(i--){if(!j){j=this.oModel.getData();}if(j){o=this._aFilterBarMultiValueFieldMetadata[i];if(e.indexOf(o.fieldName)>-1){k=j[o.fieldName];if(k){this._updateMultiValueControl(o.control,k.items,k.ranges);}}}}this._updateConditionTypeFields();}};l.prototype.clear=function(){this._createInitialModel(false);};l.prototype.reset=function(){this._createInitialModel(true);};l.prototype._initializeConditionTypeFields=function(){var e=function(o){this.setPending(this.isPending());}.bind(this);for(var n in this._mConditionTypeFields){this._mConditionTypeFields[n].conditionType.initialize(this.oModel.getData()[n]);if(this._mConditionTypeFields[n].conditionType.getAsync()){this._mConditionTypeFields[n].conditionType.attachPendingChange(e);}}};l.prototype._updateConditionTypeFields=function(){var o=this._oldData;var e=this.oModel.getData();this._oldData=q.extend(true,{},e);if(o!==undefined){var u=[],n;for(n in e){var N=JSON.stringify(e[n]);var s=JSON.stringify(o[n]);if(N!==s){u.push(n);}}if(u.length>0){for(n in this._mConditionTypeFields){this._mConditionTypeFields[n].conditionType.providerDataUpdated(u,e);}}}};l.prototype._clearConditionTypeFields=function(){var e=this.oModel.getData();for(var n in this._mConditionTypeFields){this._mConditionTypeFields[n].conditionType.initialize(e[n]);}};l.prototype._validateConditionTypeFields=function(){var i=false;for(var n in this._mConditionTypeFields){var v=this._mConditionTypeFields[n].conditionType.validate();if(!v&&!i){i=true;}}return i;};l.generateFilters=function(e,o,s){var i=[],A=null,j=null,k=null,m=null,n=l.FIELD_NAME_REGEX,v=null,p,r,t=null,L=0,u=0;var w,x,y,z,U,B;if(s){w=s.dateSettings;x=s.useContainsAsDefault;y=s.stringFields;z=s.timeFields;}if(e&&o){u=e.length;while(u--){B=false;m=e[u];if(m&&m!==l.BASIC_SEARCH_FIELD_ID){U=false;if(x&&y){if(y.indexOf(m)>-1){U=true;}}else if(z&&z.indexOf(m)>-1){B=true;}v=o[m];m=m.replace(n,"/");if(v&&v.hasOwnProperty("low")){if(v.low&&v.high){p=v.low;r=v.high;if(w&&w.UTC&&p instanceof Date&&r instanceof Date){p=l.getDateInUTCOffset(p);r=l.getDateInUTCOffset(r);}i.push(new F(m,sap.ui.model.FilterOperator.BT,p,r));}else if(v.low){if(v.low instanceof Date){p=v.low;if(w&&w.UTC){p=l.getDateInUTCOffset(p);}i.push(new F(m,sap.ui.model.FilterOperator.EQ,p));}else if(typeof v.low==="string"){t=v.low.split("-");if(t&&t.length===2){i.push(new F(m,sap.ui.model.FilterOperator.BT,t[0],t[1]));}else{i.push(new F(m,U?sap.ui.model.FilterOperator.Contains:sap.ui.model.FilterOperator.EQ,v.low));}}}}else if(v&&v.hasOwnProperty("items")){A=[];k=[];j=null;if(v&&v.hasOwnProperty("ranges")){t=v.ranges;L=t.length;while(L--){p=t[L].value1;r=t[L].value2;if(B){if(p instanceof Date){p=g.getEdmTimeFromDate(p);}if(r instanceof Date){r=g.getEdmTimeFromDate(r);}}else if(w&&w.UTC){if(p instanceof Date){p=l.getDateInUTCOffset(p);}if(r instanceof Date){r=l.getDateInUTCOffset(r);}}if(t[L].exclude){if(t[L].operation===sap.ui.model.FilterOperator.EQ){k.push(new F(m,sap.ui.model.FilterOperator.NE,p));}}else{A.push(new F(m,t[L].operation,p,r));}}if(k.length){j=new F(k,true);}}t=v.items;L=t.length;while(L--){A.push(new F(m,sap.ui.model.FilterOperator.EQ,t[L].key));}if(v.value||v.value===0||v.value===false){if(typeof v.value==="string"){v.value=v.value.trim();}if(v.value||v.value===0||v.value===false){A.push(new F(m,U?sap.ui.model.FilterOperator.Contains:sap.ui.model.FilterOperator.EQ,v.value));}}if(A.length){if(j){i.push(new F([new F(A,false),j],true));}else{i.push(new F(A,false));}}else if(j){i.push(j);}}else if(v||v===0||v===false){if(typeof v==="string"){v=v.trim();}if(v&&v instanceof Date){if(B){v=g.getEdmTimeFromDate(v);}else if(w&&w.UTC){v=l.getDateInUTCOffset(v);}}if(v||v===0||v===false){i.push(new F(m,U?sap.ui.model.FilterOperator.Contains:sap.ui.model.FilterOperator.EQ,v));}}}}}return(i.length>1)?[new F(i,true)]:i;};l.parseFilterData=function(o,e,s,r){var R={},m=null,j=null,v=null,n,k,i,L,p,t,u,w,x,y;if(s){t=s.dateFields;u=s.timeFields;w=s.timeIntervalFields;x=s.dateTimeMultiValueFields;m=s.conditionTypeFields||{};}if(!t){t=[];}if(!u){u=[];}if(!w){w=[];}if(!x){x=[];}if(o&&e){k=q.extend({},e,true);for(j in k){if(o.hasOwnProperty(j)&&j!==l.CUSTOM_FIELDS_MODEL_PROPERTY){v=o[j];n=k[j];if(j in m){if("conditionTypeInfo"in n||(!("conditionTypeInfo"in n)&&n.ranges)){m[j].conditionType.initialize(n);}}else if(v&&v.hasOwnProperty("low")){R[j]=n;if(n){if(n.low&&n.high){if(!(n.low instanceof Date)){R[j].low=new Date(n.low);}if(!(n.high instanceof Date)){R[j].high=new Date(n.high);}}else if((n.low||n.value)&&!n.high){if(!n.low&&n.value){n.low=n.value;}if((t.indexOf(j)>-1||u.indexOf(j)>-1)&&!(n.low instanceof Date)){R[j].low=new Date(n.low);}else{R[j].low=n.low;}R[j].high=null;}}}else if(v&&v.hasOwnProperty("items")){if(n&&(n.items||n.ranges)){if(n.ranges&&n.ranges.length){if(w.indexOf(j)>-1){L=n.ranges.length;for(i=0;i<L;i++){p=n.ranges[i];if(!p.exclude&&(p.operation==="EQ"||p.operation==="BT")){break;}p=null;}if(p){if(p.value1&&typeof p.value1==="string"){p.value1=new Date(p.value1);}if(p.value2&&typeof p.value2==="string"){p.value2=new Date(p.value2);}R[j]={ranges:[p],items:[],value:""};}continue;}else if(x.indexOf(j)>-1){L=n.ranges.length;y=[];for(i=0;i<L;i++){p=n.ranges[i];if(!p.exclude&&p.operation==="EQ"){if(p.value1&&typeof p.value1==="string"){p.value1=new Date(p.value1);}y.push(p);}}R[j]={ranges:y,items:[],value:""};continue;}else if(t.indexOf(j)>-1||u.indexOf(j)>-1){L=n.ranges.length;for(i=0;i<L;i++){p=n.ranges[i];if(p.value1&&typeof p.value1==="string"){p.value1=new Date(p.value1);}if(p.value2&&typeof p.value2==="string"){p.value2=new Date(p.value2);}}}}R[j]=n;}else if(typeof n==="string"||typeof n==="number"||n instanceof Date){if(n&&(t.indexOf(j)>-1||u.indexOf(j)>-1)){if(typeof n==="string"){n=new Date(n);}R[j]={ranges:[{"exclude":false,"operation":"EQ","keyField":j,"value1":n,"value2":null}],items:[],value:""};}else{R[j]={value:n,items:[]};}}}else{R[j]=null;if(typeof n==="string"||typeof n==="boolean"||typeof n==="number"||n instanceof Date){if(typeof n==="string"&&(t.indexOf(j)>-1||u.indexOf(j)>-1)){R[j]=new Date(n);}else{R[j]=n;}}else if(n&&(n.value||n.value===0||n.value===false)){R[j]=n.value;}else if(n&&n.items&&n.items.length){R[j]=n.items[0].key;}else if(n&&n.ranges&&n.ranges.length){L=n.ranges.length;for(i=0;i<L;i++){p=n.ranges[i];if(!p.exclude&&p.operation==="EQ"){break;}p=null;}if(p&&p.value1){if(typeof p.value1==="string"&&(t.indexOf(j)>-1||u.indexOf(j)>-1)){R[j]=new Date(p.value1);}else{R[j]=p.value1;}}}}}else if(r||j===l.CUSTOM_FIELDS_MODEL_PROPERTY){R[j]=k[j];}}}return R;};l.getDateInUTCOffset=function(o){return new Date(o.valueOf()-o.getTimezoneOffset()*60*1000);};l.prototype.destroy=function(){var e=function(A){var i;if(A){i=A.length;while(i--){A[i].destroy();}}};this._oParentODataModel=null;this._aAnalyticalParameters=null;this._aFilterBarViewMetadata=null;this._oParameterization=null;this._aFilterBarFieldNames=null;this._aFilterBarDateFieldNames=null;this._aFilterBarTimeFieldNames=null;this._aFilterBarTimeIntervalFieldNames=null;this._aFilterBarDateTimeMultiValueFieldNames=null;this._aFilterBarStringFieldNames=null;this._aFilterBarMultiValueFieldMetadata=null;this._aFieldGroupAnnotation=null;this._aSelectionFields=null;if(this._oMetadataAnalyser&&this._oMetadataAnalyser.destroy){this._oMetadataAnalyser.destroy();}this._oMetadataAnalyser=null;e(this._aValueHelpDialogProvider);this._aValueHelpDialogProvider=null;e(this._aValueListProvider);this._aValueListProvider=null;this.oResourceBundle=null;this.sIntervalPlaceholder=null;this.sDefaultDropDownDisplayBehaviour=null;this.sDefaultTokenDisplayBehaviour=null;this._oSmartFilter=null;if(this._oEventProvider){if(this._oEventProvider.destroy){this._oEventProvider.destroy();}this._oEventProvider=null;}for(var n in this._mConditionTypeFields){this._mConditionTypeFields[n].conditionType.destroy();}this._mConditionTypeFields=null;this.bIsDestroyed=true;};return l;},true);
