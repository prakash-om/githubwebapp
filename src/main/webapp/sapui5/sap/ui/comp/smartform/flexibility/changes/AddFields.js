/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

(c) Copyright 2009-2016 SAP SE. All rights reserved
 */
sap.ui.define(["jquery.sap.global","./AddField","sap/ui/fl/Utils","sap/ui/fl/changeHandler/Base","sap/ui/fl/changeHandler/JsControlTreeModifier"],function(q,A,U,B,J){"use strict";var a={};a.applyChange=function(c,g,p){var C=c.getDefinition();var f=function(C){var M=C.texts;var h=C.content;var k=false;if(h){k=C.content.field&&(C.content.field.selector||C.content.field.id)&&C.content.field.jsTypes&&C.content.field.value&&C.content.field.valueProperty;}return M&&h&&k;};var m=p.modifier;var v=p.view;if(f(C)){var F=C.content.field.selector;var s=C.content.field.id;var l;var L;var P;for(var j=0;j<C.content.field.jsTypes.length;j++){L="fieldLabel"+j;if(C.texts[L].value!==P){l=(l)?l+"/"+C.texts[L].value:C.texts[L].value;P=C.texts[L].value;}}var b=C.content.field.index;var G=m.createControl("sap.ui.comp.smartform.GroupElement",p.appComponent,v,F||s);for(var i=0;i<C.content.field.jsTypes.length;i++){var d=C.content.field.jsTypes[i];var e=C.content.field.valueProperty[i];var o=C.content.field.value[i];var E=C.content.field.entitySet;A.addElementIntoGroupElement(m,v,G,l,d,e,o,E,i,p.appComponent);}m.setProperty(G,"label",l);m.insertAggregation(g,"groupElements",G,b);return true;}else{U.log.error("Change does not contain sufficient information to be applied: ["+C.layer+"]"+C.namespace+"/"+C.fileName+"."+C.fileType);}};a.completeChangeContent=function(c,s,p){var o=p.appComponent;var C=c.getDefinition();if(s.fieldLabels){for(var i=0;i<s.fieldLabels.length;i++){var f="fieldLabel"+i;B.setTextInChange(C,f,s.fieldLabels[i],"XFLD");}}else if(s.label){B.setTextInChange(C,"fieldLabel0",s.label,"XFLD");}else{throw new Error("oSpecificChangeInfo.fieldLabels or label attribute required");}if(!C.content){C.content={};}if(!C.content.field){C.content.field={};}if(s.fieldValues){C.content.field.value=s.fieldValues;}else if(s.bindingPath){C.content.field.value=[s.bindingPath];}else{throw new Error("oSpecificChangeInfo.fieldValue or bindingPath attribute required");}if(s.valueProperty){C.content.field.valueProperty=s.valueProperty;}else if(s.bindingPath){C.content.field.valueProperty=["value"];}else{throw new Error("oSpecificChangeInfo.valueProperty or bindingPath attribute required");}if(s.newControlId){C.content.field.selector=J.getSelector(s.newControlId,o);}else{throw new Error("oSpecificChangeInfo.newControlId attribute required");}if(s.jsTypes){C.content.field.jsTypes=s.jsTypes;}else if(s.bindingPath){C.content.field.jsTypes=["sap.ui.comp.smartfield.SmartField"];}else{throw new Error("oSpecificChangeInfo.jsTypes or bindingPath attribute required");}if(s.index===undefined){throw new Error("oSpecificChangeInfo.index attribute required");}else{C.content.field.index=s.index;}if(s.entitySet){C.content.field.entitySet=s.entitySet;}};return a;},true);
