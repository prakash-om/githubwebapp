/*
 * ! SAP UI development toolkit for HTML5 (SAPUI5)

(c) Copyright 2009-2016 SAP SE. All rights reserved
 */
sap.ui.define(['jquery.sap.global','sap/m/Label',"sap/m/VBox","sap/m/HBox",'sap/ui/comp/library','sap/ui/core/Element','sap/ui/layout/form/FormElement','sap/ui/layout/ResponsiveFlowLayoutData','sap/ui/comp/navpopover/SmartLink','sap/ui/comp/smartfield/SmartLabel','sap/ui/comp/smartfield/SmartField','sap/ui/comp/smartfield/BindingUtil','sap/ui/comp/smartfield/Configuration','sap/ui/core/TooltipBase'],function(q,L,V,H,l,E,F,R,S,a,b,B,C,T){"use strict";var G=F.extend("sap.ui.comp.smartform.GroupElement",{metadata:{library:"sap.ui.comp",properties:{useHorizontalLayout:{type:"boolean",group:"Misc",defaultValue:null},horizontalLayoutGroupElementMinWidth:{type:"int",group:"Misc",defaultValue:null},elementForLabel:{type:"int",group:"Misc",defaultValue:0}},defaultAggregation:"elements",aggregations:{elements:{type:"sap.ui.core.Control",multiple:true,singularName:"element"}},events:{visibleChanged:{}},designTime:true},_visibilityDerived:false});G.prototype.init=function(){F.prototype.init.apply(this,arguments);};G.prototype._getFieldRelevantForLabel=function(){var f=this.getFields();var e=[];var t=this;f.forEach(function(o){if(o instanceof V&&t.getUseHorizontalLayout()){e=e.concat(t._extractFields([o]));}else{e.push(o);}});e=e.filter(function(o){return!(o instanceof sap.m.Label);});var i=this.getElementForLabel();if(e.length>i&&(e[i]instanceof b)){return e[i];}return null;};G.prototype._extractFields=function(e,c){var f=[];if(c===undefined){c=false;}e.forEach(function(o){if(o.getItems){f=f.concat(o.getItems());}else{f.push(o);}});if(f.some(function(o){return o.getItems;})){f=this._extractFields(f);}if(c){f=f.filter(function(o){return!(o instanceof sap.m.Label);});}return f;};G.prototype._createLabel=function(s){var o=null;var i=null;var c=new B();var f=this._getFieldRelevantForLabel();if(f){if(f.getShowLabel&&f.getShowLabel()){if(s){f.setTextLabel(s);}o=new a(f.getId()+'-label');if(s){o.setText(s);}o.setLabelFor(f);}}else{i=this.getBindingInfo("label");if(s){o=new L();o.setText(s);}else if(i){o=new L();o.bindProperty("text",c.toBinding(i));}}return o;};G.prototype.updateLabelOfFormElement=function(i,s){var t=null,c=false,r=null;if(this.getElements().length===0){this.setLabel("");}r=this._getFieldRelevantForLabel();var o=this._getLabel();if(o&&o._sSmartFieldId&&r&&o._sSmartFieldId!=r.getId()){o.destroy();o=null;}if(o){if(r&&(!(o instanceof a))){o=this._createLabel(o.getText());c=true;}}else{o=this._createLabel();c=true;}if(o){if(s&&i&&(o instanceof a)){if(s===r){o.updateLabelFor(i);}else{}}var d=this._getFieldRelevantForLabel();if(o instanceof a){if(d&&d.setTextLabel){if(d.getTextLabel()){o.setText(d.getTextLabel());}}}t=this.getTooltip();if(t){if(o instanceof a){if(d&&d.setTooltipLabel){d.setTooltipLabel(t.getText());}}}else if(!(o instanceof a)){o.setTooltip(t);}}if(c){this.setLabel(o);if(o&&o.setLabelFor&&!(o instanceof a)&&!r&&(this.getElements().length>0)){o.setLabelFor(this.getElements()[0]);}}};G.prototype.setLabel=function(o){var O,c=o,s="";var i;if(typeof o==="string"){O=this._getLabel();if(O&&O.getText){s=O.getText();if(s===o){return this;}}if(O&&O instanceof a&&(o.length>0||s.length>0)){O.setText(o);c=O;var d=this._getFieldRelevantForLabel();if(d&&d.getTextLabel&&o!=null){d.setTextLabel(o);}}else{c=new L({text:o});}}if(this.getUseHorizontalLayout()){if(this.getFields()[0]instanceof V){i=this.getFields()[0].getItems();i.some(function(I){if(I instanceof L){O=I;return true;}});if(O){O=c;}else{this.getFields()[0].insertItem(c,0);}return this;}}F.prototype.setLabel.apply(this,[c]);};G.prototype.setTooltip=function(t){var o=t;if(typeof t==="string"){o=new T({text:t});}F.prototype.setTooltip.apply(this,[o]);};G.prototype._getLabel=function(){var e=null,i=null,r=false;var o=F.prototype.getLabel.apply(this);if(!o){e=this.getElements();if(e&&e.length>0&&e[0]instanceof V){i=e[0].getItems();i.some(function(I){r=false;if(I instanceof L){o=I;r=true;}return r;});}}return o;};G.prototype.getLabelText=function(){var s="";var o=this._getLabel();if(o){s=o.getText();}return s;};G.prototype.setEditMode=function(e){var c=this.getElements();var i=[];var t=this;c.forEach(function(o){if(o instanceof V){i=t._extractFields([o]);i.forEach(function(I){if(I instanceof b){if(!(I.data("editable")===false)){I.setContextEditable(e);}}});}else if(o instanceof b){if(!(o.data("editable")===false)){o.setContextEditable(e);}}});return this;};G.prototype._getVisibilityOfFields=function(f,I){var r=false;var i=0,c=0,o=null;if(f&&f.length){c=f.length;for(i=0;i<c;i++){o=f[i];if(o){if(I&&o instanceof a){continue;}if(o instanceof V){r=this._getVisibilityOfFields(this._extractFields([o]),true);}else{r=o.getVisible();}}if(r){break;}}}return r;};G.prototype._updateFormElementVisibility=function(){var A=this.getVisible();var v=false,f=null;if(A===false&&this._visibilityDerived===false){return;}f=this.getFields();if(f&&f.length){v=this._getVisibilityOfFields(f);}if(A!==v){this._visibilityDerived=true;F.prototype.setProperty.apply(this,['visible',v]);this.fireVisibleChanged({visible:v});if(this.getParent()){this.getParent()._updateLineBreaks();}}};G.prototype._updateFormElementEditable=function(e){var o=this._getLabel();if(o&&o instanceof a){o.bindRequiredPropertyToSmartField();}};G.prototype._updateLayout=function(){var t=this;var v=null;var h=null;var f=[];var e=[];var o=null;if(this.getUseHorizontalLayout()){e=this.getFields();f=this._extractFields(e,true);}else{f=this.getFields();}var c=this._getLabel();if(this.getUseHorizontalLayout()){if(this.getFields().length>0&&this.getFields()[0].getLayoutData()){o=this.getFields()[0].getLayoutData().clone();}this.removeAllFields();if(f.length>0){if(f.length>1){f.forEach(function(d,i){var g;if(i>0){g=d.getLayoutData();if(g){if(g.getStyleClass&&!g.getStyleClass()){g.setStyleClass("sapUiCompGroupElementHBoxPadding");}}else{d.setLayoutData(new sap.m.FlexItemData({styleClass:"sapUiCompGroupElementHBoxPadding"}));}}});h=new H({"items":[].concat(f)});}if(h){v=new V({"items":[].concat(h)});}else{v=new V({"items":[].concat(f)});}v.addStyleClass("sapUiCompGroupElementVBox");if(o){v.setLayoutData(o);}this.addField(v);}if(c){F.prototype.setLabel.apply(this,[new sap.m.Label()]);F.prototype.destroyLabel.apply(this);if(v){v.insertItem(c,0);}}}else{this.removeAllFields();f.forEach(function(d){t.addField(d);});}};G.prototype.setProperty=function(p,v){F.prototype.setProperty.apply(this,[p,v]);if(p==='visible'){this._visibilityDerived=false;this._updateFormElementVisibility();}};G.prototype.setVisible=function(v){this._visibilityDerived=false;F.prototype.setProperty.apply(this,['visible',v]);this._updateFormElementVisibility();};G.prototype.setUseHorizontalLayout=function(v){this.setProperty("useHorizontalLayout",v);this._updateLayout();};G.prototype.setHorizontalLayoutGroupElementMinWidth=function(n){this.setProperty("horizontalLayoutGroupElementMinWidth",n);this._updateLayout();};G.prototype.getFormElement=function(){return this;};G.prototype.addElement=function(e){var t=this;if(e.getEditable){if(!e.getEditable()){e.data("editable",false);}}if(e.attachVisibleChanged){e.attachVisibleChanged(function(o){t._updateFormElementVisibility();});}if(e.attachContextEditableChanged){e.attachContextEditableChanged(function(o){t._updateFormElementEditable(o);});}if(e.attachEditableChanged){e.attachEditableChanged(function(o){t._updateFormElementEditable(o);});}if(e.attachInnerControlsCreated){e.attachInnerControlsCreated(function(o){t._updateFormElementLabel(o);});}if(e.setControlContext){e.setControlContext(sap.ui.comp.smartfield.ControlContextType.Form);}this.addField(e);this.updateLabelOfFormElement();this._updateLayout();};G.prototype._updateFormElementLabel=function(e){var f=this.getFields();if(f[0]instanceof V){f=f[0].getItems();if(f[0]instanceof L){f.splice(0,1);}}this.updateLabelOfFormElement(e.getParameters(),e.oSource);};G.prototype.addCustomData=function(c){F.prototype.addCustomData.apply(this,arguments);var e=this.getFields();e.forEach(function(o){if(o instanceof b){o.addCustomData(c.clone());}});return this;};G.prototype.insertElement=function(e,i){this.insertField(e,i);this.updateLabelOfFormElement();return this;};G.prototype.getElements=function(){return this.getFields();};G.prototype.removeElement=function(e){var r=this.removeField(e);this.updateLabelOfFormElement();return r;};G.prototype.removeAllElements=function(){return this.removeAllFields();};G.prototype.removeAggregation=function(A,o){if(A==="elements"){return this.removeField(o);}else{return E.prototype.removeAggregation.apply(this,arguments);}};G.prototype.removeAllAggregation=function(A){if(A==="elements"){return this.removeAllElements();}else{return E.prototype.removeAllAggregation.apply(this,arguments);}};G.prototype.getVisibleBasedOnElements=function(){var i=true;var e=this.getElements();if(e&&e.length>0){i=e.some(function(o){return o.getVisible();});}return i;};return G;},true);
