tinymce.PluginManager.add('media',function(a,u){var b=[{regex:/youtu\.be\/([\w\-.]+)/,type:'iframe',w:560,h:314,url:'//www.youtube.com/embed/$1',allowFullscreen:true},{regex:/youtube\.com(.+)v=([^&]+)/,type:'iframe',w:560,h:314,url:'//www.youtube.com/embed/$2',allowFullscreen:true},{regex:/youtube.com\/embed\/([a-z0-9\-_]+(?:\?.+)?)/i,type:'iframe',w:560,h:314,url:'//www.youtube.com/embed/$1',allowFullscreen:true},{regex:/vimeo\.com\/([0-9]+)/,type:'iframe',w:425,h:350,url:'//player.vimeo.com/video/$1?title=0&byline=0&portrait=0&color=8dc7dc',allowfullscreen:true},{regex:/vimeo\.com\/(.*)\/([0-9]+)/,type:"iframe",w:425,h:350,url:"//player.vimeo.com/video/$2?title=0&amp;byline=0",allowfullscreen:true},{regex:/maps\.google\.([a-z]{2,3})\/maps\/(.+)msid=(.+)/,type:'iframe',w:425,h:350,url:'//maps.google.com/maps/ms?msid=$2&output=embed"',allowFullscreen:false},{regex:/dailymotion\.com\/video\/([^_]+)/,type:'iframe',w:480,h:270,url:'//www.dailymotion.com/embed/video/$1',allowFullscreen:true}];var c=(tinymce.Env.ie&&tinymce.Env.ie<=8)?'onChange':'onInput';function g(u){u=u.toLowerCase();if(u.indexOf('.mp3')!=-1){return'audio/mpeg';}if(u.indexOf('.wav')!=-1){return'audio/wav';}if(u.indexOf('.mp4')!=-1){return'video/mp4';}if(u.indexOf('.webm')!=-1){return'video/webm';}if(u.indexOf('.ogg')!=-1){return'video/ogg';}if(u.indexOf('.swf')!=-1){return'application/x-shockwave-flash';}return'';}function d(e){var p=a.settings.media_scripts;if(p){for(var i=0;i<p.length;i++){if(e.indexOf(p[i].filter)!==-1){return p[i];}}}}function s(){var w,p,q,t;var v=[{name:'source1',type:'filepicker',filetype:'media',size:40,autofocus:true,label:'Source',onchange:function(e){tinymce.each(e.meta,function(i,y){w.find('#'+y).value(i);});}}];function x(e){var i,y,B,C;i=w.find('#width')[0];y=w.find('#height')[0];B=i.value();C=y.value();if(w.find('#constrain')[0].checked()&&p&&q&&B&&C){if(e.control==i){C=Math.round((B/p)*C);if(!isNaN(C)){y.value(C);}}else{B=Math.round((C/q)*B);if(!isNaN(B)){i.value(B);}}}p=B;q=C;}if(a.settings.media_alt_source!==false){v.push({name:'source2',type:'filepicker',filetype:'media',size:40,label:'Alternative source'});}if(a.settings.media_poster!==false){v.push({name:'poster',type:'filepicker',filetype:'image',size:40,label:'Poster'});}if(a.settings.media_dimensions!==false){v.push({type:'container',label:'Dimensions',layout:'flex',align:'center',spacing:5,items:[{name:'width',type:'textbox',maxLength:5,size:3,onchange:x,ariaLabel:'Width'},{type:'label',text:'x'},{name:'height',type:'textbox',maxLength:5,size:3,onchange:x,ariaLabel:'Height'},{name:'constrain',type:'checkbox',checked:true,text:'Constrain proportions'}]});}t=k(a.selection.getNode());p=t.width;q=t.height;var z={id:'mcemediasource',type:'textbox',flex:1,name:'embed',value:f(),multiline:true,label:'Source'};function A(){t=j(this.value());this.parent().parent().fromJSON(t);}z[c]=A;w=a.windowManager.open({title:'Insert/edit video',data:t,bodyType:'tabpanel',body:[{title:'General',type:"form",onShowTab:function(){t=j(this.next().find('#embed').value());this.fromJSON(t);},items:v},{title:'Embed',type:"container",layout:'flex',direction:'column',align:'stretch',padding:10,spacing:10,onShowTab:function(){this.find('#embed').value(h(this.parent().toJSON()));},items:[{type:'label',text:'Paste your embed code below:',forId:'mcemediasource'},z]}],onSubmit:function(){var e,B,i,y;e=a.dom.select('img[data-mce-object]');a.insertContent(h(this.toJSON()));B=a.dom.select('img[data-mce-object]');for(i=0;i<e.length;i++){for(y=B.length-1;y>=0;y--){if(e[i]==B[y]){B.splice(y,1);}}}a.selection.select(B[0]);a.nodeChanged();}});}function f(){var e=a.selection.getNode();if(e.getAttribute('data-mce-object')){return a.selection.getContent();}}function h(e){var p='';if(!e.source1){tinymce.extend(e,j(e.embed));if(!e.source1){return'';}}if(!e.source2){e.source2='';}if(!e.poster){e.poster='';}e.source1=a.convertURL(e.source1,"source");e.source2=a.convertURL(e.source2,"source");e.source1mime=g(e.source1);e.source2mime=g(e.source2);e.poster=a.convertURL(e.poster,"poster");e.flashPlayerUrl=a.convertURL(u+'/moxieplayer.swf',"movie");tinymce.each(b,function(t){var w,i,u;if((w=t.regex.exec(e.source1))){u=t.url;for(i=0;w[i];i++){u=u.replace('$'+i,function(){return w[i];});}e.source1=u;e.type=t.type;e.allowFullscreen=t.allowFullscreen;e.width=e.width||t.w;e.height=e.height||t.h;}});if(e.embed){p=m(e.embed,e,true);}else{var v=d(e.source1);if(v){e.type='script';e.width=v.width;e.height=v.height;}e.width=e.width||300;e.height=e.height||150;tinymce.each(e,function(i,t){e[t]=a.dom.encode(i);});if(e.type=="iframe"){var q=e.allowFullscreen?' allowFullscreen="1"':'';p+='<iframe src="'+e.source1+'" width="'+e.width+'" height="'+e.height+'"'+q+'></iframe>';}else if(e.source1mime=="application/x-shockwave-flash"){p+='<object data="'+e.source1+'" width="'+e.width+'" height="'+e.height+'" type="application/x-shockwave-flash">';if(e.poster){p+='<img src="'+e.poster+'" width="'+e.width+'" height="'+e.height+'" />';}p+='</object>';}else if(e.source1mime.indexOf('audio')!=-1){if(a.settings.audio_template_callback){p=a.settings.audio_template_callback(e);}else{p+=('<audio controls="controls" src="'+e.source1+'">'+(e.source2?'\n<source src="'+e.source2+'"'+(e.source2mime?' type="'+e.source2mime+'"':'')+' />\n':'')+'</audio>');}}else if(e.type=="script"){p+='<script src="'+e.source1+'"></script>';}else{if(a.settings.video_template_callback){p=a.settings.video_template_callback(e);}else{p=('<video width="'+e.width+'" height="'+e.height+'"'+(e.poster?' poster="'+e.poster+'"':'')+' controls="controls">\n'+'<source src="'+e.source1+'"'+(e.source1mime?' type="'+e.source1mime+'"':'')+' />\n'+(e.source2?'<source src="'+e.source2+'"'+(e.source2mime?' type="'+e.source2mime+'"':'')+' />\n':'')+'</video>');}}}return p;}function j(e){var i={};new tinymce.html.SaxParser({validate:false,allow_conditional_comments:true,special:'script,noscript',start:function(p,q){if(!i.source1&&p=="param"){i.source1=q.map.movie;}if(p=="iframe"||p=="object"||p=="embed"||p=="video"||p=="audio"){if(!i.type){i.type=p;}i=tinymce.extend(q.map,i);}if(p=="script"){var v=d(q.map.src);if(!v){return;}i={type:"script",source1:q.map.src,width:v.width,height:v.height};}if(p=="source"){if(!i.source1){i.source1=q.map.src;}else if(!i.source2){i.source2=q.map.src;}}if(p=="img"&&!i.poster){i.poster=q.map.src;}}}).parse(e);i.source1=i.source1||i.src||i.data;i.source2=i.source2||'';i.poster=i.poster||'';return i;}function k(e){if(e.getAttribute('data-mce-object')){return j(a.serializer.serialize(e,{selection:true}));}return{};}function l(e){if(a.settings.media_filter_html===false){return e;}var w=new tinymce.html.Writer(),p;new tinymce.html.SaxParser({validate:false,allow_conditional_comments:false,special:'script,noscript',comment:function(t){w.comment(t);},cdata:function(t){w.cdata(t);},text:function(t,i){w.text(t,i);},start:function(q,t,v){p=true;if(q=='script'||q=='noscript'){return;}for(var i=0;i<t.length;i++){if(t[i].name.indexOf('on')===0){return;}if(t[i].name=='style'){t[i].value=a.dom.serializeStyle(a.dom.parseStyle(t[i].value),q);}}w.start(q,t,v);p=false;},end:function(i){if(p){return;}w.end(i);}},new tinymce.html.Schema({})).parse(e);return w.getContent();}function m(e,p,q){var w=new tinymce.html.Writer();var t=0,v;function x(y,z){var A,i,B,C;for(A in z){B=""+z[A];if(y.map[A]){i=y.length;while(i--){C=y[i];if(C.name==A){if(B){y.map[A]=B;C.value=B;}else{delete y.map[A];y.splice(i,1);}}}}else if(B){y.push({name:A,value:B});y.map[A]=B;}}}new tinymce.html.SaxParser({validate:false,allow_conditional_comments:true,special:'script,noscript',comment:function(i){w.comment(i);},cdata:function(i){w.cdata(i);},text:function(i,y){w.text(i,y);},start:function(i,y,z){switch(i){case"video":case"object":case"embed":case"img":case"iframe":x(y,{width:p.width,height:p.height});break;}if(q){switch(i){case"video":x(y,{poster:p.poster,src:""});if(p.source2){x(y,{src:""});}break;case"iframe":x(y,{src:p.source1});break;case"source":t++;if(t<=2){x(y,{src:p["source"+t],type:p["source"+t+"mime"]});if(!p["source"+t]){return;}}break;case"img":if(!p.poster){return;}v=true;break;}}w.start(i,y,z);},end:function(i){if(i=="video"&&q){for(var y=1;y<=2;y++){if(p["source"+y]){var z=[];z.map={};if(t<y){x(z,{src:p["source"+y],type:p["source"+y+"mime"]});w.start("source",z,true);}}}}if(p.poster&&i=="object"&&q&&!v){var A=[];A.map={};x(A,{src:p.poster,width:p.width,height:p.height});w.start("img",A,true);}w.end(i);}},new tinymce.html.Schema({})).parse(e);return w.getContent();}a.on('ResolveName',function(e){var i;if(e.target.nodeType==1&&(i=e.target.getAttribute("data-mce-object"))){e.name=i;}});function r(e,t){var i,p,q,v,w;q=e.attributes;v=q.length;while(v--){i=q[v].name;p=q[v].value;if(i!=="width"&&i!=="height"&&i!=="style"){if(i=="data"||i=="src"){p=a.convertURL(p,i);}t.attr('data-mce-p-'+i,p);}}w=e.firstChild&&e.firstChild.value;if(w){t.attr("data-mce-html",escape(w));t.firstChild=null;}}function n(e){var p,i=e.name;p=new tinymce.html.Node('img',1);p.shortEnded=true;r(e,p);p.attr({width:e.attr('width')||"300",height:e.attr('height')||(i=="audio"?"30":"150"),style:e.attr('style'),src:tinymce.Env.transparentSrc,"data-mce-object":i,"class":"mce-object mce-object-"+i});return p;}function o(e){var p,i,q,t=e.name;p=new tinymce.html.Node('span',1);p.attr({contentEditable:'false',style:e.attr('style'),"data-mce-object":t,"class":"mce-preview-object mce-object-"+t});r(e,p);i=new tinymce.html.Node(t,1);i.attr({src:e.attr('src'),allowfullscreen:e.attr('allowfullscreen'),width:e.attr('width')||"300",height:e.attr('height')||(t=="audio"?"30":"150"),frameborder:'0'});q=new tinymce.html.Node('span',1);q.attr('class','mce-shim');p.append(i);p.append(q);return p;}a.on('preInit',function(){var e=a.schema.getSpecialElements();tinymce.each('video audio iframe object'.split(' '),function(i){e[i]=new RegExp('<\/'+i+'[^>]*>','gi');});var p=a.schema.getBoolAttrs();tinymce.each('webkitallowfullscreen mozallowfullscreen allowfullscreen'.split(' '),function(i){p[i]={};});a.parser.addNodeFilter('iframe,video,audio,object,embed,script',function(q){var i=q.length,t,v,w;while(i--){t=q[i];if(!t.parent){continue;}if(t.parent.attr('data-mce-object')){continue;}if(t.name=='script'){w=d(t.attr('src'));if(!w){continue;}}if(w){if(w.width){t.attr('width',w.width.toString());}if(w.height){t.attr('height',w.height.toString());}}if(t.name=='iframe'&&a.settings.media_live_embeds!==false&&tinymce.Env.ceFalse){v=o(t);}else{v=n(t);}t.replace(v);}});a.serializer.addAttributeFilter('data-mce-object',function(q,t){var i=q.length,v,w,x,y,z,A,B,C;while(i--){v=q[i];if(!v.parent){continue;}B=v.attr(t);w=new tinymce.html.Node(B,1);if(B!="audio"&&B!="script"){C=v.attr('class');if(C&&C.indexOf('mce-preview-object')!==-1){w.attr({width:v.firstChild.attr('width'),height:v.firstChild.attr('height')});}else{w.attr({width:v.attr('width'),height:v.attr('height')});}}w.attr({style:v.attr('style')});y=v.attributes;x=y.length;while(x--){var D=y[x].name;if(D.indexOf('data-mce-p-')===0){w.attr(D.substr(11),y[x].value);}}if(B=="script"){w.attr('type','text/javascript');}z=v.attr('data-mce-html');if(z){A=new tinymce.html.Node('#text',3);A.raw=true;A.value=l(unescape(z));w.append(A);}v.replace(w);}});});a.on('click keyup',function(){var e=a.selection.getNode();if(e&&a.dom.hasClass(e,'mce-preview-object')){if(a.dom.getAttrib(e,'data-mce-selected')){e.setAttribute('data-mce-selected','2');}}});a.on('ObjectSelected',function(e){var i=e.target.getAttribute('data-mce-object');if(i=="audio"||i=="script"){e.preventDefault();}});a.on('objectResized',function(e){var t=e.target,i;if(t.getAttribute('data-mce-object')){i=t.getAttribute('data-mce-html');if(i){i=unescape(i);t.setAttribute('data-mce-html',escape(m(i,{width:e.width,height:e.height})));}}});a.addButton('media',{tooltip:'Insert/edit video',onclick:s,stateSelector:['img[data-mce-object]','span[data-mce-object]']});a.addMenuItem('media',{icon:'media',text:'Insert/edit video',onclick:s,context:'insert',prependToContext:true});a.on('setContent',function(){a.$('span.mce-preview-object').each(function(i,e){var $=a.$(e);if($.find('span.mce-shim',e).length===0){$.append('<span class="mce-shim"></span>');}});});a.addCommand('mceMedia',s);this.showDialog=s;});
