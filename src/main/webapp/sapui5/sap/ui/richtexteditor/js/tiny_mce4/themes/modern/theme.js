tinymce.ThemeManager.add('modern',function(a){var s=this,b=a.settings,F=tinymce.ui.Factory,c=tinymce.each,D=tinymce.DOM,R=tinymce.geom.Rect,d=tinymce.ui.FloatPanel;var f={file:{title:'File',items:'newdocument'},edit:{title:'Edit',items:'undo redo | cut copy paste pastetext | selectall'},insert:{title:'Insert',items:'|'},view:{title:'View',items:'visualaid |'},format:{title:'Format',items:'bold italic underline strikethrough superscript subscript | formats | removeformat'},table:{title:'Table'},tools:{title:'Tools'}};var g="undo redo | styleselect | bold italic | alignleft aligncenter alignright alignjustify | "+"bullist numlist outdent indent | link image";function h(e,t){var u=[],v;if(!e){return;}c(e.split(/[ ,]/),function(w){var x;function y(){var z=a.selection;function A(B){return function(C,E){var G,i=E.parents.length;while(i--){G=E.parents[i].nodeName;if(G=="OL"||G=="UL"){break;}}w.active(C&&G==B);};}if(x=="bullist"){z.selectorChanged('ul > li',A("UL"));}if(x=="numlist"){z.selectorChanged('ol > li',A("OL"));}if(w.settings.stateSelector){z.selectorChanged(w.settings.stateSelector,function(i){w.active(i);},true);}if(w.settings.disabledStateSelector){z.selectorChanged(w.settings.disabledStateSelector,function(i){w.disabled(i);});}}if(w=="|"){v=null;}else{if(F.has(w)){w={type:w,size:t};u.push(w);v=null;}else{if(!v){v={type:'buttongroup',items:[]};u.push(v);}if(a.buttons[w]){x=w;w=a.buttons[x];if(typeof w=="function"){w=w();}w.type=w.type||'button';w.size=t;w=F.create(w);v.items.push(w);if(a.initialized){y();}else{a.on('init',y);}}}}});return{type:'toolbar',layout:'flow',items:u};}function j(e){var t=[];function u(v){if(v){t.push(h(v,e));return true;}}if(tinymce.isArray(b.toolbar)){if(b.toolbar.length===0){return;}tinymce.each(b.toolbar,function(v,i){b["toolbar"+(i+1)]=v;});delete b.toolbar;}for(var i=1;i<10;i++){if(!u(b["toolbar"+i])){break;}}if(!t.length&&b.toolbar!==false){u(b.toolbar||g);}if(t.length){return{type:'panel',layout:'stack',classes:"toolbar-grp",ariaRoot:true,ariaRemember:true,items:t};}}function k(){var e,t=[];function u(e){var z;if(e=='|'){return{text:'|'};}z=a.menuItems[e];return z;}function v(z){var A,y,B,C,E;E=tinymce.makeMap((b.removed_menuitems||'').split(/[ ,]/));if(b.menu){y=b.menu[z];C=true;}else{y=f[z];}if(y){A={text:y.title};B=[];c((y.items||'').split(/[ ,]/),function(G){var H=u(G);if(H&&!E[G]){B.push(u(G));}});if(!C){c(a.menuItems,function(G){if(G.context==z){if(G.separator=='before'){B.push({text:'|'});}if(G.prependToContext){B.unshift(G);}else{B.push(G);}if(G.separator=='after'){B.push({text:'|'});}}});}for(var i=0;i<B.length;i++){if(B[i].text=='|'){if(i===0||i==B.length-1){B.splice(i,1);}}}A.menu=B;if(!A.menu.length){return null;}}return A;}var w=[];if(b.menu){for(e in b.menu){w.push(e);}}else{for(e in f){w.push(e);}}var x=typeof b.menubar=="string"?b.menubar.split(/[ ,]/):w;for(var i=0;i<x.length;i++){var y=x[i];y=v(y);if(y){t.push(y);}}return t;}function l(e){function i(t){var u=e.find(t)[0];if(u){u.focus(true);}}a.shortcuts.add('Alt+F9','',function(){i('menubar');});a.shortcuts.add('Alt+F10','',function(){i('toolbar');});a.shortcuts.add('Alt+F11','',function(){i('elementpath');});e.on('cancel',function(){a.focus();});}function r(w,e){var i,t,u,v;function x(y){return{width:y.clientWidth,height:y.clientHeight};}i=a.getContainer();t=a.getContentAreaContainer().firstChild;u=x(i);v=x(t);if(w!==null){w=Math.max(b.min_width||100,w);w=Math.min(b.max_width||0xFFFF,w);D.setStyle(i,'width',w+(u.width-v.width));D.setStyle(t,'width',w);}e=Math.max(b.min_height||100,e);e=Math.min(b.max_height||0xFFFF,e);D.setStyle(t,'height',e);a.fire('ResizeEditor');}function m(e,i){var t=a.getContentAreaContainer();s.resizeTo(t.clientWidth+e,t.clientHeight+i);}function n(){var t;function u(){return a.contextToolbars||[];}function v(e){var i,x,y;i=tinymce.DOM.getPos(a.getContentAreaContainer());x=a.dom.getRect(e);y=a.dom.getRoot();if(y.nodeName=='BODY'){x.x-=y.ownerDocument.documentElement.scrollLeft||y.scrollLeft;x.y-=y.ownerDocument.documentElement.scrollTop||y.scrollTop;}x.x+=i.x;x.y+=i.y;return x;}function w(){c(a.contextToolbars,function(e){if(e.panel){e.panel.hide();}});}function z(e,i,x){i=i?i.substr(0,2):'';c({t:'down',b:'up'},function(y,L){e.classes.toggle('arrow-'+y,x(L,i.substr(0,1)));});c({l:'left',r:'right'},function(y,L){e.classes.toggle('arrow-'+y,x(L,i.substr(1,1)));});}function A(e){return{left:e.x,top:e.y,width:e.w,height:e.h,right:e.x+e.w,bottom:e.y+e.h};}function B(x,y,e,i,L){L=A({x:x,y:y,w:L.w,h:L.h});if(b.inline_toolbar_position_handler){L=b.inline_toolbar_position_handler({elementRect:A(e),contentAreaRect:A(i),panelRect:L});}return L;}function C(e,i){e.moveTo(i.left,i.top);}function E(e){var i,x,y,L,M,N,O,P;if(a.removed){return;}if(!e||!e.toolbar.panel){w();return;}O=['bc-tc','tc-bc','tl-bl','bl-tl','tr-br','br-tr'];M=e.toolbar.panel;M.show();y=v(e.element);x=tinymce.DOM.getRect(M.getEl());L=tinymce.DOM.getRect(a.getContentAreaContainer()||a.getBody());P=25;y.w=e.element.clientWidth;y.h=e.element.clientHeight;if(!a.inline){L.w=a.getDoc().documentElement.offsetWidth;}if(a.selection.controlSelection.isResizable(e.element)&&y.w<P){y=R.inflate(y,0,8);}i=R.findBestRelativePosition(x,y,L,O);y=R.clamp(y,L);if(i){N=R.relativePosition(x,y,i);C(M,B(N.x,N.y,y,L,x));}else{L.h+=x.h;y=R.intersect(L,y);if(y){i=R.findBestRelativePosition(x,y,L,['bc-tc','bl-tl','br-tr']);if(i){N=R.relativePosition(x,y,i);C(M,B(N.x,N.y,y,L,x));}else{C(M,B(y.x,y.y,y,L,x));}}else{M.hide();}}z(M,i,function(Q,S){return Q===S;});}function G(){function e(){if(a.selection){E(K(a.selection.getNode()));}}tinymce.util.Delay.requestAnimationFrame(e);}function H(){if(!t){t=a.selection.getScrollContainer()||a.getWin();tinymce.$(t).on('scroll',G);a.on('remove',function(){tinymce.$(t).off('scroll');});}}function I(e){var i;if(e.toolbar.panel){e.toolbar.panel.show();E(e);return;}H();i=F.create({type:'floatpanel',role:'dialog',classes:'tinymce tinymce-inline arrow',ariaLabel:'Inline toolbar',layout:'flex',direction:'column',align:'stretch',autohide:false,autofix:true,fixed:true,border:1,items:h(e.toolbar.items),oncancel:function(){a.focus();}});e.toolbar.panel=i;i.renderTo(document.body).reflow();E(e);}function J(){tinymce.each(u(),function(e){if(e.panel){e.panel.hide();}});}function K(e){var i,y,x,L=u();x=a.$(e).parents().add(e);for(i=x.length-1;i>=0;i--){for(y=L.length-1;y>=0;y--){if(L[y].predicate(x[i])){return{toolbar:L[y],element:x[i]};}}}return null;}a.on('click keyup setContent',function(e){if(e.type=='setcontent'&&!e.selection){return;}tinymce.util.Delay.setEditorTimeout(a,function(){var i;i=K(a.selection.getNode());if(i){J();I(i);}else{J();}});});a.on('blur hide',J);a.on('ObjectResizeStart',function(){var e=K(a.selection.getNode());if(e&&e.toolbar.panel){e.toolbar.panel.hide();}});a.on('nodeChange ResizeEditor ResizeWindow',G);a.on('remove',function(){tinymce.each(u(),function(e){if(e.panel){e.panel.remove();}});a.contextToolbars={};});a.shortcuts.add('ctrl+shift+e > ctrl+shift+p','',function(){var e=K(a.selection.getNode());if(e&&e.toolbar.panel){e.toolbar.panel.items()[0].focus();}});}function o(a){return function(){if(a.initialized){a.fire('SkinLoaded');}else{a.on('init',function(){a.fire('SkinLoaded');});}};}function p(e){var i,t;if(b.fixed_toolbar_container){t=D.select(b.fixed_toolbar_container)[0];}function u(){if(i&&i.moveRel&&i.visible()&&!i._fixed){var y=a.selection.getScrollContainer(),z=a.getBody();var A=0,B=0;if(y){var C=D.getPos(z),E=D.getPos(y);A=Math.max(0,E.x-C.x);B=Math.max(0,E.y-C.y);}i.fixed(false).moveRel(z,a.rtl?['tr-br','br-tr']:['tl-bl','bl-tl','tr-br']).moveBy(A,B);}}function v(){if(i){i.show();u();D.addClass(a.getBody(),'mce-edit-focus');}}function w(){if(i){i.hide();d.hideAll();D.removeClass(a.getBody(),'mce-edit-focus');}}function x(){if(i){if(!i.visible()){v();}return;}i=s.panel=F.create({type:t?'panel':'floatpanel',role:'application',classes:'tinymce tinymce-inline',layout:'flex',direction:'column',align:'stretch',autohide:false,autofix:true,fixed:!!t,border:1,items:[b.menubar===false?null:{type:'menubar',border:'0 0 1 0',items:k()},j(b.toolbar_items_size)]});a.fire('BeforeRenderUI');i.renderTo(t||document.body).reflow();l(i);v();n();a.on('nodeChange',u);a.on('activate',v);a.on('deactivate',w);a.nodeChanged();}b.content_editable=true;a.on('focus',function(){if(e.skinUiCss){tinymce.DOM.styleSheetLoader.load(e.skinUiCss,x,x);}else{x();}});a.on('blur hide',w);a.on('remove',function(){if(i){i.remove();i=null;}});if(e.skinUiCss){tinymce.DOM.styleSheetLoader.load(e.skinUiCss,o(a));}return{};}function q(i){var t,u,v;function w(){return function(e){if(e.mode=='readonly'){t.find('*').disabled(true);}else{t.find('*').disabled(false);}};}if(i.skinUiCss){tinymce.DOM.styleSheetLoader.load(i.skinUiCss,o(a));}t=s.panel=F.create({type:'panel',role:'application',classes:'tinymce',style:'visibility: hidden',layout:'stack',border:1,items:[b.menubar===false?null:{type:'menubar',border:'0 0 1 0',items:k()},j(b.toolbar_items_size),{type:'panel',name:'iframe',layout:'stack',classes:'edit-area',html:'',border:'1 0 0 0'}]});if(b.resize!==false){u={type:'resizehandle',direction:b.resize,onResizeStart:function(){var e=a.getContentAreaContainer().firstChild;v={width:e.clientWidth,height:e.clientHeight};},onResize:function(e){if(b.resize=='both'){r(v.width+e.deltaX,v.height+e.deltaY);}else{r(null,v.height+e.deltaY);}}};}if(b.statusbar!==false){t.add({type:'panel',name:'statusbar',classes:'statusbar',layout:'flow',border:'1 0 0 0',ariaRoot:true,items:[{type:'elementpath',editor:a},u]});}a.fire('BeforeRenderUI');a.on('SwitchMode',w());t.renderBefore(i.targetNode).reflow();if(b.readonly){a.setMode('readonly');}if(b.width){tinymce.DOM.setStyle(t.getEl(),'width',b.width);}a.on('remove',function(){t.remove();t=null;});l(t);n();return{iframeContainer:t.find('#iframe')[0].getEl(),editorContainer:t.getEl()};}s.renderUI=function(i){var t=b.skin!==false?b.skin||'lightgray':false;if(t){var u=b.skin_url;if(u){u=a.documentBaseURI.toAbsolute(u);}else{u=tinymce.baseURL+'/skins/'+t;}if(tinymce.Env.documentMode<=7){i.skinUiCss=u+'/skin.ie7.min.css';}else{i.skinUiCss=u+'/skin.min.css';}a.contentCSS.push(u+'/content'+(a.inline?'.inline':'')+'.min.css');}a.on('ProgressState',function(e){s.throbber=s.throbber||new tinymce.ui.Throbber(s.panel.getEl('body'));if(e.state){s.throbber.show(e.time);}else{s.throbber.hide();}});if(b.inline){return p(i);}return q(i);};s.resizeTo=r;s.resizeBy=m;});
