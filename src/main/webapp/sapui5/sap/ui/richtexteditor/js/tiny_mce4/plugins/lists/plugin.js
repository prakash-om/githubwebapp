tinymce.PluginManager.add('lists',function(a){var s=this;function b(e){return a.$.contains(a.getBody(),e);}function c(e){return e&&e.nodeName=='BR';}function d(e){return e&&(/^(OL|UL|DL)$/).test(e.nodeName)&&b(e);}function f(e){return e&&/^(LI|DT|DD)$/.test(e.nodeName);}function g(e){return e.parentNode.firstChild==e;}function h(e){return e.parentNode.lastChild==e;}function j(e){return e&&!!a.schema.getTextBlockElements()[e.nodeName];}function k(e){return e===a.getBody();}function m(e){return e&&e.nodeType===3;}function n(e,i){var l=tinymce.dom.RangeUtils.getNode(e,i);if(f(e)&&m(l)){var t=i>=e.childNodes.length?l.data.length:0;return{container:l,offset:t};}return{container:e,offset:i};}function o(r){var e=r.cloneRange();var i=n(r.startContainer,r.startOffset);e.setStart(i.container,i.offset);var l=n(r.endContainer,r.endOffset);e.setEnd(l.container,l.offset);return e;}a.on('init',function(){var l=a.dom,p=a.selection;function q(e,i){var y=l.isEmpty(e);if(i&&l.select('span[data-mce-type=bookmark]').length>0){return false;}return y;}function r(e){var i={};function y(Q){var R,S,T;S=e[Q?'startContainer':'endContainer'];T=e[Q?'startOffset':'endOffset'];if(S.nodeType==1){R=l.create('span',{'data-mce-type':'bookmark'});if(S.hasChildNodes()){T=Math.min(T,S.childNodes.length-1);if(Q){S.insertBefore(R,S.childNodes[T]);}else{l.insertAfter(R,S.childNodes[T]);}}else{S.appendChild(R);}S=R;T=0;}i[Q?'startContainer':'endContainer']=S;i[Q?'startOffset':'endOffset']=T;}y(true);if(!e.collapsed){y();}return i;}function t(e){function i(Q){var R,S,T;function U(R){var T=R.parentNode.firstChild,V=0;while(T){if(T==R){return V;}if(T.nodeType!=1||T.getAttribute('data-mce-type')!='bookmark'){V++;}T=T.nextSibling;}return-1;}R=T=e[Q?'startContainer':'endContainer'];S=e[Q?'startOffset':'endOffset'];if(!R){return;}if(R.nodeType==1){S=U(R);R=R.parentNode;l.remove(T);}e[Q?'startContainer':'endContainer']=R;e[Q?'startOffset':'endOffset']=S;}i(true);i();var y=l.createRng();y.setStart(e.startContainer,e.startOffset);if(e.endContainer){y.setEnd(e.endContainer,e.endOffset);}p.setRng(o(y));}function u(e,i){var y,Q,R=l.createFragment(),S;var T=a.schema.getBlockElements();if(a.settings.forced_root_block){i=i||a.settings.forced_root_block;}if(i){Q=l.create(i);if(Q.tagName===a.settings.forced_root_block){l.setAttribs(Q,a.settings.forced_root_block_attrs);}R.appendChild(Q);}if(e){while((y=e.firstChild)){var U=y.nodeName;if(!S&&(U!='SPAN'||y.getAttribute('data-mce-type')!='bookmark')){S=true;}if(T[U]){R.appendChild(y);Q=null;}else{if(i){if(!Q){Q=l.create(i);R.appendChild(Q);}Q.appendChild(y);}else{R.appendChild(y);}}}}if(!a.settings.forced_root_block){R.appendChild(l.create('br'));}else{if(!S&&(!tinymce.Env.ie||tinymce.Env.ie>10)){Q.appendChild(l.create('br',{'data-mce-bogus':'1'}));}}return R;}function v(){return tinymce.grep(p.getSelectedBlocks(),function(e){return f(e);});}function w(e,i,y){var Q,R,S,T;function U(V){tinymce.each(S,function(T){V.parentNode.insertBefore(T,i.parentNode);});l.remove(V);}S=l.select('span[data-mce-type="bookmark"]',e);y=y||u(i);Q=l.createRng();Q.setStartAfter(i);Q.setEndAfter(e);R=Q.extractContents();for(T=R.firstChild;T;T=T.firstChild){if(T.nodeName=='LI'&&l.isEmpty(T)){l.remove(T);break;}}if(!l.isEmpty(R)){l.insertAfter(R,e);}l.insertAfter(y,e);if(q(i.parentNode)){U(i.parentNode);}l.remove(i);if(q(e)){l.remove(e);}}var x=function(e,i){var y=a.dom.getStyle(e,'list-style-type',true);var Q=a.dom.getStyle(i,'list-style-type',true);return y===Q;};function z(e){var i,y;i=e.nextSibling;if(i&&d(i)&&i.nodeName==e.nodeName&&x(e,i)){while((y=i.firstChild)){e.appendChild(y);}l.remove(i);}i=e.previousSibling;if(i&&d(i)&&i.nodeName==e.nodeName&&x(e,i)){while((y=i.firstChild)){e.insertBefore(y,e.firstChild);}l.remove(i);}}function A(e){tinymce.each(tinymce.grep(l.select('ol,ul',e)),B);}function B(e){var i,y=e.parentNode;if(y.nodeName=='LI'&&y.firstChild==e){i=y.previousSibling;if(i&&i.nodeName=='LI'){i.appendChild(e);if(q(y)){l.remove(y);}}else{l.setStyle(y,'listStyleType','none');}}if(d(y)){i=y.previousSibling;if(i&&i.nodeName=='LI'){i.appendChild(e);}}}function C(e){var i=e.parentNode,y=i.parentNode,Q;function R(e){if(q(e)){l.remove(e);}}if(k(i)){return true;}if(e.nodeName=='DD'){l.rename(e,'DT');return true;}if(g(e)&&h(e)){if(y.nodeName=="LI"){l.insertAfter(e,y);R(y);l.remove(i);}else if(d(y)){l.remove(i,true);}else{y.insertBefore(u(e),i);l.remove(i);}return true;}else if(g(e)){if(y.nodeName=="LI"){l.insertAfter(e,y);e.appendChild(i);R(y);}else if(d(y)){y.insertBefore(e,i);}else{y.insertBefore(u(e),i);l.remove(e);}return true;}else if(h(e)){if(y.nodeName=="LI"){l.insertAfter(e,y);}else if(d(y)){l.insertAfter(e,i);}else{l.insertAfter(u(e),i);l.remove(e);}return true;}if(y.nodeName=='LI'){i=y;Q=u(e,'LI');}else if(d(y)){Q=u(e,'LI');}else{Q=u(e);}w(i,e,Q);A(i.parentNode);return true;}function D(e){var i,y,Q;function R(S,T){var U;if(d(S)){while((U=e.lastChild.firstChild)){T.appendChild(U);}l.remove(S);}}if(e.nodeName=='DT'){l.rename(e,'DD');return true;}i=e.previousSibling;if(i&&d(i)){i.appendChild(e);return true;}if(i&&i.nodeName=='LI'&&d(i.lastChild)){i.lastChild.appendChild(e);R(e.lastChild,i.lastChild);return true;}i=e.nextSibling;if(i&&d(i)){i.insertBefore(e,i.firstChild);return true;}i=e.previousSibling;if(i&&i.nodeName=='LI'){y=l.create(e.parentNode.nodeName);Q=l.getStyle(e.parentNode,'listStyleType');if(Q){l.setStyle(y,'listStyleType',Q);}i.appendChild(y);y.appendChild(e);R(e.lastChild,y);return true;}return false;}function E(){var e=v();if(e.length){var y=r(p.getRng(true));for(var i=0;i<e.length;i++){if(!D(e[i])&&i===0){break;}}t(y);a.nodeChanged();return true;}}function F(){var e=v();if(e.length){var Q=r(p.getRng(true));var i,y,R=a.getBody();i=e.length;while(i--){var S=e[i].parentNode;while(S&&S!=R){y=e.length;while(y--){if(e[y]===S){e.splice(i,1);break;}}S=S.parentNode;}}for(i=0;i<e.length;i++){if(!C(e[i])&&i===0){break;}}t(Q);a.nodeChanged();return true;}}function G(e,i){var y=p.getRng(true),Q,R='LI';if(l.getContentEditable(p.getNode())==="false"){return;}e=e.toUpperCase();if(e=='DL'){R='DT';}function S(){var T=[],U=a.getBody();function V(_){var a1,b1;a1=y[_?'startContainer':'endContainer'];b1=y[_?'startOffset':'endOffset'];if(a1.nodeType==1){a1=a1.childNodes[Math.min(b1,a1.childNodes.length-1)]||a1;}while(a1.parentNode!=U){if(j(a1)){return a1;}if(/^(TD|TH)$/.test(a1.parentNode.nodeName)){return a1;}a1=a1.parentNode;}return a1;}var W=V(true);var X=V();var Y,Z=[];for(var $=W;$;$=$.nextSibling){Z.push($);if($==X){break;}}tinymce.each(Z,function($){if(j($)){T.push($);Y=null;return;}if(l.isBlock($)||c($)){if(c($)){l.remove($);}Y=null;return;}var _=$.nextSibling;if(tinymce.dom.BookmarkManager.isBookmarkNode($)){if(j(_)||(!_&&$.parentNode==U)){Y=null;return;}}if(!Y){Y=l.create('p');$.parentNode.insertBefore(Y,$);T.push(Y);}Y.appendChild($);});return T;}Q=r(y);tinymce.each(S(),function(T){var U,V;var W=function(X){var Y=l.getStyle(X,'list-style-type');var Z=i?i['list-style-type']:'';Z=Z===null?'':Z;return Y===Z;};V=T.previousSibling;if(V&&d(V)&&V.nodeName==e&&W(V)){U=V;T=l.rename(T,R);V.appendChild(T);}else{U=l.create(e);T.parentNode.insertBefore(U,T);U.appendChild(T);T=l.rename(T,R);}H(U,i);z(U);});t(Q);}var H=function(e,i){l.setStyle(e,'list-style-type',i?i['list-style-type']:null);};function I(){var e=r(p.getRng(true)),i=a.getBody();tinymce.each(v(),function(y){var Q,R;if(k(y.parentNode)){return;}if(q(y)){C(y);return;}for(Q=y;Q&&Q!=i;Q=Q.parentNode){if(d(Q)){R=Q;}}w(R,y);A(R.parentNode);});t(e);}function J(e,i){var y=l.getParent(p.getStart(),'OL,UL,DL');if(k(y)){return;}if(y){if(y.nodeName==e){I(e);}else{var Q=r(p.getRng(true));H(y,i);z(l.rename(y,e));t(Q);}}else{G(e,i);}}function K(e){return function(){var i=l.getParent(a.selection.getStart(),'UL,OL,DL');return i&&i.nodeName==e;};}function L(e){if(!c(e)){return false;}if(l.isBlock(e.nextSibling)&&!c(e.previousSibling)){return true;}return false;}function M(e,i){var y=e.startContainer,Q=e.startOffset;var R,S;if(y.nodeType==3&&(i?Q<y.data.length:Q>0)){return y;}R=a.schema.getNonEmptyElements();if(y.nodeType==1){y=tinymce.dom.RangeUtils.getNode(y,Q);}S=new tinymce.dom.TreeWalker(y,a.getBody());if(i){if(L(y)){S.next();}}while((y=S[i?'next':'prev2']())){if(y.nodeName=='LI'&&!y.hasChildNodes()){return y;}if(R[y.nodeName]){return y;}if(y.nodeType==3&&y.data.length>0){return y;}}}function N(e,i){var y,Q,R=e.parentNode;if(!b(e)||!b(i)){return;}if(d(i.lastChild)){Q=i.lastChild;}if(R==i.lastChild){if(c(R.previousSibling)){l.remove(R.previousSibling);}}y=i.lastChild;if(y&&c(y)&&e.hasChildNodes()){l.remove(y);}if(q(i,true)){l.$(i).empty();}if(!q(e,true)){while((y=e.firstChild)){i.appendChild(y);}}if(Q){i.appendChild(Q);}l.remove(e);if(q(R)&&!k(R)){l.remove(R);}}function O(i){var e=l.getParent(p.getStart(),'LI'),y,Q,R;if(e){y=e.parentNode;if(k(y)&&l.isEmpty(y)){return true;}Q=o(p.getRng(true));R=l.getParent(M(Q,i),'LI');if(R&&R!=e){var S=r(Q);if(i){N(R,e);}else{N(e,R);}t(S);return true;}else if(!R){if(!i&&I(y.nodeName)){return true;}}}}function P(){var e=a.dom.getParent(a.selection.getStart(),'LI,DT,DD');if(e||v().length>0){a.undoManager.transact(function(){a.execCommand('Delete');A(a.getBody());});return true;}return false;}s.backspaceDelete=function(i){return p.isCollapsed()?O(i):P();};a.on('BeforeExecCommand',function(e){var i=e.command.toLowerCase(),y;if(i=="indent"){if(E()){y=true;}}else if(i=="outdent"){if(F()){y=true;}}if(y){a.fire('ExecCommand',{command:e.command});e.preventDefault();return true;}});a.addCommand('InsertUnorderedList',function(e,i){J('UL',i);});a.addCommand('InsertOrderedList',function(e,i){J('OL',i);});a.addCommand('InsertDefinitionList',function(e,i){J('DL',i);});a.addQueryStateHandler('InsertUnorderedList',K('UL'));a.addQueryStateHandler('InsertOrderedList',K('OL'));a.addQueryStateHandler('InsertDefinitionList',K('DL'));a.on('keydown',function(e){if(e.keyCode!=9||tinymce.util.VK.metaKeyPressed(e)){return;}if(a.dom.getParent(a.selection.getStart(),'LI,DT,DD')){e.preventDefault();if(e.shiftKey){F();}else{E();}}});});a.addButton('indent',{icon:'indent',title:'Increase indent',cmd:'Indent',onPostRender:function(){var e=this;a.on('nodechange',function(){var p=a.selection.getSelectedBlocks();var q=false;for(var i=0,l=p.length;!q&&i<l;i++){var t=p[i].nodeName;q=(t=='LI'&&g(p[i])||t=='UL'||t=='OL'||t=='DD');}e.disabled(q);});}});a.on('keydown',function(e){if(e.keyCode==tinymce.util.VK.BACKSPACE){if(s.backspaceDelete()){e.preventDefault();}}else if(e.keyCode==tinymce.util.VK.DELETE){if(s.backspaceDelete(true)){e.preventDefault();}}});});
