/*!
 * UI development toolkit for HTML5 (OpenUI5)
 * (c) Copyright 2009-2016 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(['jquery.sap.global','./TableExtension','./TableUtils','sap/ui/Device','./library'],function(q,T,a,D,l){"use strict";var S=l.SharedDomRef;var E={onFixedAreaHorizontalScrolling:function(e){e.target.scrollLeft=0;},onHorizontalScrolling:function(e){var s=this._getScrollExtension();q.sap.interaction.notifyScrollEvent&&q.sap.interaction.notifyScrollEvent(e);if(this._bOnAfterRendering){return;}var t=this.getId();var h=t+"-"+S.HorizontalScrollBar;var H=t+"-sapUiTableColHdrScr";var C=t+"-sapUiTableCtrlScr";if(e.target.id===h){if(s._bHScrollHsbBlocked){s._bHScrollHsbBlocked=false;return;}else{s._bHScrollHeaderBlocked=true;s._bHScrollContentBlocked=true;}}else if(e.target.id===H){if(s._bHScrollHeaderBlocked){s._bHScrollHeaderBlocked=false;return;}else{s._bHScrollHsbBlocked=true;s._bHScrollContentBlocked=true;}}else if(e.target.id===C){if(s._bHScrollContentBlocked){s._bHScrollContentBlocked=false;return;}else{s._bHScrollHsbBlocked=true;s._bHScrollHeaderBlocked=true;}}var i=e.target.scrollLeft;if(e.target.id!==h){document.getElementById(h).scrollLeft=i;}if(e.target.id!==H){document.getElementById(H).scrollLeft=i;}if(e.target.id!==C){document.getElementById(C).scrollLeft=i;}s._iHorizontalScrollPosition=i;this._determineVisibleCols(this._collectTableSizes());},onVerticalScrolling:function(e){var s=this._getScrollExtension();q.sap.interaction.notifyScrollEvent&&q.sap.interaction.notifyScrollEvent(e);if(s._bIsScrolledVerticallyByKeyboard){return;}this._getKeyboardExtension().setActionMode(false);function u(t){var v=t._getScrollExtension().getVerticalScrollbar();if(!v){return;}var i=v.scrollTop;s._iVerticalScrollPosition=i;if(a.isVariableRowHeightEnabled(t)){t._adjustTablePosition(i,t._aRowHeights);}t.setFirstVisibleRow(t._getFirstVisibleRowByScrollTop(i),true);}if(this._bLargeDataScrolling&&!s._bIsScrolledVerticallyByWheel){q.sap.clearDelayedCall(this._mTimeouts.scrollUpdateTimerId);this._mTimeouts.scrollUpdateTimerId=q.sap.delayedCall(300,this,function(){u(this);delete this._mTimeouts.scrollUpdateTimerId;});}else{u(this);}s._bIsScrolledVerticallyByWheel=false;},onMouseWheelScrolling:function(e){var s=this._getScrollExtension();var o=e.originalEvent;var h=o.shiftKey;var d;var f=false;var i=0;if(D.browser.firefox){i=o.detail;}else if(h){i=o.deltaX;}else{i=o.deltaY;}d=i>0;if(h){var H=s.getHorizontalScrollbar();if(d){f=H.scrollLeft===H.scrollWidth-H.clientWidth;}else{f=H.scrollLeft===0;}if(s.isHorizontalScrollbarVisible()&&!f){e.preventDefault();e.stopPropagation();H.scrollLeft=H.scrollLeft+i;}}else{var v=s.getVerticalScrollbar();if(d){f=v.scrollTop===v.scrollHeight-v.clientHeight;}else{f=v.scrollTop===0;}if(s.isVerticalScrollbarVisible()&&!f){e.preventDefault();e.stopPropagation();var r=i/this._getDefaultRowHeight();if(r>1){r=Math.floor(r);}s._bIsScrolledVerticallyByWheel=true;s._bIsScrolledVerticallyByKeyboard=false;v.scrollTop+=r*this._getScrollingPixelsForRow();}}},onVerticalScrollbarMouseDown:function(e){var s=this._getScrollExtension();s._bIsScrolledVerticallyByWheel=false;s._bIsScrolledVerticallyByKeyboard=false;},onAfterRendering:function(){E.restoreVerticalScrollPosition(this);window.setTimeout(function(){E.restoreHorizontalScrollPosition(this);}.bind(this),0);},restoreHorizontalScrollPosition:function(t){var s=t._getScrollExtension();var h=s.getHorizontalScrollbar();if(h!==null&&s._iHorizontalScrollPosition!==null){if(h.scrollLeft!==s._iHorizontalScrollPosition){h.scrollLeft=s._iHorizontalScrollPosition;}else{var e=q.Event("scroll");e.target=h;this.onHorizontalScrolling.call(t,e);}}},restoreVerticalScrollPosition:function(t){var s=t._getScrollExtension();if(s._iVerticalScrollPosition!==null){t._updateVSbScrollTop(s._iVerticalScrollPosition);}else{t._updateVSbScrollTop();}}};var b={ontouchstart:function(e){if(this._isTouchMode(e)){this._aTouchStartPosition=null;this._bIsScrollVertical=null;var $=this._getScrollTargets();var d=q(e.target).closest($).length>0;if(d){var t=e.targetTouches[0];this._aTouchStartPosition=[t.pageX,t.pageY];var v=this._getScrollExtension().getVerticalScrollbar();if(v){this._iTouchScrollTop=v.scrollTop;}var h=this._getScrollExtension().getHorizontalScrollbar();if(h){this._iTouchScrollLeft=h.scrollLeft;}}}},ontouchmove:function(e){if(this._isTouchMode(e)&&this._aTouchStartPosition){var t=e.targetTouches[0];var d=(t.pageX-this._aTouchStartPosition[0]);var i=(t.pageY-this._aTouchStartPosition[1]);if(this._bIsScrollVertical==null){this._bIsScrollVertical=Math.abs(i)>Math.abs(d);}if(this._bIsScrollVertical){var v=this._getScrollExtension().getVerticalScrollbar();if(v){var s=this._iTouchScrollTop-i;if(s>0&&s<(this.getDomRef("vsb-content").clientHeight-v.clientHeight)-1){e.preventDefault();e.stopPropagation();}v.scrollTop=s;}}else{var h=this._getScrollExtension().getHorizontalScrollbar();if(h){var f=this._iTouchScrollLeft-d;if(f>0&&f<(this.getDomRef("hsb-content").clientWidth-h.clientWidth)-1){e.preventDefault();e.stopPropagation();}h.scrollLeft=f;}}}}};var c=T.extend("sap.ui.table.TableScrollExtension",{_init:function(t,s,m){this._type=s;this._delegate=b;this._iHorizontalScrollPosition=null;this._iVerticalScrollPosition=null;this._bIsScrolledVerticallyByWheel=false;this._bIsScrolledVerticallyByKeyboard=false;this._onAfterRenderingEventDelegate={onAfterRendering:E.onAfterRendering.bind(t)};t.addEventDelegate(this._delegate,t);return"ScrollExtension";},_attachEvents:function(){var t=this.getTable();var $=t.$();var h=q(this.getHorizontalScrollbar());var H=q(t.getDomRef("sapUiTableColHdrScr"));var f=$.find(".sapUiTableCtrlScrFixed.sapUiTableCHA");var C=q(t.getDomRef("sapUiTableCtrlScr"));var F=q(t.getDomRef(".sapUiTableCtrlScrFixed:not(.sapUiTableCHA)"));h.on("scroll.sapUiTableHScroll",E.onHorizontalScrolling.bind(t));H.on("scroll",E.onHorizontalScrolling.bind(t));C.on("scroll",E.onHorizontalScrolling.bind(t));F.on("scroll",E.onHorizontalScrolling.bind(t));f.on("scroll.sapUiTableFixedHeaderHScroll",E.onFixedAreaHorizontalScrolling);F.on("scroll.sapUiTableFixedContentHScroll",E.onFixedAreaHorizontalScrolling);var v=q(this.getVerticalScrollbar());v.on("scroll.sapUiTableVScroll",E.onVerticalScrolling.bind(t));v.on("mousedown.sapUiTableVScrollClick",E.onVerticalScrollbarMouseDown.bind(t));if(D.browser.firefox){t._getScrollTargets().on("MozMousePixelScroll.sapUiTableMouseWheel",E.onMouseWheelScrolling.bind(t));}else{t._getScrollTargets().on("wheel.sapUiTableMouseWheel",E.onMouseWheelScrolling.bind(t));}t.addEventDelegate(this._onAfterRenderingEventDelegate);},_detachEvents:function(){var t=this.getTable();var $=t.$();var h=q(this.getHorizontalScrollbar());var H=q(t.getDomRef("sapUiTableColHdrScr"));var f=$.find(".sapUiTableColHdrFixed");var C=q(t.getDomRef("sapUiTableCtrlScr"));var F=q(t.getDomRef("sapUiTableCtrlScrFixed"));h.off("scroll.sapUiTableHScroll");H.off("scroll");C.off("scroll");F.off("scroll");f.off("scroll.sapUiTableFixedHeaderHScroll");F.off("scroll.sapUiTableFixedContentHScroll");var v=q(this.getVerticalScrollbar());v.off("scroll.sapUiTableVScroll");if(D.browser.firefox){t._getScrollTargets().off("MozMousePixelScroll.sapUiTableMouseWheel");}else{t._getScrollTargets().off("wheel.sapUiTableMouseWheel");}t.removeEventDelegate(this._onAfterRenderingEventDelegate);},_debug:function(){this._ExtensionHelper=E;this._ExtensionDelegate=b;},destroy:function(){var t=this.getTable();if(t){t.removeEventDelegate(this._delegate);}this._delegate=null;T.prototype.destroy.apply(this,arguments);},scroll:function(d,p,i){if(d==null){d=false;}if(p==null){p=false;}if(i==null){i=false;}var t=this.getTable();var s=false;var r=t._getRowCount();var v=t.getVisibleRowCount();var e=v-t.getFixedRowCount()-t.getFixedBottomRowCount();var f=t._getSanitizedFirstVisibleRow();var g=p?e:1;if(d){if(f+v<r){t.setFirstVisibleRow(Math.min(f+g,r-v));s=true;}}else if(f>0){t.setFirstVisibleRow(Math.max(f-g,0));s=true;}if(s&&i){this._bIsScrolledVerticallyByKeyboard=true;}return s;},scrollMax:function(d,i){if(d==null){d=false;}if(i==null){i=false;}var t=this.getTable();var s=false;var f=t._getSanitizedFirstVisibleRow();if(d){var F=t._getRowCount()-a.getNonEmptyVisibleRowCount(t);if(f<F){t.setFirstVisibleRow(F);s=true;}}else if(f>0){t.setFirstVisibleRow(0);s=true;}if(s&&i){this._bIsScrolledVerticallyByKeyboard=true;}return s;},getHorizontalScrollbar:function(){var t=this.getTable();if(t!=null){var v=t.getDomRef(S.HorizontalScrollBar);if(v!=null){return v;}}return null;},getVerticalScrollbar:function(){var t=this.getTable();if(t!=null){var v=t.getDomRef(S.VerticalScrollBar);if(v!=null){return v;}}return null;},isHorizontalScrollbarVisible:function(){var t=this.getTable();if(t!=null){var o=t.getDomRef();if(o!=null){return o.classList.contains("sapUiTableHScr");}}return false;},isVerticalScrollbarVisible:function(){var t=this.getTable();if(t!=null){var o=t.getDomRef();if(o!=null){return o.classList.contains("sapUiTableVScr");}}return false;},updateVSbMaxHeight:function(){var t=this.getTable();t.getDomRef(S.VerticalScrollBar).style.maxHeight=t._getVSbHeight()+"px";}});return c;},true);
