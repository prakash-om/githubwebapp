/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

(c) Copyright 2009-2016 SAP SE. All rights reserved
 */
sap.ui.define(['jquery.sap.global','./ShapeMarker','sap/ui/core/Control'],function(q,S,C){var a=C.extend('sap.viz.ui5.controls.chartpopover.ContentPanel',{metadata:{properties:{'showLine':'boolean',},publicMethods:["setContentData"]},renderer:{render:function(r,c){r.write('<div');r.addClass("viz-controls-chartPopover-contentPanel");r.writeClasses();r.writeControlData(c);r.writeAttribute("aria-labelledby",c._oDimLabel.getId()+" "+c._oForm.getId());r.writeAttribute('tabindex',-1);r.write('>');r.renderControl(c._oShapeLabel);r.renderControl(c._oPanel);r.write('</div>');}}});a.prototype.init=function(){this._measureItemsLen=0;this._maxMeasureLableLen=15;this._maxMeasureValueLen=12;this._oShapeLabel=new S(this._createId('vizShapeMarker'),{}).addStyleClass('viz-controls-chartPopover-dimension-marker');this._oDimLabel=new sap.m.Text(this._createId('vizDimensionLabel'),{}).addStyleClass('viz-controls-chartPopover-dimension-label');this._oForm=new sap.ui.layout.form.SimpleForm({editable:false,maxContainerCols:2,layout:"ResponsiveGridLayout",labelSpanL:6,labelSpanM:6,labelSpanS:6,emptySpanL:0,emptySpanM:0,emptySpanS:0,columnsL:2,columnsM:2,content:[]});this._oPanel=new sap.ui.layout.Grid({width:'100%',defaultSpan:"L12 M12 S12",content:[this._oDimLabel,this._oForm]}).addStyleClass('viz-controls-chartPopover-Vlt');};a.prototype.setContentData=function(d){var v=d.val,b='',m=[],c,e;this._measureItemsLen=0;if(v){this._oForm.removeAllContent();var f=false,i,g;for(i=0;i<v.length;i++){if(v[i].type&&v[i].type.toLowerCase()==='dimension'){if(d.isTimeSeries&&v.hasOwnProperty("timeDimensions")&&v.timeDimensions.indexOf(i)>-1){e=v[i].value;g=e.time;if(e.day){if(!g||g.length<e.day.length){g=e.day;}}if(v[i].name.length>this._maxMeasureLableLen||g.length>this._maxMeasureValueLen){f=true;break;}}}else if(v[i].type&&v[i].type.toLowerCase()==='measure'){c=v[i].value;if(c==null){c=this._getNoValueLabel();}if((v[i].dataName||v[i].name).length>this._maxMeasureLableLen||c.length>this._maxMeasureValueLen){f=true;break;}}}for(i=0;i<v.length;i++){if(v[i].type&&v[i].type.toLowerCase()==='dimension'){var e=v[i].value;if(d.isTimeSeries&&v.hasOwnProperty("timeDimensions")&&v.timeDimensions.indexOf(i)>-1){var h=v[i].dataName||v[i].name;if(e.time){this._renderLabels(f,h,e.time,d.isTimeSeries);}if(e.day){this._renderLabels(f,(e.time?"":h),e.day,d.isTimeSeries);}}else{if(b==null){b=this._getNoValueLabel();}else if(b.length>0){if(e===null){b=b+' - '+this._getNoValueLabel();}else{b=b+' - '+e;}}else{if(e===null){b=this._getNoValueLabel();}else{b=e.toString();}}}}else if(v[i].type&&v[i].type.toLowerCase()==='measure'){c=v[i].value;if(c==null){c=this._getNoValueLabel();}this._renderLabels(f,(v[i].dataName||v[i].name),c);}}if(typeof d.color==='string'){var j=this._oDimLabel.$().css('margin-left');if(j){j=parseInt(j.substr(0,j.length-2),10);this._oShapeLabel.setMarkerSize(j);}this._oShapeLabel.setColor(d.color).setType((d.shape?d.shape:'square'));if(this.getShowLine()){this._oShapeLabel.setShowWithLine(d.type).setLineInfo(d.lineInfo);}else{this._oShapeLabel.setShowWithLine(undefined);}if(d.stroke&&d.stroke.visible){this._oShapeLabel.setStroke(d.stroke);}}else{this._oShapeLabel.setType(null);this._oShapeLabel.setShowWithLine(undefined);}if(d.pattern){this._oShapeLabel.setPattern(d.pattern);}else{this._oShapeLabel.setPattern(null);}if(b&&b.length>0){this._oDimLabel.setVisible(true);this._oDimLabel.setText(b);}else{this._oDimLabel.setVisible(false);}this._measureItemsLen=d.val.length;}};a.prototype._renderLabels=function(i,n,v,b){var c;if(i){this._oForm.setLabelSpanS(12);if(n!==''){this._oForm.addContent(new sap.m.Text({text:n}).addStyleClass('viz-controls-chartPopover-measure-labels').addStyleClass('viz-controls-chartPopover-measure-labels-wrapper-name'));}c=new sap.m.Text({text:v,textAlign:sap.ui.core.TextAlign.Start}).addStyleClass('viz-controls-chartPopover-measure-labels').addStyleClass('viz-controls-chartPopover-measure-labels-wrapper-value');this._oForm.addContent(c);if(b&&(n==='')){c.addStyleClass('viz-controls-chartPopover-timeDayDimValue');}}else{this._oForm.setLabelSpanS(6);this._oForm.addContent(new sap.m.Label({text:n}).addStyleClass('viz-controls-chartPopover-measure-labels').addStyleClass('viz-controls-chartPopover-measure-name'));c=new sap.m.Text({text:v,textAlign:sap.ui.core.TextAlign.End}).addStyleClass('viz-controls-chartPopover-measure-labels').addStyleClass('viz-controls-chartPopover-measure-value');if(b&&(n==='')){c.addStyleClass('viz-controls-chartPopover-timeDayValue');}this._oForm.addContent(c);}};a.prototype.isMultiSelected=function(){return this._measureItemsLen===0;};a.prototype._createId=function(i){return this.getId()+"-"+i;};a.prototype._getNoValueLabel=function(){return sap.viz.extapi.env.Language.getResourceString("IDS_ISNOVALUE");};a.prototype.exit=function(i){if(this._oForm){this._oForm.destroy();this._oForm=null;}if(this._oShapeLabel){this._oShapeLabel.destroy();this._oShapeLabel=null;}if(this._oDimLabel){this._oDimLabel.destroy();this._oDimLabel=null;}if(this._oPanel){this._oPanel.destroy();this._oPanel=null;}};return a;});
